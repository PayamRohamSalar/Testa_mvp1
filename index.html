<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù¾Ù„ØªÙØ±Ù… Ù†ÙˆØ¢ÙˆØ±ÛŒ Ø¨Ø§Ø² + TESTA</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      // Fallback loader for React, ReactDOM, and Babel if CDN fails
      (function () {
        function loadScript(src) {
          return new Promise(function(resolve, reject) {
            var s = document.createElement('script');
            s.src = src;
            s.onload = resolve;
            s.onerror = function() { reject(new Error('Failed to load ' + src)); };
            document.head.appendChild(s);
          });
        }

        async function ensureDependencies() {
          var needsReact = !window.React;
          var needsReactDOM = !window.ReactDOM;
          var needsBabel = !window.Babel;

          if (!needsReact && !needsReactDOM && !needsBabel) {
            return;
          }

          var cdnCandidates = {
            react: [
              'https://cdn.jsdelivr.net/npm/react@18/umd/react.development.js',
              'https://unpkg.com/react@18/umd/react.development.js'
            ],
            reactDom: [
              'https://cdn.jsdelivr.net/npm/react-dom@18/umd/react-dom.development.js',
              'https://unpkg.com/react-dom@18/umd/react-dom.development.js'
            ],
            babel: [
              'https://cdn.jsdelivr.net/npm/@babel/standalone/babel.min.js',
              'https://unpkg.com/@babel/standalone/babel.min.js'
            ]
          };

          try {
            if (needsReact) {
              for (var i = 0; i < cdnCandidates.react.length && !window.React; i++) {
                await loadScript(cdnCandidates.react[i]);
              }
            }
            if (needsReactDOM) {
              for (var j = 0; j < cdnCandidates.reactDom.length && !window.ReactDOM; j++) {
                await loadScript(cdnCandidates.reactDom[j]);
              }
            }
            if (needsBabel) {
              for (var k = 0; k < cdnCandidates.babel.length && !window.Babel; k++) {
                await loadScript(cdnCandidates.babel[k]);
              }
            }
          } catch (e) {
            console.error('Failed loading dependencies:', e);
          }

          if (window.Babel && typeof window.Babel.transformScriptTags === 'function') {
            // Compile any <script type="text/babel"> tags if Babel loaded late
            window.Babel.transformScriptTags();
          } else if (!window.React || !window.ReactDOM) {
            document.body.innerHTML = '<div style="padding:20px;color:red;font-family:Arial">Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒâ€ŒÙ‡Ø§. Ù„Ø·ÙØ§Ù‹ Ø§ØªØµØ§Ù„ Ø§ÛŒÙ†ØªØ±Ù†Øª ÛŒØ§ ÙØ§ÛŒØ±ÙˆØ§Ù„ Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯.</div>';
          }
        }

        // Kick off dependency check as early as possible
        ensureDependencies();
      })();
    </script>
    <style>
        body {
            font-family: 'Tahoma', 'Arial', sans-serif;
        }

        /* Enhanced Loading Animations */
        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .animate-spin {
            animation: spin 1s linear infinite;
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: .5;
            }
        }

        .animate-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        /* Skeleton Loading Animation */
        @keyframes skeleton-shimmer {
            0% {
                background-position: -200px 0;
            }
            100% {
                background-position: calc(200px + 100%) 0;
            }
        }

        .skeleton {
            background: linear-gradient(
                90deg,
                #f0f0f0 25%,
                #e0e0e0 50%,
                #f0f0f0 75%
            );
            background-size: 200px 100%;
            animation: skeleton-shimmer 1.5s infinite linear;
        }

        /* Button Loading States */
        .btn-loading {
            position: relative;
            color: transparent !important;
        }

        .btn-loading::after {
            content: '';
            position: absolute;
            width: 16px;
            height: 16px;
            top: 50%;
            left: 50%;
            margin-left: -8px;
            margin-top: -8px;
            border: 2px solid #ffffff;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 1s linear infinite;
        }

        /* Page Loading Overlay */
        .page-loading {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        /* Form Field Loading */
        .field-loading {
            position: relative;
        }

        .field-loading::after {
            content: '';
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            width: 12px;
            height: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 50%;
            border-top-color: #3b82f6;
            animation: spin 1s linear infinite;
        }

        /* Fade In Animation */
        @keyframes fade-in {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        .animate-fade-in {
            animation: fade-in 0.5s ease-out forwards;
            opacity: 0;
        }

        /* Slide In Animations */
        @keyframes slide-in-up {
            from {
                transform: translateY(20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        @keyframes slide-in-down {
            from {
                transform: translateY(-20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        @keyframes slide-in-left {
            from {
                transform: translateX(-20px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slide-in-right {
            from {
                transform: translateX(20px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .animate-slide-in-up {
            animation: slide-in-up 0.5s ease-out forwards;
            opacity: 0;
        }

        .animate-slide-in-down {
            animation: slide-in-down 0.5s ease-out forwards;
            opacity: 0;
        }

        .animate-slide-in-left {
            animation: slide-in-left 0.5s ease-out forwards;
            opacity: 0;
        }

        .animate-slide-in-right {
            animation: slide-in-right 0.5s ease-out forwards;
            opacity: 0;
        }

        /* Scale In Animation */
        @keyframes scale-in {
            from {
                transform: scale(0.9);
                opacity: 0;
            }
            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        .animate-scale-in {
            animation: scale-in 0.3s ease-out forwards;
            opacity: 0;
        }

        /* Bounce Animation */
        @keyframes bounce {
            0%, 20%, 53%, 80%, 100% {
                transform: translate3d(0,0,0);
            }
            40%, 43% {
                transform: translate3d(0, -8px, 0);
            }
            70% {
                transform: translate3d(0, -4px, 0);
            }
            90% {
                transform: translate3d(0, -2px, 0);
            }
        }

        .animate-bounce {
            animation: bounce 1s infinite;
        }

        /* Focus Styles for Accessibility */
        .focus-ring:focus {
            outline: 2px solid #3B82F6;
            outline-offset: 2px;
        }

        /* Enhanced Mobile Touch Targets & Accessibility */
        @media (max-width: 768px) {
            /* WCAG AAA compliant touch targets (minimum 44x44px) */
            button, .touch-target, a {
                min-height: 48px;
                min-width: 48px;
                padding: 12px 16px;
            }

            input, select, textarea {
                font-size: 16px; /* Prevent zoom on iOS */
                padding: 16px;
                border-radius: 8px;
                min-height: 48px;
            }

            /* Enhanced touch feedback */
            button:active, .touch-target:active {
                transform: scale(0.98);
                transition: transform 0.1s ease;
            }

            /* Better mobile spacing */
            .space-y-6 > * + * {
                margin-top: 2rem;
            }

            .space-y-8 > * + * {
                margin-top: 2.5rem;
            }

            /* Mobile container improvements */
            .container, .max-w-5xl {
                padding-left: 1rem;
                padding-right: 1rem;
            }

            /* Mobile-friendly navigation */
            nav {
                padding: 0.75rem 1rem;
            }

            /* Stack grid items vertically on mobile */
            .grid.md\\:grid-cols-2 > * {
                margin-bottom: 1.5rem;
            }

            /* Mobile card improvements */
            .card {
                margin-bottom: 1rem;
                border-radius: 12px;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            }

            /* Better mobile table handling */
            .table-responsive {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }

            .grid.md\\:grid-cols-4 > * {
                margin-bottom: 1rem;
            }
        }

        /* Tablet adjustments */
        @media (min-width: 769px) and (max-width: 1024px) {
            .max-w-5xl {
                max-width: 90vw;
            }

            .max-w-7xl {
                max-width: 95vw;
            }
        }

        /* High Contrast Mode Support */
        @media (prefers-contrast: high) {
            .bg-blue-50 { background-color: #ffffff; }
            .bg-green-50 { background-color: #ffffff; }
            .bg-red-50 { background-color: #ffffff; }
            .bg-yellow-50 { background-color: #ffffff; }
            .text-blue-600 { color: #000000; }
            .text-green-600 { color: #000000; }
            .text-red-600 { color: #000000; }
            .text-yellow-600 { color: #000000; }
        }

        /* Enhanced Mobile Touch and Gesture Support */
        @media (max-width: 640px) {
            /* Larger tap targets for small screens */
            button, a, input, select, textarea {
                min-height: 48px;
                touch-action: manipulation; /* Prevent double-tap zoom */
            }

            /* Better mobile typography */
            .text-sm { font-size: 0.9rem; }
            .text-base { font-size: 1rem; }
            .text-lg { font-size: 1.125rem; }
            .text-xl { font-size: 1.25rem; }

            /* Mobile-first navigation */
            .mobile-nav-overlay {
                position: fixed;
                inset: 0;
                background: rgba(0, 0, 0, 0.5);
                backdrop-filter: blur(4px);
                z-index: 999;
            }

            /* Better mobile forms */
            .mobile-form {
                padding: 1rem;
                margin: 0 -1rem;
            }

            /* Mobile grid improvements */
            .grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            /* Mobile card spacing */
            .card-mobile {
                margin-bottom: 1rem;
                border-radius: 0.75rem;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            }

            /* Mobile-friendly modals */
            .modal-mobile {
                margin: 1rem;
                max-height: 90vh;
                overflow-y: auto;
            }
        }

        /* Enhanced tablet support */
        @media (min-width: 641px) and (max-width: 1024px) {
            .tablet-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 1.5rem;
            }

            /* Better tablet navigation */
            nav .hidden { display: block; }
            .mobile-menu-button { display: none; }
        }

        /* Page transition animations */
        @keyframes page-enter {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes page-exit {
            from {
                opacity: 1;
                transform: translateY(0);
            }
            to {
                opacity: 0;
                transform: translateY(-10px);
            }
        }

        .page-transition {
            animation: page-enter 0.3s ease-out;
        }

        /* Loading shimmer effect */
        @keyframes shimmer {
            0% {
                background-position: -1000px 0;
            }
            100% {
                background-position: 1000px 0;
            }
        }

        .shimmer {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 1000px 100%;
            animation: shimmer 2s infinite;
        }

        /* Interactive button states */
        .btn-interactive {
            transition: all 0.15s ease;
            transform: translateZ(0); /* Force hardware acceleration */
        }

        .btn-interactive:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .btn-interactive:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        /* Card hover effects */
        .card-hover {
            transition: all 0.2s ease;
        }

        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }

        /* Focus improvements for accessibility */
        .focus-visible {
            outline: 2px solid #3B82F6;
            outline-offset: 2px;
            border-radius: 4px;
        }

        /* Better focus indicators for keyboard navigation */
        button:focus-visible,
        a:focus-visible,
        input:focus-visible,
        select:focus-visible,
        textarea:focus-visible {
            outline: 2px solid #3B82F6;
            outline-offset: 2px;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        /* High contrast mode improvements */
        @media (prefers-contrast: high) {
            .card-hover:hover {
                border: 2px solid #000;
            }
            
            button {
                border: 1px solid currentColor;
            }
            
            .focus-visible {
                outline: 3px solid currentColor;
            }
        }

        /* Reduced motion support - enhanced */
        @media (prefers-reduced-motion: reduce) {
            .animate-fade-in,
            .animate-slide-in-up,
            .animate-slide-in-down,
            .animate-slide-in-left,
            .animate-slide-in-right,
            .animate-scale-in,
            .animate-spin,
            .animate-pulse,
            .animate-bounce,
            .page-transition,
            .shimmer,
            .btn-interactive,
            .card-hover {
                animation: none !important;
                transition: none !important;
                transform: none !important;
            }
        }
    </style>
</head>
<body class="bg-gray-100">
    <!-- Skip Navigation Link for Accessibility -->
    <a href="#main-content" class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 bg-blue-600 text-white px-4 py-2 rounded z-50 focus-ring">
      Ù¾Ø±Ø´ Ø¨Ù‡ Ù…Ø­ØªÙˆØ§ÛŒ Ø§ØµÙ„ÛŒ
    </a>

    <div id="root"></div>

<script type="text/babel" data-presets="env,react" data-plugins="proposal-class-properties,proposal-optional-chaining,proposal-nullish-coalescing-operator">
    // =========================
    // --- STORAGE ADAPTERS ---
    // =========================
    const storage = {
      get(key, fallback) {
        try {
          const raw = localStorage.getItem(key);
          return raw ? JSON.parse(raw) : fallback;
        } catch {
          return fallback;
        }
      },
      set(key, value) {
        localStorage.setItem(key, JSON.stringify(value));
      },
      has(key) {
        return localStorage.getItem(key) !== null;
      },
      clear() {
        localStorage.clear();
      }
    };
  
    // =========================
    // --- DATA KEYS & MODELS ---
    // =========================
    // Keep keys centralized for easy future migration to API/DB
    const KEYS = {
      "users": "users",
      "orgs": "orgs",
      "challenges": "challenges",
      "submissions": "submissions",
      "messages": "messages",
      "events": "events",
      "exhibitors": "exhibitors",
      "notifications": "notifications",
      "reputationEvents": "reputationEvents",
      "settings": "settings",
      "session": "session",
      "seeded": "seeded"
    };
  
    // Minimal shapes (for reference / future validation)
    // user: {id, role: "ADMIN"|"SEEKER"|"SOLVER", email, name, password, orgId?, avatar?, bio?, skills?, reputation}
    // org: {id, name, domains:[], description?, logo?, website?, contactInfo}
    // challenge: {id, orgId, title, problem?, success?, deliverables?, reward, category, deadline?, tags?, attachments?, status, createdAt, updatedAt}
    // submission: {id, challengeId, userId, ndaAcceptedAt?, status, data:{summary, proposal, files[], video?}, createdAt, updatedAt}
    // message: {id, submissionId, fromUserId, body, createdAt, readAt?}
    // event: {id, day, track, time, title, speakers[], description?, location?, capacity?}
    // exhibitor: {id, name, boothCode, category, description?, logo?, website?, contactInfo}
    // notification: {id, type, text, createdAt, read?, userId?, targetId?}
    // reputationEvent: {id, userId, type, points, at, description?}
    // settings: {kiosk:boolean, countdownTarget:ISO|null, theme?, language?}
  
    // ====================================
    // --- SEED DATA (runs once per user) ---
    // ====================================
    function seedDataOnce() {
      console.log('Checking if seeded:', storage.has(KEYS.seeded));
      if (storage.has(KEYS.seeded)) {
        console.log('Already seeded, skipping...');
        return;
      }
      console.log('Seeding data...');

      // Force seeding by removing the seeded flag first
      try {
        localStorage.removeItem('seeded');
        console.log('Removed seeded flag');
      } catch (e) {
        console.log('Could not remove seeded flag:', e);
      }
  
      // Demo users (per spec)
      const users = [
        {
          "id": "u-admin",
          "role": "ADMIN",
          "email": "admin@platform.ir",
          "name": "Ù…Ø¯ÛŒØ± Ø³ÛŒØ³ØªÙ…",
          "password": "123456",
          "avatar": null,
          "bio": "Ù…Ø¯ÛŒØ± Ø§Ø±Ø´Ø¯ Ù¾Ù„ØªÙØ±Ù… Ù†ÙˆØ¢ÙˆØ±ÛŒ Ø¨Ø§Ø²",
          "skills": ["Ù…Ø¯ÛŒØ±ÛŒØª", "ØªÙˆØ³Ø¹Ù‡ Ù†Ø±Ù…â€ŒØ§ÙØ²Ø§Ø±"],
          "reputation": 1000
        },
        {
          "id": "u-seeker",
          "role": "SEEKER",
          "email": "info@parstech.ir",
          "name": "Ù¾Ø§Ø±Ø³â€ŒØªÚ©",
          "password": "123456",
          "orgId": "o-pars",
          "avatar": null,
          "bio": "Ø´Ø±Ú©Øª Ù¾ÛŒØ´Ø±Ùˆ Ø¯Ø± Ø­ÙˆØ²Ù‡ Ø§Ù†Ø±Ú˜ÛŒ Ùˆ IoT",
          "skills": ["Ø§Ù†Ø±Ú˜ÛŒ", "IoT", "Ù…Ø¯ÛŒØ±ÛŒØª Ù¾Ø±ÙˆÚ˜Ù‡"],
          "reputation": 850
        },
        {
          "id": "u-solver",
          "role": "SOLVER",
          "email": "a.mohammadi@university.ac.ir",
          "name": "Ø§Ù…ÛŒØ± Ù…Ø­Ù…Ø¯ÛŒ",
          "password": "123456",
          "avatar": null,
          "bio": "Ù¾Ú˜ÙˆÙ‡Ø´Ú¯Ø± Ùˆ ØªÙˆØ³Ø¹Ù‡â€ŒØ¯Ù‡Ù†Ø¯Ù‡ Ù†Ø±Ù…â€ŒØ§ÙØ²Ø§Ø±",
          "skills": ["Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ", "ÛŒØ§Ø¯Ú¯ÛŒØ±ÛŒ Ù…Ø§Ø´ÛŒÙ†", "Ù¾Ø§ÛŒØªÙˆÙ†"],
          "reputation": 650
        },
        {
          "id": "u-solver2",
          "role": "SOLVER",
          "email": "sara.ahmadi@tech.ir",
          "name": "Ø³Ø§Ø±Ø§ Ø§Ø­Ù…Ø¯ÛŒ",
          "password": "123456",
          "avatar": null,
          "bio": "Ù…ØªØ®ØµØµ Ø­ÙˆØ²Ù‡ Ø§Ù†Ø±Ú˜ÛŒ Ùˆ Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ",
          "skills": ["Ø§Ù†Ø±Ú˜ÛŒ", "Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ", "MATLAB"],
          "reputation": 720
        }
      ];
  
      const orgs = [
        {
          "id": "o-pars",
          "name": "Ø´Ø±Ú©Øª ØªÙˆØ³Ø¹Ù‡ ÙÙ†Ø§ÙˆØ±ÛŒ Ù¾Ø§Ø±Ø³",
          "domains": ["Ø§Ù†Ø±Ú˜ÛŒ","IoT"],
          "description": "Ø´Ø±Ú©Øª Ù¾ÛŒØ´Ø±Ùˆ Ø¯Ø± Ø­ÙˆØ²Ù‡ Ø§Ù†Ø±Ú˜ÛŒ Ùˆ Ø§ÛŒÙ†ØªØ±Ù†Øª Ø§Ø´ÛŒØ§Ø¡",
          "logo": null,
          "website": "https://parstech.ir",
          "contactInfo": {
            "phone": "+98-21-12345678",
            "address": "ØªÙ‡Ø±Ø§Ù†ØŒ Ø®ÛŒØ§Ø¨Ø§Ù† ÙˆÙ„ÛŒØ¹ØµØ±"
          }
        },
        {
          "id": "o-green",
          "name": "Ø´Ø±Ú©Øª Ø§Ù†Ø±Ú˜ÛŒ Ø³Ø¨Ø²",
          "domains": ["Ø§Ù†Ø±Ú˜ÛŒ", "Ù…Ø­ÛŒØ· Ø²ÛŒØ³Øª"],
          "description": "ØªÙˆØ³Ø¹Ù‡â€ŒØ¯Ù‡Ù†Ø¯Ù‡ Ø±Ø§Ù‡â€ŒØ­Ù„â€ŒÙ‡Ø§ÛŒ Ø§Ù†Ø±Ú˜ÛŒ Ù¾Ø§Ú©",
          "logo": null,
          "website": "https://greenenergy.ir",
          "contactInfo": {
            "phone": "+98-31-87654321",
            "address": "Ø§ØµÙÙ‡Ø§Ù†ØŒ Ø´Ù‡Ø±Ú© ØµÙ†Ø¹ØªÛŒ"
          }
        }
      ];
  
      // Sample challenges
      const challenges = [
        {
          "id": "c-energy",
          "orgId": "o-pars",
          "title": "Ø³Ø§Ù…Ø§Ù†Ù‡ Ù…Ø¯ÛŒØ±ÛŒØª Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø§Ù†Ø±Ú˜ÛŒ",
          "problem": "Ú©Ø§Ù‡Ø´ ØªÙ„ÙØ§Øª Ùˆ Ù¾Ø§ÛŒØ´ Ù…ØµØ±Ù Ø¯Ø± Ù…Ù‚ÛŒØ§Ø³ ØµÙ†Ø¹ØªÛŒ. Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø±Ø§Ù‡â€ŒØ­Ù„ÛŒ Ø¨Ø±Ø§ÛŒ Ù†Ø¸Ø§Ø±Øª Ø¨Ø± Ù…ØµØ±Ù Ø§Ù†Ø±Ú˜ÛŒ Ùˆ Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø¢Ù† Ø¯Ø± Ú©Ø§Ø±Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§ Ùˆ Ù…Ø±Ø§Ú©Ø² ØµÙ†Ø¹ØªÛŒ.",
          "success": "Ø¯Ù‚Øª Ù¾Ø§ÛŒØ´ > Û¹ÛµÙªØŒ Ú¯Ø²Ø§Ø±Ø´â€ŒÚ¯ÛŒØ±ÛŒ Ø¨Ø±Ø®Ø·ØŒ Ú©Ø§Ù‡Ø´ Û²Û°Ùª Ù…ØµØ±Ù Ø§Ù†Ø±Ú˜ÛŒ",
          "deliverables": "Ø·Ø±Ø­ ÙÙ†ÛŒ + PoC + Ù…Ø³ØªÙ†Ø¯Ø§Øª Ú©Ø§Ù…Ù„",
          "reward": 50000000,
          "category": "Energy",
          "deadline": "2024-06-30T23:59:59Z",
          "tags": ["Energy","IoT","Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ"],
          "attachments": [],
          "status": "published",
          "createdAt": "2024-01-15T10:00:00Z",
          "updatedAt": "2024-01-15T10:00:00Z"
        },
        {
          "id": "c-green",
          "orgId": "o-green",
          "title": "Ù¾Ù†Ù„ Ø®ÙˆØ±Ø´ÛŒØ¯ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯",
          "problem": "Ø·Ø±Ø§Ø­ÛŒ Ø³ÛŒØ³ØªÙ… Ø±Ø¯ÛŒØ§Ø¨ÛŒ Ø®ÙˆØ±Ø´ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ø­Ø¯Ø§Ú©Ø«Ø± Ø¨Ù‡Ø±Ù‡â€ŒÙˆØ±ÛŒ Ø§Ø² Ø§Ù†Ø±Ú˜ÛŒ Ø®ÙˆØ±Ø´ÛŒØ¯ÛŒ",
          "success": "Ø§ÙØ²Ø§ÛŒØ´ Û³Û°Ùª Ø¨Ø§Ø²Ø¯Ù‡ÛŒ Ù†Ø³Ø¨Øª Ø¨Ù‡ Ù¾Ù†Ù„â€ŒÙ‡Ø§ÛŒ Ø«Ø§Ø¨Øª",
          "deliverables": "Ù†Ù…ÙˆÙ†Ù‡ Ø§ÙˆÙ„ÛŒÙ‡ + Ù†Ø±Ù…â€ŒØ§ÙØ²Ø§Ø± Ú©Ù†ØªØ±Ù„",
          "reward": 30000000,
          "category": "Energy",
          "deadline": "2024-07-15T23:59:59Z",
          "tags": ["Ø§Ù†Ø±Ú˜ÛŒ Ø®ÙˆØ±Ø´ÛŒØ¯ÛŒ", "Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ", "Ø±Ø¨Ø§ØªÛŒÚ©"],
          "attachments": [],
          "status": "published",
          "createdAt": "2024-01-20T14:30:00Z",
          "updatedAt": "2024-01-20T14:30:00Z"
        }
      ];
  
      // Sample submissions
      const submissions = [
        {
          "id": "sub-1",
          "challengeId": "c-energy",
          "userId": "u-solver",
          "ndaAcceptedAt": "2024-01-16T09:00:00Z",
          "ndaVersion": "1.0",
          "status": "under_review",
          "scores": {
            "fit": 8,
            "feasibility": 7,
            "costTime": 9,
            "innovation": 6,
            "total": 7.9
          },
          "scoredAt": "2024-01-17T10:00:00Z",
          "data": {
            "summary": "Ø±Ø§Ù‡â€ŒØ­Ù„ Ù…Ø¨ØªÙ†ÛŒ Ø¨Ø± IoT Ø¨Ø±Ø§ÛŒ Ù¾Ø§ÛŒØ´ Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø§Ù†Ø±Ú˜ÛŒ",
            "proposal": "Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø³Ù†Ø³ÙˆØ±Ù‡Ø§ÛŒ IoT Ùˆ Ø§Ù„Ú¯ÙˆØ±ÛŒØªÙ…â€ŒÙ‡Ø§ÛŒ ÛŒØ§Ø¯Ú¯ÛŒØ±ÛŒ Ù…Ø§Ø´ÛŒÙ† Ø¨Ø±Ø§ÛŒ Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ Ùˆ Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ Ù…ØµØ±Ù Ø§Ù†Ø±Ú˜ÛŒ",
            "files": ["proposal.pdf", "technical_specs.docx"],
            "video": "demo.mp4"
          },
          "createdAt": "2024-01-16T09:00:00Z",
          "updatedAt": "2024-01-16T09:00:00Z"
        },
        {
          "id": "sub-2",
          "challengeId": "c-energy",
          "userId": "u-solver2",
          "ndaAcceptedAt": "2024-01-21T11:00:00Z",
          "ndaVersion": "1.0",
          "status": "under_review",
          "scores": {
            "fit": 7,
            "feasibility": 8,
            "costTime": 6,
            "innovation": 8,
            "total": 7.4
          },
          "scoredAt": "2024-01-22T14:00:00Z",
          "data": {
            "summary": "Ø³ÛŒØ³ØªÙ… Ø±Ø¯ÛŒØ§Ø¨ÛŒ Ø®ÙˆØ±Ø´ÛŒØ¯ Ø¨Ø§ Ú©Ù†ØªØ±Ù„ Ù‡ÙˆØ´Ù…Ù†Ø¯",
            "proposal": "Ø·Ø±Ø§Ø­ÛŒ Ù…Ú©Ø§Ù†ÛŒØ²Ù… Ø±Ø¯ÛŒØ§Ø¨ÛŒ Ø¯Ùˆ Ù…Ø­ÙˆØ±Ù‡ Ø¨Ø§ Ú©Ù†ØªØ±Ù„ ÙØ§Ø²ÛŒ Ø¨Ø±Ø§ÛŒ Ø­Ø¯Ø§Ú©Ø«Ø± Ø¨Ù‡Ø±Ù‡â€ŒÙˆØ±ÛŒ Ø§Ù†Ø±Ú˜ÛŒ Ø®ÙˆØ±Ø´ÛŒØ¯ÛŒ",
            "files": ["draft_proposal.pdf"],
            "video": null
          },
          "createdAt": "2024-01-21T11:00:00Z",
          "updatedAt": "2024-01-21T11:00:00Z"
        },
        {
          "id": "sub-3",
          "challengeId": "c-green",
          "userId": "u-solver",
          "ndaAcceptedAt": "2024-01-25T09:00:00Z",
          "ndaVersion": "1.0",
          "status": "received",
          "data": {
            "summary": "Ø±Ø§Ù‡â€ŒØ­Ù„ ØªØ±Ú©ÛŒØ¨ÛŒ Ø§Ù†Ø±Ú˜ÛŒ Ù¾Ø§Ú©",
            "proposal": "ØªØ±Ú©ÛŒØ¨ Ø³ÛŒØ³ØªÙ…â€ŒÙ‡Ø§ÛŒ Ø®ÙˆØ±Ø´ÛŒØ¯ÛŒ Ùˆ Ø¨Ø§Ø¯ÛŒ Ø¨Ø±Ø§ÛŒ ØªØ£Ù…ÛŒÙ† Ø§Ù†Ø±Ú˜ÛŒ Ù¾Ø§ÛŒØ¯Ø§Ø±",
            "files": ["combined_energy_proposal.pdf"],
            "video": "combined_demo.mp4"
          },
          "createdAt": "2024-01-25T09:00:00Z",
          "updatedAt": "2024-01-25T09:00:00Z"
        }
      ];
  
      // Sample messages
      const messages = [
        {
          id: "msg-1",
          submissionId: "sub-1",
          fromUserId: "u-seeker",
          body: "Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ø´Ù…Ø§ Ø¨Ø³ÛŒØ§Ø± Ø¬Ø§Ù„Ø¨ Ø§Ø³Øª. Ø¢ÛŒØ§ Ø§Ù…Ú©Ø§Ù† Ø§Ø±Ø§Ø¦Ù‡ Ø¬Ø²Ø¦ÛŒØ§Øª Ø¨ÛŒØ´ØªØ± Ø¯Ø± Ù…ÙˆØ±Ø¯ Ø§Ù„Ú¯ÙˆØ±ÛŒØªÙ…â€ŒÙ‡Ø§ÛŒ ÛŒØ§Ø¯Ú¯ÛŒØ±ÛŒ Ù…Ø§Ø´ÛŒÙ† ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯ØŸ",
          createdAt: "2024-01-17T10:00:00Z",
          readAt: "2024-01-17T14:30:00Z"
        },
        {
          id: "msg-2",
          submissionId: "sub-1",
          fromUserId: "u-solver",
          body: "Ø¨Ù„Ù‡ØŒ Ø­ØªÙ…Ø§Ù‹. Ù…Ù† ÛŒÚ© Ù…Ø³ØªÙ†Ø¯ ÙÙ†ÛŒ Ú©Ø§Ù…Ù„ Ø¢Ù…Ø§Ø¯Ù‡ Ú©Ø±Ø¯Ù‡â€ŒØ§Ù… Ú©Ù‡ Ø´Ø§Ù…Ù„ Ø¬Ø²Ø¦ÛŒØ§Øª Ø§Ù„Ú¯ÙˆØ±ÛŒØªÙ…â€ŒÙ‡Ø§ Ùˆ Ù†ØªØ§ÛŒØ¬ Ø¢Ø²Ù…Ø§ÛŒØ´Ø§Øª Ø§Ø³Øª.",
          createdAt: "2024-01-17T15:00:00Z",
          readAt: null
        },
        {
          id: "msg-3",
          submissionId: "sub-2",
          fromUserId: "u-seeker",
          body: "Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ø´Ù…Ø§ Ø¯Ø± Ù…ÙˆØ±Ø¯ Ø³ÛŒØ³ØªÙ… Ø±Ø¯ÛŒØ§Ø¨ÛŒ Ø®ÙˆØ±Ø´ÛŒØ¯ÛŒ Ø¨Ø³ÛŒØ§Ø± Ø¬Ø°Ø§Ø¨ Ø§Ø³Øª. Ø¢ÛŒØ§ Ù†Ù…ÙˆÙ†Ù‡â€ŒØ§ÛŒ Ø§Ø² Ø§ÛŒÙ† Ø³ÛŒØ³ØªÙ… Ø±Ø§ Ù‚Ø¨Ù„Ø§Ù‹ Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ú©Ø±Ø¯Ù‡â€ŒØ§ÛŒØ¯ØŸ",
          createdAt: "2024-01-22T09:15:00Z",
          readAt: null
        },
        {
          id: "msg-4",
          submissionId: "sub-2",
          fromUserId: "u-solver2",
          body: "Ø¨Ù„Ù‡ØŒ Ù…Ø§ ÛŒÚ© Ù†Ù…ÙˆÙ†Ù‡ Ø§ÙˆÙ„ÛŒÙ‡ Ú©ÙˆÚ†Ú© Ø¯Ø± Ø¢Ø²Ù…Ø§ÛŒØ´Ú¯Ø§Ù‡ Ø¯Ø§Ù†Ø´Ú¯Ø§Ù‡ Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ú©Ø±Ø¯Ù‡â€ŒØ§ÛŒÙ…. Ú©Ø§Ø±Ø§ÛŒÛŒ Ø¢Ù† Ø­Ø¯ÙˆØ¯ Û³ÛµÙª Ø¨Ù‡ØªØ± Ø§Ø² Ù¾Ù†Ù„â€ŒÙ‡Ø§ÛŒ Ø«Ø§Ø¨Øª Ø¨ÙˆØ¯.",
          createdAt: "2024-01-22T11:30:00Z",
          readAt: null
        },
        {
          id: "msg-5",
          submissionId: "sub-3",
          fromUserId: "u-seeker",
          body: "Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ ØªØ±Ú©ÛŒØ¨ÛŒ Ø§Ù†Ø±Ú˜ÛŒ Ø´Ù…Ø§ Ø¬Ø§Ù„Ø¨ ØªÙˆØ¬Ù‡ Ø§Ø³Øª. Ù„Ø·ÙØ§Ù‹ Ø¯Ø± Ù…ÙˆØ±Ø¯ Ù‡Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ ØªÙˆØ¶ÛŒØ­ Ø¯Ù‡ÛŒØ¯.",
          createdAt: "2024-01-26T14:20:00Z",
          readAt: null
        }
      ];
  
      // TESTA Events
      const events = [
        { 
          id: "ev-1", 
          day: 1, 
          track: "Keynote", 
          time: "10:00", 
          title: "Ø§ÙØªØªØ§Ø­ÛŒÙ‡ TESTA", 
          speakers: ["Ø¯Ú©ØªØ± Ø§Ø­Ù…Ø¯ÛŒ", "Ù…Ù‡Ù†Ø¯Ø³ Ù…Ø­Ù…Ø¯ÛŒ"],
          description: "Ù…Ø±Ø§Ø³Ù… Ø§ÙØªØªØ§Ø­ÛŒÙ‡ Ù†Ù…Ø§ÛŒØ´Ú¯Ø§Ù‡ ÙÙ†Ø§ÙˆØ±ÛŒ Ùˆ Ù†ÙˆØ¢ÙˆØ±ÛŒ TESTA",
          location: "Ø³Ø§Ù„Ù† Ø§ØµÙ„ÛŒ",
          capacity: 500
        },
        {
          id: "ev-2",
          day: 1,
          track: "Energy",
          time: "14:00",
          title: "Ø¢ÛŒÙ†Ø¯Ù‡ Ø§Ù†Ø±Ú˜ÛŒ Ø¯Ø± Ø§ÛŒØ±Ø§Ù†",
          speakers: ["Ø¯Ú©ØªØ± Ø±Ø¶Ø§ÛŒÛŒ"],
          description: "Ø¨Ø±Ø±Ø³ÛŒ Ú†Ø§Ù„Ø´â€ŒÙ‡Ø§ Ùˆ ÙØ±ØµØªâ€ŒÙ‡Ø§ÛŒ Ø­ÙˆØ²Ù‡ Ø§Ù†Ø±Ú˜ÛŒ",
          location: "Ø³Ø§Ù„Ù† Ø§Ù†Ø±Ú˜ÛŒ",
          capacity: 200
        },
        {
          id: "ev-3",
          day: 2,
          track: "IoT",
          time: "11:00",
          title: "Ø§ÛŒÙ†ØªØ±Ù†Øª Ø§Ø´ÛŒØ§Ø¡ Ùˆ Ø´Ù‡Ø± Ù‡ÙˆØ´Ù…Ù†Ø¯",
          speakers: ["Ù…Ù‡Ù†Ø¯Ø³ Ú©Ø±ÛŒÙ…ÛŒ", "Ø¯Ú©ØªØ± Ù†ÙˆØ±ÛŒ"],
          description: "Ú©Ø§Ø±Ø¨Ø±Ø¯Ù‡Ø§ÛŒ IoT Ø¯Ø± ØªÙˆØ³Ø¹Ù‡ Ø´Ù‡Ø±Ù‡Ø§ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯",
          location: "Ø³Ø§Ù„Ù† IoT",
          capacity: 150
        }
      ];
      
      const exhibitors = [
        { 
          id: "ex-1", 
          name: "Ù¾Ø§Ø±Ø³â€ŒØªÚ©", 
          boothCode: "A12", 
          category: "Energy",
          description: "Ù†Ù…Ø§ÛŒØ´Ú¯Ø± Ø±Ø§Ù‡â€ŒØ­Ù„â€ŒÙ‡Ø§ÛŒ Ø§Ù†Ø±Ú˜ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯",
          logo: null,
          website: "https://parstech.ir",
          contactInfo: {
            phone: "+98-21-12345678",
            email: "info@parstech.ir"
          }
        },
        {
          id: "ex-2",
          name: "Ø´Ø±Ú©Øª Ø§Ù†Ø±Ú˜ÛŒ Ø³Ø¨Ø²",
          boothCode: "B08",
          category: "Energy",
          description: "Ø±Ø§Ù‡â€ŒØ­Ù„â€ŒÙ‡Ø§ÛŒ Ø§Ù†Ø±Ú˜ÛŒ Ù¾Ø§Ú© Ùˆ ØªØ¬Ø¯ÛŒØ¯Ù¾Ø°ÛŒØ±",
          logo: null,
          website: "https://greenenergy.ir",
          contactInfo: {
            phone: "+98-31-87654321",
            email: "info@greenenergy.ir"
          }
        },
        {
          id: "ex-3",
          name: "ØªÚ©â€ŒÙ†Ùˆ",
          boothCode: "C15",
          category: "IoT",
          description: "Ù¾Ù„ØªÙØ±Ù…â€ŒÙ‡Ø§ÛŒ IoT Ùˆ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ",
          logo: null,
          website: "https://techno.ir",
          contactInfo: {
            phone: "+98-51-11223344",
            email: "info@techno.ir"
          }
        }
      ];
  
      // Sample notifications
      const notifications = [
        {
          id: "notif-1",
          type: "challenge",
          text: "Ú†Ø§Ù„Ø´ Ø¬Ø¯ÛŒØ¯ 'Ø³Ø§Ù…Ø§Ù†Ù‡ Ù…Ø¯ÛŒØ±ÛŒØª Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø§Ù†Ø±Ú˜ÛŒ' Ù…Ù†ØªØ´Ø± Ø´Ø¯",
          createdAt: "2024-01-15T10:00:00Z",
          read: false,
          userId: "u-solver",
          targetId: "c-energy"
        },
        {
          id: "notif-2",
          type: "message",
          text: "Ù¾ÛŒØ§Ù… Ø¬Ø¯ÛŒØ¯ Ø¯Ø± Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ø´Ù…Ø§ Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯",
          createdAt: "2024-01-17T10:00:00Z",
          read: true,
          userId: "u-solver",
          targetId: "msg-1"
        },
        {
          id: "notif-3",
          type: "event",
          text: "Ø±ÙˆÛŒØ¯Ø§Ø¯ 'Ø¢ÛŒÙ†Ø¯Ù‡ Ø§Ù†Ø±Ú˜ÛŒ Ø¯Ø± Ø§ÛŒØ±Ø§Ù†' ÙØ±Ø¯Ø§ Ø³Ø§Ø¹Øª Û±Û´:Û°Û° Ø¨Ø±Ú¯Ø²Ø§Ø± Ù…ÛŒâ€ŒØ´ÙˆØ¯",
          createdAt: "2024-01-20T09:00:00Z",
          read: false,
          userId: "u-solver",
          targetId: "ev-2"
        }
      ];
  
      // Sample reputation events
      const reputationEvents = [
        {
          id: "rep-1",
          userId: "u-solver",
          type: "submission_created",
          points: 50,
          at: "2024-01-16T09:00:00Z",
          description: "Ø§ÛŒØ¬Ø§Ø¯ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ø¨Ø±Ø§ÛŒ Ú†Ø§Ù„Ø´ 'Ø³Ø§Ù…Ø§Ù†Ù‡ Ù…Ø¯ÛŒØ±ÛŒØª Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø§Ù†Ø±Ú˜ÛŒ'"
        },
        {
          id: "rep-2",
          userId: "u-solver",
          type: "message_received",
          points: 10,
          at: "2024-01-17T10:00:00Z",
          description: "Ø¯Ø±ÛŒØ§ÙØª Ù¾ÛŒØ§Ù… Ø§Ø² Ú©Ø§Ø±ÙØ±Ù…Ø§"
        },
        {
          id: "rep-3",
          userId: "u-solver2",
          type: "submission_created",
          points: 50,
          at: "2024-01-21T11:00:00Z",
          description: "Ø§ÛŒØ¬Ø§Ø¯ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ø¨Ø±Ø§ÛŒ Ú†Ø§Ù„Ø´ 'Ù¾Ù†Ù„ Ø®ÙˆØ±Ø´ÛŒØ¯ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯'"
        }
      ];
  
      // Initialize all collections (overwrite to ensure consistency during reseed)
      storage.set(KEYS.users, users);
      storage.set(KEYS.orgs, orgs);
      storage.set(KEYS.challenges, challenges);
      storage.set(KEYS.submissions, submissions);
      storage.set(KEYS.messages, messages);
      storage.set(KEYS.events, events);
      storage.set(KEYS.exhibitors, exhibitors);
      storage.set(KEYS.notifications, notifications);
      storage.set(KEYS.reputationEvents, reputationEvents);
      storage.set(KEYS.settings, {
        kiosk: false,
        countdownTarget: "2024-06-20T09:00:00Z", // TESTA start date
        theme: "light",
        language: "fa"
      });
      storage.set(KEYS.session, null);
  
      // mark seeded
      localStorage.setItem(KEYS.seeded, "1");
      console.log('Seeding complete! Users stored:', users.length);

      // Verify data was stored
      const storedUsers = storage.get(KEYS.users, []);
      console.log('Verification - stored users count:', storedUsers.length);
      if (storedUsers.length === 0) {
        console.error('ERROR: Users were not stored properly!');
      } else {
        console.log('Users successfully stored:', storedUsers.map(u => ({email: u.email, role: u.role})));
      }
    }

    // Expose seeding function for debug/reset actions
    window.seedDataOnce = seedDataOnce;
  
    // ================================
    // --- HOOK: useLocalStorage(key) ---
    // ================================
    // Simple helper to bind React state to localStorage
    function useLocalStorage(key, initialValue) {
      const [state, setState] = React.useState(() => storage.get(key, initialValue));
      React.useEffect(() => { storage.set(key, state); }, [key, state]);
      return [state, setState];
    }

    // ================================
    // --- ENHANCED FORM VALIDATION ---
    // ================================
    
    // Form validation utilities
    const validators = {
      required: (value) => {
        if (!value || (typeof value === 'string' && !value.trim())) {
          return 'Ø§ÛŒÙ† ÙÛŒÙ„Ø¯ Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª';
        }
        return null;
      },
      
      email: (value) => {
        if (!value) return null;
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        return emailRegex.test(value) ? null : 'Ø§ÛŒÙ…ÛŒÙ„ Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª';
      },
      
      minLength: (min) => (value) => {
        if (!value) return null;
        return value.length >= min ? null : `Ø­Ø¯Ø§Ù‚Ù„ ${min} Ú©Ø§Ø±Ø§Ú©ØªØ± Ù…ÙˆØ±Ø¯ Ù†ÛŒØ§Ø² Ø§Ø³Øª`;
      },
      
      maxLength: (max) => (value) => {
        if (!value) return null;
        return value.length <= max ? null : `Ø­Ø¯Ø§Ú©Ø«Ø± ${max} Ú©Ø§Ø±Ø§Ú©ØªØ± Ù…Ø¬Ø§Ø² Ø§Ø³Øª`;
      },
      
      pattern: (regex, message) => (value) => {
        if (!value) return null;
        return regex.test(value) ? null : message;
      },
      
      numeric: (value) => {
        if (!value) return null;
        return !isNaN(value) && !isNaN(parseFloat(value)) ? null : 'Ù…Ù‚Ø¯Ø§Ø± Ø¨Ø§ÛŒØ¯ Ø¹Ø¯Ø¯ÛŒ Ø¨Ø§Ø´Ø¯';
      },
      
      url: (value) => {
        if (!value) return null;
        try {
          new URL(value);
          return null;
        } catch {
          return 'Ø¢Ø¯Ø±Ø³ ÙˆØ¨ Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª';
        }
      }
    };

    // Enhanced form validation hook
    function useFormValidation(initialValues, rules) {
      const [values, setValues] = React.useState(initialValues);
      const [errors, setErrors] = React.useState({});
      const [touched, setTouched] = React.useState({});
      const [isSubmitting, setIsSubmitting] = React.useState(false);

      const validateField = React.useCallback((name, value) => {
        const fieldRules = rules[name];
        if (!fieldRules) return null;

        for (const rule of fieldRules) {
          const error = rule(value);
          if (error) return error;
        }
        return null;
      }, [rules]);

      const setValue = React.useCallback((name, value) => {
        setValues(prev => ({ ...prev, [name]: value }));
        
        // Real-time validation for touched fields
        if (touched[name]) {
          const error = validateField(name, value);
          setErrors(prev => ({ ...prev, [name]: error }));
        }
      }, [validateField, touched]);

      const setFieldTouched = React.useCallback((name) => {
        setTouched(prev => ({ ...prev, [name]: true }));
        
        // Validate on blur
        const error = validateField(name, values[name]);
        setErrors(prev => ({ ...prev, [name]: error }));
      }, [validateField, values]);

      const validateAll = React.useCallback(() => {
        const newErrors = {};
        let isValid = true;

        Object.keys(rules).forEach(name => {
          const error = validateField(name, values[name]);
          newErrors[name] = error;
          if (error) isValid = false;
        });

        setErrors(newErrors);
        setTouched(Object.keys(rules).reduce((acc, key) => ({ ...acc, [key]: true }), {}));
        return isValid;
      }, [rules, validateField, values]);

      const reset = React.useCallback(() => {
        setValues(initialValues);
        setErrors({});
        setTouched({});
        setIsSubmitting(false);
      }, [initialValues]);

      return {
        values,
        errors,
        touched,
        isSubmitting,
        setValue,
        setFieldTouched,
        setIsSubmitting,
        validateAll,
        reset,
        isValid: Object.values(errors).every(error => !error)
      };
    }

    // ================================
    // --- KEYBOARD NAVIGATION UTILITIES ---
    // ================================
    
    // Enhanced keyboard navigation hook
    function useKeyboardNavigation(items, options = {}) {
      const {
        loop = true,
        onSelect = () => {},
        orientation = 'vertical'
      } = options;
      
      const [currentIndex, setCurrentIndex] = React.useState(-1);
      
      const handleKeyDown = React.useCallback((event) => {
        const key = event.key;
        const isVertical = orientation === 'vertical';
        const nextKey = isVertical ? 'ArrowDown' : 'ArrowRight';
        const prevKey = isVertical ? 'ArrowUp' : 'ArrowLeft';
        
        switch (key) {
          case nextKey:
            event.preventDefault();
            setCurrentIndex(prev => {
              const next = prev + 1;
              return next >= items.length ? (loop ? 0 : prev) : next;
            });
            break;
            
          case prevKey:
            event.preventDefault();
            setCurrentIndex(prev => {
              const next = prev - 1;
              return next < 0 ? (loop ? items.length - 1 : 0) : next;
            });
            break;
            
          case 'Enter':
          case ' ':
            event.preventDefault();
            if (currentIndex >= 0 && currentIndex < items.length) {
              onSelect(items[currentIndex], currentIndex);
            }
            break;
            
          case 'Home':
            event.preventDefault();
            setCurrentIndex(0);
            break;
            
          case 'End':
            event.preventDefault();
            setCurrentIndex(items.length - 1);
            break;
            
          case 'Escape':
            event.preventDefault();
            setCurrentIndex(-1);
            break;
        }
      }, [items, loop, onSelect, orientation]);
      
      return {
        currentIndex,
        setCurrentIndex,
        handleKeyDown
      };
    }

    // Focus management utilities
    const focusManager = {
      // Store the last focused element for restoration
      lastFocused: null,
      
      // Save current focus
      saveFocus: () => {
        focusManager.lastFocused = document.activeElement;
      },
      
      // Restore saved focus
      restoreFocus: () => {
        if (focusManager.lastFocused && focusManager.lastFocused.focus) {
          focusManager.lastFocused.focus();
          focusManager.lastFocused = null;
        }
      },
      
      // Focus trap for modals
      trapFocus: (element) => {
        const focusableElements = element.querySelectorAll(
          'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'
        );
        const firstElement = focusableElements[0];
        const lastElement = focusableElements[focusableElements.length - 1];
        
        const handleTabKey = (e) => {
          if (e.key !== 'Tab') return;
          
          if (e.shiftKey) {
            if (document.activeElement === firstElement) {
              lastElement.focus();
              e.preventDefault();
            }
          } else {
            if (document.activeElement === lastElement) {
              firstElement.focus();
              e.preventDefault();
            }
          }
        };
        
        element.addEventListener('keydown', handleTabKey);
        firstElement?.focus();
        
        return () => {
          element.removeEventListener('keydown', handleTabKey);
        };
      },
      
      // Auto-focus first focusable element
      focusFirst: (element) => {
        const focusable = element.querySelector(
          'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'
        );
        focusable?.focus();
      }
    };

    // Skip link component for accessibility
    function SkipLink({ href, children }) {
      return (
        <a
          href={href}
          className="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 bg-blue-600 text-white px-4 py-2 rounded-md z-50 focus-ring"
          onFocus={(e) => e.target.classList.remove('sr-only')}
          onBlur={(e) => e.target.classList.add('sr-only')}
        >
          {children}
        </a>
      );
    }

    // ================================
    // --- TINY HASH ROUTER ---
    // ================================
    function useHashRouter(defaultRoute = 'home') {
      const getRouteFromHash = () => {
        const hash = window.location.hash.slice(1); // Remove #
        return hash || defaultRoute;
      };

      const [currentRoute, setCurrentRoute] = React.useState(getRouteFromHash);

      React.useEffect(() => {
        const handleHashChange = () => {
          setCurrentRoute(getRouteFromHash());
        };

        window.addEventListener('hashchange', handleHashChange);
        return () => window.removeEventListener('hashchange', handleHashChange);
      }, []);

      const navigate = (route) => {
        window.location.hash = route;
      };

      return [currentRoute, navigate];
    }

    // ================================
    // --- NAVIGATION COMPONENT ---
    // ================================
    function Navigation({ currentRoute, navigate, session, onLogout, kioskMode }) {
      const [mobileMenuOpen, setMobileMenuOpen] = React.useState(false);

      // Get unread message count
      const getUnreadMessageCount = () => {
        if (!session) return 0;
        const messages = JSON.parse(localStorage.getItem('messages') || '[]');
        return messages.filter(msg =>
          msg.fromUserId !== session.userId && !msg.readAt
        ).length;
      };

      // Close mobile menu when clicking outside or on escape
      React.useEffect(() => {
        const handleEscape = (event) => {
          if (event.key === 'Escape' && mobileMenuOpen) {
            setMobileMenuOpen(false);
          }
        };

        const handleClickOutside = (event) => {
          if (mobileMenuOpen && !event.target.closest('nav')) {
            setMobileMenuOpen(false);
          }
        };

        if (mobileMenuOpen) {
          document.addEventListener('keydown', handleEscape);
          document.addEventListener('click', handleClickOutside);
        }

        return () => {
          document.removeEventListener('keydown', handleEscape);
          document.removeEventListener('click', handleClickOutside);
        };
      }, [mobileMenuOpen]);

      // Define navigation items based on user role
      const getNavItems = () => {
        const baseItems = [
          { key: 'home', label: 'Ø®Ø§Ù†Ù‡', icon: 'ğŸ ', public: true }
        ];

        if (!session) {
          // Unauthenticated users
          return [
            ...baseItems,
            { key: 'challenges', label: 'Ú†Ø§Ù„Ø´â€ŒÙ‡Ø§', icon: 'ğŸ¯', public: true },
            { key: 'testa-home', label: 'TESTA', icon: 'ğŸª', public: true },
            { key: 'testa-schedule', label: 'Ø¨Ø±Ù†Ø§Ù…Ù‡ TESTA', icon: 'ğŸ“…', public: true },
            { key: 'testa-events', label: 'Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ÛŒ TESTA', icon: 'ğŸ¤', public: true },
            { key: 'testa-booths', label: 'Ù†Ù…Ø§ÛŒØ´Ú¯Ø§Ù‡â€ŒÙ‡Ø§', icon: 'ğŸª', public: true }
          ];
        }

        // Authenticated users
        const authenticatedItems = [...baseItems];

        // Role-specific navigation
        if (session.role === 'ADMIN') {
          authenticatedItems.push(
            { key: 'challenges', label: 'Ú†Ø§Ù„Ø´â€ŒÙ‡Ø§', icon: 'ğŸ¯' },
            { key: 'admin', label: 'Ù…Ø¯ÛŒØ±ÛŒØª', icon: 'âš™ï¸' },
            { key: 'testa-home', label: 'TESTA', icon: 'ğŸª' },
            { key: 'testa-schedule', label: 'Ø¨Ø±Ù†Ø§Ù…Ù‡ TESTA', icon: 'ğŸ“…' },
            { key: 'testa-events', label: 'Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ÛŒ TESTA', icon: 'ğŸ¤' },
            { key: 'testa-booths', label: 'Ù†Ù…Ø§ÛŒØ´Ú¯Ø§Ù‡â€ŒÙ‡Ø§', icon: 'ğŸª' },
            { key: 'testa-stats', label: 'Ø¢Ù…Ø§Ø± TESTA', icon: 'ğŸ“Š' }
          );
        } else if (session.role === 'SEEKER') {
          const unreadCount = getUnreadMessageCount();
          authenticatedItems.push(
            { key: 'challenges', label: 'Ú†Ø§Ù„Ø´â€ŒÙ‡Ø§', icon: 'ğŸ¯' },
            { key: 'create-challenge', label: 'Ø§ÛŒØ¬Ø§Ø¯ Ú†Ø§Ù„Ø´', icon: 'â•' },
            { key: 'my-challenges', label: 'Ú†Ø§Ù„Ø´â€ŒÙ‡Ø§ÛŒ Ù…Ù†', icon: 'ğŸ“' },
            { key: 'submissions', label: 'Ù…Ø¯ÛŒØ±ÛŒØª Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯Ø§Øª', icon: 'ğŸ“Š' },
            { key: 'messages', label: unreadCount > 0 ? `Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ (${unreadCount})` : 'Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§', icon: 'ğŸ’¬' },
            { key: 'profile', label: 'Ù¾Ø±ÙˆÙØ§ÛŒÙ„ Ø³Ø§Ø²Ù…Ø§Ù†', icon: 'ğŸ¢' },
            { key: 'testa-home', label: 'TESTA', icon: 'ğŸª' },
            { key: 'testa-schedule', label: 'Ø¨Ø±Ù†Ø§Ù…Ù‡ TESTA', icon: 'ğŸ“…' },
            { key: 'testa-events', label: 'Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ÛŒ TESTA', icon: 'ğŸ¤' },
            { key: 'testa-booths', label: 'Ù†Ù…Ø§ÛŒØ´Ú¯Ø§Ù‡â€ŒÙ‡Ø§', icon: 'ğŸª' },
            { key: 'testa-stats', label: 'Ø¢Ù…Ø§Ø± TESTA', icon: 'ğŸ“Š' }
          );
        } else if (session.role === 'SOLVER') {
          const unreadCount = getUnreadMessageCount();
          authenticatedItems.push(
            { key: 'challenges', label: 'Ú†Ø§Ù„Ø´â€ŒÙ‡Ø§', icon: 'ğŸ¯' },
            { key: 'my-submissions', label: 'Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯Ø§Øª Ù…Ù†', icon: 'ğŸ“‹' },
            { key: 'messages', label: unreadCount > 0 ? `Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ (${unreadCount})` : 'Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§', icon: 'ğŸ’¬' },
            { key: 'profile', label: 'Ù¾Ø±ÙˆÙØ§ÛŒÙ„', icon: 'ğŸ‘¤' },
            { key: 'testa-home', label: 'TESTA', icon: 'ğŸª' },
            { key: 'testa-schedule', label: 'Ø¨Ø±Ù†Ø§Ù…Ù‡ TESTA', icon: 'ğŸ“…' },
            { key: 'testa-events', label: 'Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ÛŒ TESTA', icon: 'ğŸ¤' },
            { key: 'testa-booths', label: 'Ù†Ù…Ø§ÛŒØ´Ú¯Ø§Ù‡â€ŒÙ‡Ø§', icon: 'ğŸª' },
            { key: 'testa-stats', label: 'Ø¢Ù…Ø§Ø± TESTA', icon: 'ğŸ“Š' }
          );
        }

        return authenticatedItems;
      };

      const navItems = getNavItems();

      const handleLogout = () => {
        if (confirm('Ø¢ÛŒØ§ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø§Ø² Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø®Ø§Ø±Ø¬ Ø´ÙˆÛŒØ¯ØŸ')) {
          storage.set(KEYS.session, null);
          onLogout();
          navigate('home');
        }
      };

      return (
        <nav className={`bg-white border-b border-gray-200 shadow-sm ${kioskMode?.isKioskMode ? 'h-20 text-lg' : ''}`}>
          <div className={`${kioskMode?.isKioskMode ? 'max-w-7xl' : 'max-w-5xl'} mx-auto px-6`}>
            <div className={`flex items-center justify-between ${kioskMode?.isKioskMode ? 'h-20' : 'h-16'}`}>
              <div className="flex items-center">
                <button
                  onClick={() => navigate('home')}
                  className="text-xl font-bold text-gray-900 hover:text-blue-600 transition-colors focus-ring"
                  aria-label="Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ"
                >
                  Ù¾Ù„ØªÙØ±Ù… Ù†ÙˆØ¢ÙˆØ±ÛŒ Ø¨Ø§Ø²
                </button>

                {/* Mobile Menu Toggle */}
                <button
                  onClick={() => setMobileMenuOpen(!mobileMenuOpen)}
                  className="md:hidden ml-4 p-2 rounded-md text-gray-600 hover:text-gray-900 hover:bg-gray-100 focus-ring"
                  aria-label="Ù…Ù†ÙˆÛŒ Ù†Ø§ÙˆØ¨Ø±ÛŒ"
                  aria-expanded={mobileMenuOpen}
                >
                  <span className="sr-only">Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ù…Ù†Ùˆ</span>
                  <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d={mobileMenuOpen ? "M6 18L18 6M6 6l12 12" : "M4 6h16M4 12h16M4 18h16"} />
                  </svg>
                </button>
              </div>
              
              <div className="flex items-center space-x-reverse space-x-4">
                {/* Desktop Navigation Items */}
                <div className="hidden md:flex space-x-reverse space-x-6">
                  {navItems.map(item => (
                    <button
                      key={item.key}
                      onClick={() => navigate(item.key)}
                      className={`touch-target flex items-center px-3 py-2 rounded-md text-sm font-medium transition-colors focus-ring ${
                        currentRoute === item.key
                          ? 'bg-blue-100 text-blue-700'
                          : 'text-gray-600 hover:text-gray-900 hover:bg-gray-50'
                      }`}
                      aria-current={currentRoute === item.key ? 'page' : undefined}
                      aria-label={`Ø±ÙØªÙ† Ø¨Ù‡ ${item.label}`}
                    >
                      <span className="ml-2" aria-hidden="true">{item.icon}</span>
                      {item.label}
                    </button>
                  ))}
                </div>

                {/* User Info & Auth */}
                <div className="border-r border-gray-200 pr-4">
                  {session ? (
                    <div className="flex items-center space-x-reverse space-x-3">
                      <div className="text-left">
                        <div className="text-sm font-medium text-gray-900">
                          {kioskMode?.isKioskMode ? maskEmail(session.name) : session.name}
                        </div>
                        <div className="text-xs text-gray-500">
                          {session.role === 'ADMIN' && 'Ù…Ø¯ÛŒØ± Ø³ÛŒØ³ØªÙ…'}
                          {session.role === 'SEEKER' && 'Ø¬Ø³ØªØ¬ÙˆÚ¯Ø±'}
                          {session.role === 'SOLVER' && 'Ø­Ù„â€ŒÚ©Ù†Ù†Ø¯Ù‡'}
                        </div>
                      </div>
                      <button
                        onClick={handleLogout}
                        className={`touch-target p-2 rounded-md transition-colors focus-ring ${
                          kioskMode?.isKioskMode
                            ? 'text-gray-300 cursor-not-allowed'
                            : 'text-gray-500 hover:text-red-600 hover:bg-red-50'
                        }`}
                        title={kioskMode?.isKioskMode ? "Ø¯Ø± Ø­Ø§Ù„Øª Ú©ÛŒÙˆØ³Ú© ØºÛŒØ±ÙØ¹Ø§Ù„" : "Ø®Ø±ÙˆØ¬"}
                        disabled={kioskMode?.isKioskMode}
                        aria-label="Ø®Ø±ÙˆØ¬ Ø§Ø² Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ"
                      >
                        ğŸšª
                      </button>
                    </div>
                  ) : (
                    <div className="flex items-center space-x-reverse space-x-2">
                      <button
                        onClick={() => navigate('login')}
                        className="px-3 py-1 text-sm text-gray-600 hover:text-gray-900"
                      >
                        ÙˆØ±ÙˆØ¯
                      </button>
                      <button
                        onClick={() => navigate('register')}
                        className="px-3 py-1 text-sm bg-blue-600 text-white rounded hover:bg-blue-700"
                      >
                        Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…
                      </button>
                    </div>
                  )}
                </div>
              </div>

              {/* Mobile Menu Overlay */}
              {mobileMenuOpen && (
                <div className="md:hidden fixed inset-0 top-16 bg-white border-t border-gray-200 z-40">
                  <div className="px-4 py-6 space-y-4">
                    {/* Mobile Navigation Items */}
                    {navItems.map(item => (
                      <button
                        key={item.key}
                        onClick={() => {
                          navigate(item.key);
                          setMobileMenuOpen(false);
                        }}
                        className={`w-full touch-target flex items-center px-4 py-3 rounded-lg text-base font-medium transition-colors focus-ring ${
                          currentRoute === item.key
                            ? 'bg-blue-100 text-blue-700'
                            : 'text-gray-700 hover:text-gray-900 hover:bg-gray-50'
                        }`}
                        aria-current={currentRoute === item.key ? 'page' : undefined}
                      >
                        <span className="ml-3" aria-hidden="true">{item.icon}</span>
                        {item.label}
                      </button>
                    ))}

                    {/* Mobile Auth Section */}
                    {session && (
                      <div className="border-t border-gray-200 pt-4 mt-4">
                        <div className="flex items-center space-x-reverse space-x-3 mb-4">
                          <div className="text-left">
                            <div className="text-sm font-medium text-gray-900">
                              {kioskMode?.isKioskMode ? maskEmail(session.name) : session.name}
                            </div>
                            <div className="text-xs text-gray-500">
                              {session.role === 'ADMIN' && 'Ù…Ø¯ÛŒØ± Ø³ÛŒØ³ØªÙ…'}
                              {session.role === 'SEEKER' && 'Ø¬Ø³ØªØ¬ÙˆÚ¯Ø±'}
                              {session.role === 'SOLVER' && 'Ø­Ù„â€ŒÚ©Ù†Ù†Ø¯Ù‡'}
                            </div>
                          </div>
                        </div>
                        <button
                          onClick={() => {
                            onLogout();
                            setMobileMenuOpen(false);
                          }}
                          className={`w-full touch-target p-3 rounded-lg transition-colors focus-ring ${
                            kioskMode?.isKioskMode
                              ? 'text-gray-300 cursor-not-allowed'
                              : 'text-red-600 hover:bg-red-50 hover:text-red-700'
                          }`}
                          disabled={kioskMode?.isKioskMode}
                          aria-label="Ø®Ø±ÙˆØ¬ Ø§Ø² Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ"
                        >
                          ğŸšª Ø®Ø±ÙˆØ¬
                        </button>
                      </div>
                    )}

                    {!session && (
                      <div className="border-t border-gray-200 pt-4 mt-4 space-y-3">
                        <button
                          onClick={() => {
                            navigate('login');
                            setMobileMenuOpen(false);
                          }}
                          className="w-full touch-target p-3 rounded-lg bg-blue-600 text-white hover:bg-blue-700 transition-colors focus-ring"
                          aria-label="ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ"
                        >
                          ğŸšª ÙˆØ±ÙˆØ¯
                        </button>
                        <button
                          onClick={() => {
                            navigate('register');
                            setMobileMenuOpen(false);
                          }}
                          className="w-full touch-target p-3 rounded-lg bg-gray-600 text-white hover:bg-gray-700 transition-colors focus-ring"
                          aria-label="Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÛŒØ¯"
                        >
                          Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…
                        </button>
                      </div>
                    )}
                  </div>
                </div>
              )}
            </div>
          </div>
        </nav>
      );
    }

    // ================================
    // --- UI COMPONENTS ---
    // ================================
    
    // Loading Spinner Component
    function LoadingSpinner({ size = 'md', className = '' }) {
      const sizeClasses = {
        sm: 'w-4 h-4',
        md: 'w-6 h-6',
        lg: 'w-8 h-8',
        xl: 'w-12 h-12'
      };
      
      return (
        <div className={`animate-spin rounded-full border-2 border-current border-t-transparent ${sizeClasses[size]} ${className}`} aria-hidden="true" />
      );
    }
    
    // Button with Loading State
    function ButtonLoader({ children, loading = false, disabled = false, className = '', ...props }) {
      return (
        <button
          {...props}
          disabled={loading || disabled}
          className={`relative inline-flex items-center justify-center gap-2 transition-all duration-200 focus-ring ${className} ${loading || disabled ? 'cursor-not-allowed opacity-70' : ''}`}
        >
          {loading && (
            <LoadingSpinner size="sm" className="absolute" />
          )}
          <span className={loading ? 'opacity-0' : 'opacity-100'}>
            {children}
          </span>
        </button>
      );
    }
    
    // Fullscreen Page Loader using the primary LoadingSpinner
    function PageLoader({ message = 'Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...' }) {
      return (
        <div className="fixed inset-0 bg-white bg-opacity-90 flex items-center justify-center z-50">
          <div className="text-center">
            <LoadingSpinner size="xl" className="mx-auto mb-4" />
            <p className="text-gray-600 text-lg">{message}</p>
          </div>
        </div>
      );
    }
    
    // Form Field Component
    function FormField({ label, required = false, error, hint, children, className = '' }) {
      const fieldId = React.useId();
      
      return (
        <div className={`space-y-2 ${className}`}>
          {label && (
            <label 
              htmlFor={fieldId} 
              className={`block text-sm font-medium ${error ? 'text-red-700' : 'text-gray-700'}`}
            >
              {label}
              {required && <span className="text-red-500 mr-1" aria-label="Ø¶Ø±ÙˆØ±ÛŒ">*</span>}
            </label>
          )}
          {React.cloneElement(children, { id: fieldId, 'aria-invalid': !!error })}
          {error && (
            <p className="text-sm text-red-600 flex items-center gap-1" role="alert">
              <span aria-hidden="true">âš ï¸</span>
              {error}
            </p>
          )}
          {hint && !error && (
            <p className="text-sm text-gray-500">{hint}</p>
          )}
        </div>
      );
    }
    
    // Enhanced Text Input Component
    function TextInput({ 
      type = 'text', 
      value = '', 
      onChange, 
      error = false, 
      disabled = false,
      placeholder = '', 
      className = '',
      'aria-describedby': ariaDescribedBy,
      ...props 
    }) {
      const [focused, setFocused] = React.useState(false);
      const [showPassword, setShowPassword] = React.useState(false);
      
      const isPassword = type === 'password';
      const inputType = isPassword && showPassword ? 'text' : type;
      
      return (
        <div className="relative">
          <input
            {...props}
            type={inputType}
            value={value}
            onChange={onChange}
            disabled={disabled}
            placeholder={placeholder}
            className={`
              w-full px-4 py-3 border-2 rounded-lg transition-all duration-200
              ${error 
                ? 'border-red-300 focus:border-red-500 focus:ring-2 focus:ring-red-200' 
                : focused 
                  ? 'border-blue-500 focus:border-blue-500 focus:ring-2 focus:ring-blue-200'
                  : 'border-gray-300 hover:border-gray-400 focus:border-blue-500 focus:ring-2 focus:ring-blue-200'
              }
              ${disabled ? 'bg-gray-50 text-gray-500 cursor-not-allowed' : 'bg-white'}
              ${className}
            `}
            onFocus={() => setFocused(true)}
            onBlur={() => setFocused(false)}
            aria-describedby={ariaDescribedBy}
          />
          
          {/* Password visibility toggle */}
          {isPassword && value && (
            <button
              type="button"
              onClick={() => setShowPassword(!showPassword)}
              className="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700 focus:outline-none focus:text-gray-700"
              aria-label={showPassword ? 'Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±' : 'Ù†Ù…Ø§ÛŒØ´ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±'}
              tabIndex={0}
            >
              {showPassword ? 'ğŸ™ˆ' : 'ğŸ‘ï¸'}
            </button>
          )}
          
          {/* Loading indicator for async validation */}
          {props.validating && (
            <div className="absolute left-3 top-1/2 transform -translate-y-1/2">
              <LoadingSpinner size="sm" className="text-blue-500" />
            </div>
          )}
        </div>
      );
    }
    
    // Toast Notification Component
    function ToastContainer({ toasts, onRemoveToast }) {
      return (
        <div className="fixed top-4 right-4 z-50 space-y-2" role="alert" aria-live="polite">
          {toasts.map((toast) => (
            <Toast key={toast.id} toast={toast} onRemove={() => onRemoveToast(toast.id)} />
          ))}
        </div>
      );
    }
    
    function Toast({ toast, onRemove }) {
      React.useEffect(() => {
        if (toast.autoRemove !== false) {
          const timer = setTimeout(onRemove, toast.duration || 5000);
          return () => clearTimeout(timer);
        }
      }, [toast, onRemove]);
      
      const typeClasses = {
        success: 'bg-green-500 text-white',
        error: 'bg-red-500 text-white',
        warning: 'bg-yellow-500 text-white',
        info: 'bg-blue-500 text-white'
      };
      
      const icons = {
        success: 'âœ…',
        error: 'âŒ',
        warning: 'âš ï¸',
        info: 'â„¹ï¸'
      };
      
      return (
        <div className={`
          animate-slide-in-right p-4 rounded-lg shadow-lg max-w-sm w-full
          ${typeClasses[toast.type] || typeClasses.info}
        `}>
          <div className="flex items-center justify-between">
            <div className="flex items-center gap-2">
              <span aria-hidden="true">{icons[toast.type] || icons.info}</span>
              <span className="font-medium">{toast.message}</span>
            </div>
            <button
              onClick={onRemove}
              className="text-white hover:text-gray-200 focus:outline-none focus:text-gray-200"
              aria-label="Ø¨Ø³ØªÙ† Ø§Ø¹Ù„Ø§Ù†"
            >
              âœ•
            </button>
          </div>
        </div>
      );
    }
    
    // Skeleton Loader Component
    function SkeletonLoader({ className = '', lines = 3, avatar = false }) {
      return (
        <div className={`animate-pulse ${className}`}>
          {avatar && (
            <div className="flex items-center space-x-4 space-x-reverse mb-4">
              <div className="w-12 h-12 bg-gray-300 rounded-full"></div>
              <div className="flex-1">
                <div className="h-4 bg-gray-300 rounded w-1/2 mb-2"></div>
                <div className="h-3 bg-gray-300 rounded w-1/3"></div>
              </div>
            </div>
          )}
          <div className="space-y-3">
            {Array.from({ length: lines }).map((_, i) => (
              <div key={i} className={`h-4 bg-gray-300 rounded ${
                i === lines - 1 ? 'w-2/3' : 'w-full'
              }`}></div>
            ))}
          </div>
        </div>
      );
    }
    
    // Progress Indicator Component
    function ProgressBar({ progress, className = '', showPercentage = true }) {
      return (
        <div className={`w-full bg-gray-200 rounded-full overflow-hidden ${className}`}>
          <div 
            className="h-2 bg-blue-600 rounded-full transition-all duration-300 ease-out"
            style={{ width: `${Math.min(100, Math.max(0, progress))}%` }}
            role="progressbar"
            aria-valuenow={progress}
            aria-valuemin="0"
            aria-valuemax="100"
          >
            {showPercentage && (
              <span className="sr-only">{Math.round(progress)}% ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯Ù‡</span>
            )}
          </div>
        </div>
      );
    }
    
    // Enhanced Modal Component
    function Modal({ isOpen, onClose, title, children, size = 'md', className = '' }) {
      const [isAnimating, setIsAnimating] = React.useState(false);
      
      const sizeClasses = {
        sm: 'max-w-md',
        md: 'max-w-lg',
        lg: 'max-w-2xl',
        xl: 'max-w-4xl'
      };
      
      const modalRef = React.useRef(null);
      const removeFocusTrap = React.useRef(null);
      
      React.useEffect(() => {
        if (isOpen) {
          setIsAnimating(true);
          document.body.style.overflow = 'hidden';
          
          // Save focus and set up focus trap
          focusManager.saveFocus();
          
          // Set up focus trap after modal renders
          setTimeout(() => {
            if (modalRef.current) {
              removeFocusTrap.current = focusManager.trapFocus(modalRef.current);
            }
          }, 100);
        } else {
          document.body.style.overflow = 'unset';
          
          // Remove focus trap and restore focus
          if (removeFocusTrap.current) {
            removeFocusTrap.current();
            removeFocusTrap.current = null;
          }
          focusManager.restoreFocus();
        }
        
        return () => {
          document.body.style.overflow = 'unset';
          if (removeFocusTrap.current) {
            removeFocusTrap.current();
          }
        };
      }, [isOpen]);
      
      React.useEffect(() => {
        const handleEscape = (e) => {
          if (e.key === 'Escape' && isOpen) {
            onClose();
          }
        };
        
        if (isOpen) {
          document.addEventListener('keydown', handleEscape);
        }
        
        return () => {
          document.removeEventListener('keydown', handleEscape);
        };
      }, [isOpen, onClose]);
      
      if (!isOpen) return null;
      
      return (
        <div 
          className={`fixed inset-0 z-50 flex items-center justify-center p-4 ${isAnimating ? 'animate-fade-in' : ''}`}
          onClick={(e) => e.target === e.currentTarget && onClose()}
          role="dialog"
          aria-modal="true"
          aria-labelledby={title ? 'modal-title' : undefined}
        >
          {/* Backdrop */}
          <div className="absolute inset-0 bg-black bg-opacity-50 animate-fade-in"></div>
          
          {/* Modal Content */}
          <div 
            ref={modalRef}
            className={`relative bg-white rounded-xl shadow-xl w-full animate-scale-in ${sizeClasses[size]} ${className}`}
          >
            {/* Header */}
            {title && (
              <div className="flex items-center justify-between p-6 border-b border-gray-200">
                <h2 id="modal-title" className="text-xl font-semibold text-gray-900">
                  {title}
                </h2>
                <button
                  onClick={onClose}
                  className="text-gray-400 hover:text-gray-600 focus:outline-none focus:text-gray-600 transition-colors"
                  aria-label="Ø¨Ø³ØªÙ†"
                >
                  <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                  </svg>
                </button>
              </div>
            )}
            
            {/* Content */}
            <div className="p-6">
              {children}
            </div>
          </div>
        </div>
      );
    }
    
    // ================================
    // --- AUTH COMPONENTS ---
    // ================================
    function LoginForm({ onLogin }) {
      const [email, setEmail] = React.useState('');
      const [password, setPassword] = React.useState('');
      const [error, setError] = React.useState('');
      const [loading, setLoading] = React.useState(false);

      // Demo accounts for quick testing
      const demoAccounts = [
        { email: 'admin@platform.ir', password: '123456', role: 'ADMIN', label: 'Ù…Ø¯ÛŒØ± Ø³ÛŒØ³ØªÙ…' },
        { email: 'info@parstech.ir', password: '123456', role: 'SEEKER', label: 'Ù¾Ø§Ø±Ø³â€ŒØªÚ© (Ø¬Ø³ØªØ¬ÙˆÚ¯Ø±)' },
        { email: 'a.mohammadi@university.ac.ir', password: '123456', role: 'SOLVER', label: 'Ø§Ù…ÛŒØ± Ù…Ø­Ù…Ø¯ÛŒ (Ø­Ù„â€ŒÚ©Ù†Ù†Ø¯Ù‡)' },
        { email: 'sara.ahmadi@tech.ir', password: '123456', role: 'SOLVER', label: 'Ø³Ø§Ø±Ø§ Ø§Ø­Ù…Ø¯ÛŒ (Ø­Ù„â€ŒÚ©Ù†Ù†Ø¯Ù‡)' }
      ];

      const fillDemo = (account) => {
        setEmail(account.email);
        setPassword(account.password);
        setError('');
      };

      const handleSubmit = async (e) => {
        e.preventDefault();
        setLoading(true);
        setError('');

        try {
          // Get users from localStorage
          const users = storage.get(KEYS.users, []);
          console.log('Login attempt - Email:', email, 'Users found:', users.length);

          const user = users.find(u => u.email === email && u.password === password);
          if (!user) {
            console.log('User not found. Available users:', users.map(u => ({email: u.email, role: u.role})));
          }

          if (!user) {
            setError('Ø§ÛŒÙ…ÛŒÙ„ ÛŒØ§ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø§Ø´ØªØ¨Ø§Ù‡ Ø§Ø³Øª');
            return;
          }

          // Set session
          const session = {
            userId: user.id,
            email: user.email,
            name: user.name,
            role: user.role,
            orgId: user.orgId || null,
            loginAt: new Date().toISOString()
          };

          storage.set(KEYS.session, session);
          onLogin(session);

        } catch (err) {
          setError('Ø®Ø·Ø§ Ø¯Ø± ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø³ÛŒØ³ØªÙ…');
        } finally {
          setLoading(false);
        }
      };

      // Debug: verify component references
      try {
        console.debug('LoginForm render - component types:', {
          FormField: typeof FormField,
          TextInput: typeof TextInput,
          ButtonLoader: typeof ButtonLoader
        });
      } catch (e) {
        console.warn('LoginForm debug failed:', e);
      }

      return (
        <div className="max-w-md mx-auto">
          <div className="bg-white rounded-xl shadow-lg p-8">
            <div className="text-center mb-6">
              <h2 className="text-2xl font-bold text-gray-900 mb-2">ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø³ÛŒØ³ØªÙ…</h2>
              <p className="text-gray-600">Ø¨Ù‡ Ù¾Ù„ØªÙØ±Ù… Ù†ÙˆØ¢ÙˆØ±ÛŒ Ø¨Ø§Ø² ØªØ³ØªØ§ Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯</p>
            </div>

            {/* Demo Accounts */}
            <div className="mb-6 p-4 bg-blue-50 rounded-lg">
              <h3 className="font-medium text-blue-800 mb-3">Ø­Ø³Ø§Ø¨â€ŒÙ‡Ø§ÛŒ Ù†Ù…ÙˆÙ†Ù‡:</h3>
              <div className="space-y-2">
                {demoAccounts.map((account, index) => (
                  <button
                    key={index}
                    onClick={() => fillDemo(account)}
                    className="w-full text-right p-2 text-sm bg-white border border-blue-200 rounded hover:bg-blue-50 transition-colors"
                  >
                    <div className="font-medium text-blue-900">{account.label}</div>
                    <div className="text-blue-600 text-xs">{account.email}</div>
                  </button>
                ))}
              </div>
            </div>

            <form onSubmit={handleSubmit} className="space-y-4" noValidate>
              <FormField
                label="Ø§ÛŒÙ…ÛŒÙ„"
                required
                error={error && error.includes('Ø§ÛŒÙ…ÛŒÙ„') ? error : undefined}
              >
                <TextInput
                  id="login-email"
                  type="email"
                  value={email}
                  onChange={(e) => {
                    setEmail(e.target.value);
                    if (error) setError('');
                  }}
                  error={error && error.includes('Ø§ÛŒÙ…ÛŒÙ„')}
                  placeholder="email@example.com"
                  autoComplete="email"
                  aria-describedby="login-email-help"
                />
                <div id="login-email-help" className="sr-only">
                  Ø¢Ø¯Ø±Ø³ Ø§ÛŒÙ…ÛŒÙ„ Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯
                </div>
              </FormField>

              <FormField
                label="Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±"
                required
                error={error && error.includes('Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±') ? error : undefined}
              >
                <TextInput
                  id="login-password"
                  type="password"
                  value={password}
                  onChange={(e) => {
                    setPassword(e.target.value);
                    if (error) setError('');
                  }}
                  error={error && error.includes('Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±')}
                  placeholder="Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±"
                  autoComplete="current-password"
                  aria-describedby="login-password-help"
                />
                <div id="login-password-help" className="sr-only">
                  Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯
                </div>
              </FormField>

              <FormField>
                <ButtonLoader
                  type="submit"
                  loading={loading}
                  disabled={!email || !password}
                  className="w-full py-3 px-4 bg-blue-600 text-white rounded-lg hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 disabled:opacity-50 transition-colors"
                  aria-describedby="login-submit-help"
                >
                  {loading ? 'Ø¯Ø± Ø­Ø§Ù„ ÙˆØ±ÙˆØ¯...' : 'ÙˆØ±ÙˆØ¯'}
                </ButtonLoader>
                <div id="login-submit-help" className="sr-only">
                  Ø¨Ø±Ø§ÛŒ ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø³ÛŒØ³ØªÙ… Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯
                </div>
              </FormField>
            </form>

            <div className="mt-6 text-center">
              <p className="text-gray-600 text-sm">
                Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ Ù†Ø¯Ø§Ø±ÛŒØ¯ØŸ{' '}
                <button 
                  onClick={() => window.location.hash = 'register'}
                  className="text-blue-600 hover:underline"
                >
                  Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ú©Ù†ÛŒØ¯
                </button>
              </p>
            </div>
          </div>
        </div>
      );
    }

    function RegistrationForm({ type = 'solver' }) {
      const [formData, setFormData] = React.useState({
        name: '',
        email: '',
        password: '',
        confirmPassword: '',
        // Solver specific
        bio: '',
        skills: '',
        // Seeker specific (org request)
        orgName: '',
        orgDomains: '',
        orgDescription: '',
        orgWebsite: '',
        orgPhone: '',
        orgAddress: ''
      });

      const [error, setError] = React.useState('');
      const [success, setSuccess] = React.useState(false);
      const [loading, setLoading] = React.useState(false);

      const handleSubmit = async (e) => {
        e.preventDefault();
        setLoading(true);
        setError('');

        try {
          // Validation
          if (formData.password !== formData.confirmPassword) {
            setError('Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ùˆ ØªÚ©Ø±Ø§Ø± Ø¢Ù† ÛŒÚ©Ø³Ø§Ù† Ù†ÛŒØ³ØªÙ†Ø¯');
            return;
          }

          if (formData.password.length < 6) {
            setError('Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø¨Ø§ÛŒØ¯ Ø­Ø¯Ø§Ù‚Ù„ Û¶ Ú©Ø§Ø±Ø§Ú©ØªØ± Ø¨Ø§Ø´Ø¯');
            return;
          }

          const users = storage.get(KEYS.users, []);
          
          // Check if email already exists
          if (users.find(u => u.email === formData.email)) {
            setError('Ø§ÛŒÙ† Ø§ÛŒÙ…ÛŒÙ„ Ù‚Ø¨Ù„Ø§Ù‹ Ø«Ø¨Øª Ø´Ø¯Ù‡ Ø§Ø³Øª');
            return;
          }

          if (type === 'solver') {
            // Create new solver user
            const newUser = {
              id: `u-${Date.now()}`,
              role: 'SOLVER',
              email: formData.email,
              name: formData.name,
              password: formData.password,
              avatar: null,
              bio: formData.bio || 'Ø­Ù„â€ŒÚ©Ù†Ù†Ø¯Ù‡ Ø¬Ø¯ÛŒØ¯',
              skills: formData.skills ? formData.skills.split(',').map(s => s.trim()) : [],
              reputation: 0,
              createdAt: new Date().toISOString()
            };

            users.push(newUser);
            storage.set(KEYS.users, users);

            setSuccess(true);

          } else if (type === 'seeker') {
            // Create organization request (pending approval)
            const orgs = storage.get(KEYS.orgs, []);
            const newOrg = {
              id: `o-${Date.now()}`,
              name: formData.orgName,
              domains: formData.orgDomains ? formData.orgDomains.split(',').map(d => d.trim()) : [],
              description: formData.orgDescription,
              logo: null,
              website: formData.orgWebsite,
              contactInfo: {
                phone: formData.orgPhone,
                address: formData.orgAddress
              },
              status: 'pending', // Requires admin approval
              createdAt: new Date().toISOString()
            };

            // Create seeker user (also pending)
            const newUser = {
              id: `u-${Date.now()}`,
              role: 'SEEKER',
              email: formData.email,
              name: formData.name,
              password: formData.password,
              orgId: newOrg.id,
              avatar: null,
              bio: `Ù†Ù…Ø§ÛŒÙ†Ø¯Ù‡ ${formData.orgName}`,
              skills: ['Ù…Ø¯ÛŒØ±ÛŒØª', 'ØªØ¹Ø±ÛŒÙ Ú†Ø§Ù„Ø´'],
              reputation: 0,
              status: 'pending', // Requires admin approval
              createdAt: new Date().toISOString()
            };

            orgs.push(newOrg);
            users.push(newUser);
            storage.set(KEYS.orgs, orgs);
            storage.set(KEYS.users, users);

            // Create notification for admin
            const notifications = storage.get(KEYS.notifications, []);
            notifications.push({
              id: `notif-${Date.now()}`,
              type: 'org_request',
              text: `Ø¯Ø±Ø®ÙˆØ§Ø³Øª ØªØ£ÛŒÛŒØ¯ Ø³Ø§Ø²Ù…Ø§Ù† Ø¬Ø¯ÛŒØ¯: ${formData.orgName} (${formData.name})`,
              createdAt: new Date().toISOString(),
              read: false,
              userId: 'u-admin',
              targetId: newOrg.id
            });
            storage.set(KEYS.notifications, notifications);

            setSuccess(true);
          }

        } catch (err) {
          setError('Ø®Ø·Ø§ Ø¯Ø± Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…');
        } finally {
          setLoading(false);
        }
      };

      const updateField = (field, value) => {
        setFormData(prev => ({ ...prev, [field]: value }));
      };

      if (success) {
        return (
          <div className="max-w-md mx-auto">
            <div className="bg-white rounded-xl shadow-lg p-8 text-center">
              <div className="text-6xl mb-4">âœ…</div>
              <h2 className="text-2xl font-bold text-green-600 mb-4">
                {type === 'solver' ? 'Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ù…ÙˆÙÙ‚!' : 'Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯!'}
              </h2>
              <p className="text-gray-600 mb-6">
                {type === 'solver' 
                  ? 'Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø´Ù…Ø§ Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯. Ø§Ú©Ù†ÙˆÙ† Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ ÙˆØ§Ø±Ø¯ Ø´ÙˆÛŒØ¯.'
                  : 'Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø³Ø§Ø²Ù…Ø§Ù† Ø´Ù…Ø§ Ø¨Ø±Ø§ÛŒ ØªØ£ÛŒÛŒØ¯ Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯. Ù¾Ø³ Ø§Ø² ØªØ£ÛŒÛŒØ¯ Ù…Ø¯ÛŒØ± Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ ÙˆØ§Ø±Ø¯ Ø´ÙˆÛŒØ¯.'
                }
              </p>
              <button
                onClick={() => window.location.hash = 'login'}
                className="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"
              >
                Ø±ÙØªÙ† Ø¨Ù‡ ØµÙØ­Ù‡ ÙˆØ±ÙˆØ¯
              </button>
            </div>
          </div>
        );
      }

      return (
        <div className="max-w-lg mx-auto">
          <div className="bg-white rounded-xl shadow-lg p-8">
            <div className="text-center mb-6">
              <h2 className="text-2xl font-bold text-gray-900 mb-2">
                {type === 'solver' ? 'Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ø­Ù„â€ŒÚ©Ù†Ù†Ø¯Ù‡' : 'Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø³Ø§Ø²Ù…Ø§Ù†'}
              </h2>
              <p className="text-gray-600">
                {type === 'solver' 
                  ? 'Ø¨Ø±Ø§ÛŒ Ø´Ø±Ú©Øª Ø¯Ø± Ú†Ø§Ù„Ø´â€ŒÙ‡Ø§ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ú©Ù†ÛŒØ¯'
                  : 'Ø¨Ø±Ø§ÛŒ Ø§Ù†ØªØ´Ø§Ø± Ú†Ø§Ù„Ø´â€ŒÙ‡Ø§ÛŒ ÙÙ†Ø§ÙˆØ±ÛŒ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¯Ù‡ÛŒØ¯'
                }
              </p>
            </div>

            <form onSubmit={handleSubmit} className="space-y-4">
              {/* Common fields */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ
                </label>
                <input
                  type="text"
                  value={formData.name}
                  onChange={(e) => updateField('name', e.target.value)}
                  className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                  required
                />
              </div>

              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Ø§ÛŒÙ…ÛŒÙ„
                </label>
                <input
                  type="email"
                  value={formData.email}
                  onChange={(e) => updateField('email', e.target.value)}
                  className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                  required
                />
              </div>

              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±
                </label>
                <input
                  type="password"
                  value={formData.password}
                  onChange={(e) => updateField('password', e.target.value)}
                  className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                  required
                />
              </div>

              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  ØªÚ©Ø±Ø§Ø± Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±
                </label>
                <input
                  type="password"
                  value={formData.confirmPassword}
                  onChange={(e) => updateField('confirmPassword', e.target.value)}
                  className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                  required
                />
              </div>

              {/* Solver specific fields */}
              {type === 'solver' && (
                <>
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      Ù…Ø¹Ø±ÙÛŒ Ø®ÙˆØ¯ØªØ§Ù†
                    </label>
                    <textarea
                      value={formData.bio}
                      onChange={(e) => updateField('bio', e.target.value)}
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                      rows="3"
                      placeholder="Ø¯Ø±Ø¨Ø§Ø±Ù‡ ØªØ®ØµØµ Ùˆ ØªØ¬Ø±Ø¨ÛŒØ§Øª Ø®ÙˆØ¯ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯"
                    />
                  </div>

                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      Ù…Ù‡Ø§Ø±Øªâ€ŒÙ‡Ø§ (Ø¨Ø§ Ú©Ø§Ù…Ø§ Ø¬Ø¯Ø§ Ú©Ù†ÛŒØ¯)
                    </label>
                    <input
                      type="text"
                      value={formData.skills}
                      onChange={(e) => updateField('skills', e.target.value)}
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                      placeholder="Ù…Ø«Ø§Ù„: Ù¾Ø§ÛŒØªÙˆÙ†ØŒ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒØŒ ÛŒØ§Ø¯Ú¯ÛŒØ±ÛŒ Ù…Ø§Ø´ÛŒÙ†"
                    />
                  </div>
                </>
              )}

              {/* Seeker specific fields */}
              {type === 'seeker' && (
                <>
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      Ù†Ø§Ù… Ø³Ø§Ø²Ù…Ø§Ù†
                    </label>
                    <input
                      type="text"
                      value={formData.orgName}
                      onChange={(e) => updateField('orgName', e.target.value)}
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                      required
                    />
                  </div>

                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      Ø­ÙˆØ²Ù‡â€ŒÙ‡Ø§ÛŒ ÙØ¹Ø§Ù„ÛŒØª (Ø¨Ø§ Ú©Ø§Ù…Ø§ Ø¬Ø¯Ø§ Ú©Ù†ÛŒØ¯)
                    </label>
                    <input
                      type="text"
                      value={formData.orgDomains}
                      onChange={(e) => updateField('orgDomains', e.target.value)}
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                      placeholder="Ù…Ø«Ø§Ù„: Ø§Ù†Ø±Ú˜ÛŒØŒ IoTØŒ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ"
                      required
                    />
                  </div>

                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      Ù…Ø¹Ø±ÙÛŒ Ø³Ø§Ø²Ù…Ø§Ù†
                    </label>
                    <textarea
                      value={formData.orgDescription}
                      onChange={(e) => updateField('orgDescription', e.target.value)}
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                      rows="3"
                      placeholder="Ø¯Ø±Ø¨Ø§Ø±Ù‡ ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§ Ùˆ Ø§Ù‡Ø¯Ø§Ù Ø³Ø§Ø²Ù…Ø§Ù† Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯"
                      required
                    />
                  </div>

                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      ÙˆØ¨â€ŒØ³Ø§ÛŒØª
                    </label>
                    <input
                      type="url"
                      value={formData.orgWebsite}
                      onChange={(e) => updateField('orgWebsite', e.target.value)}
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                      placeholder="https://example.com"
                    />
                  </div>

                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      ØªÙ„ÙÙ† ØªÙ…Ø§Ø³
                    </label>
                    <input
                      type="tel"
                      value={formData.orgPhone}
                      onChange={(e) => updateField('orgPhone', e.target.value)}
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                      placeholder="+98-21-12345678"
                    />
                  </div>

                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      Ø¢Ø¯Ø±Ø³
                    </label>
                    <input
                      type="text"
                      value={formData.orgAddress}
                      onChange={(e) => updateField('orgAddress', e.target.value)}
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                      placeholder="Ø¢Ø¯Ø±Ø³ Ú©Ø§Ù…Ù„ Ø³Ø§Ø²Ù…Ø§Ù†"
                    />
                  </div>
                </>
              )}

              {error && (
                <div className="p-3 bg-red-50 border border-red-200 rounded-lg">
                  <p className="text-red-700 text-sm">{error}</p>
                </div>
              )}

              <button
                type="submit"
                disabled={loading}
                className="w-full py-2 px-4 bg-blue-600 text-white rounded-lg hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 disabled:opacity-50 transition-colors"
              >
                {loading ? 'Ø¯Ø± Ø­Ø§Ù„ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…...' : 'Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…'}
              </button>
            </form>

            <div className="mt-6 text-center">
              <p className="text-gray-600 text-sm">
                Ù‚Ø¨Ù„Ø§Ù‹ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ú©Ø±Ø¯Ù‡â€ŒØ§ÛŒØ¯ØŸ{' '}
                <button 
                  onClick={() => window.location.hash = 'login'}
                  className="text-blue-600 hover:underline"
                >
                  ÙˆØ§Ø±Ø¯ Ø´ÙˆÛŒØ¯
                </button>
              </p>
              
              {type === 'solver' && (
                <p className="text-gray-600 text-sm mt-2">
                  Ø³Ø§Ø²Ù…Ø§Ù† Ù‡Ø³ØªÛŒØ¯ØŸ{' '}
                  <button 
                    onClick={() => window.location.hash = 'register-seeker'}
                    className="text-blue-600 hover:underline"
                  >
                    Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø³Ø§Ø²Ù…Ø§Ù†
                  </button>
                </p>
              )}
              
              {type === 'seeker' && (
                <p className="text-gray-600 text-sm mt-2">
                  Ø­Ù„â€ŒÚ©Ù†Ù†Ø¯Ù‡ Ù‡Ø³ØªÛŒØ¯ØŸ{' '}
                  <button 
                    onClick={() => window.location.hash = 'register'}
                    className="text-blue-600 hover:underline"
                  >
                    Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ø­Ù„â€ŒÚ©Ù†Ù†Ø¯Ù‡
                  </button>
                </p>
              )}
            </div>
          </div>
        </div>
      );
    }

    // ================================
    // --- PAGE COMPONENTS ---
    // ================================
    function HomePage({ users, challenges, submissions, events, exhibitors }) {
      return (
        <div className="space-y-6">
          <header className="text-center py-8">
            <h1 className="text-3xl font-bold text-gray-900 mb-4">
              Ø¨Ù‡ Ù¾Ù„ØªÙØ±Ù… Ù†ÙˆØ¢ÙˆØ±ÛŒ Ø¨Ø§Ø² ØªØ³ØªØ§ Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯
            </h1>
            <p className="text-lg text-gray-600 max-w-2xl mx-auto">
              Ù…Ø­ÛŒØ·ÛŒ Ø¨Ø±Ø§ÛŒ Ø§Ø±ØªØ¨Ø§Ø· Ø¨ÛŒÙ† Ø´Ø±Ú©Øªâ€ŒÙ‡Ø§ Ùˆ Ù†ÙˆØ¢ÙˆØ±Ø§Ù† Ø¬Ù‡Øª Ø­Ù„ Ú†Ø§Ù„Ø´â€ŒÙ‡Ø§ÛŒ ÙÙ†Ø§ÙˆØ±ÛŒ
            </p>
          </header>

          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <div className="bg-gradient-to-br from-blue-50 to-blue-100 p-6 rounded-xl">
              <div className="flex items-center justify-between mb-4">
                <h3 className="font-semibold text-blue-800">Ú©Ø§Ø±Ø¨Ø±Ø§Ù†</h3>
                <span className="text-2xl">ğŸ‘¥</span>
              </div>
              <p className="text-3xl font-bold text-blue-900">{users.length}</p>
              <p className="text-sm text-blue-600">Ú©Ø§Ø±Ø¨Ø± ÙØ¹Ø§Ù„</p>
            </div>

            <div className="bg-gradient-to-br from-green-50 to-green-100 p-6 rounded-xl">
              <div className="flex items-center justify-between mb-4">
                <h3 className="font-semibold text-green-800">Ú†Ø§Ù„Ø´â€ŒÙ‡Ø§</h3>
                <span className="text-2xl">ğŸ¯</span>
              </div>
              <p className="text-3xl font-bold text-green-900">{challenges.length}</p>
              <p className="text-sm text-green-600">Ú†Ø§Ù„Ø´ ÙØ¹Ø§Ù„</p>
            </div>

            <div className="bg-gradient-to-br from-purple-50 to-purple-100 p-6 rounded-xl">
              <div className="flex items-center justify-between mb-4">
                <h3 className="font-semibold text-purple-800">Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯Ø§Øª</h3>
                <span className="text-2xl">ğŸ“</span>
              </div>
              <p className="text-3xl font-bold text-purple-900">{submissions.length}</p>
              <p className="text-sm text-purple-600">Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯Ù‡</p>
            </div>

            <div className="bg-gradient-to-br from-orange-50 to-orange-100 p-6 rounded-xl">
              <div className="flex items-center justify-between mb-4">
                <h3 className="font-semibold text-orange-800">Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§</h3>
                <span className="text-2xl">ğŸ“…</span>
              </div>
              <p className="text-3xl font-bold text-orange-900">{events.length}</p>
              <p className="text-sm text-orange-600">Ø±ÙˆÛŒØ¯Ø§Ø¯ TESTA</p>
            </div>

            <div className="bg-gradient-to-br from-red-50 to-red-100 p-6 rounded-xl">
              <div className="flex items-center justify-between mb-4">
                <h3 className="font-semibold text-red-800">Ù†Ù…Ø§ÛŒØ´Ú¯Ø§Ù‡â€ŒÙ‡Ø§</h3>
                <span className="text-2xl">ğŸª</span>
              </div>
              <p className="text-3xl font-bold text-red-900">{exhibitors.length}</p>
              <p className="text-sm text-red-600">ØºØ±ÙÙ‡ Ù†Ù…Ø§ÛŒØ´Ú¯Ø§Ù‡ÛŒ</p>
            </div>

            <div className="bg-gradient-to-br from-gray-50 to-gray-100 p-6 rounded-xl">
              <div className="flex items-center justify-between mb-4">
                <h3 className="font-semibold text-gray-800">ÙˆØ¶Ø¹ÛŒØª</h3>
                <span className="text-2xl">âœ…</span>
              </div>
              <p className="text-lg font-bold text-gray-900">Ø¢Ù…Ø§Ø¯Ù‡</p>
              <p className="text-sm text-gray-600">Ø³ÛŒØ³ØªÙ… ÙØ¹Ø§Ù„</p>
            </div>
          </div>

          <div className="bg-white rounded-xl shadow p-6">
            <h2 className="font-semibold text-lg mb-4">Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ù¾Ù„ØªÙØ±Ù…</h2>
            <div className="grid md:grid-cols-2 gap-6">
              <div>
                <h3 className="font-medium mb-2">Ø¨Ø±Ø§ÛŒ Ø´Ø±Ú©Øªâ€ŒÙ‡Ø§</h3>
                <ul className="text-sm text-gray-600 space-y-1">
                  <li>â€¢ Ø§Ù†ØªØ´Ø§Ø± Ú†Ø§Ù„Ø´â€ŒÙ‡Ø§ÛŒ ÙÙ†Ø§ÙˆØ±ÛŒ</li>
                  <li>â€¢ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ù†ÙˆØ¢ÙˆØ±Ø§Ù† Ù…Ø³ØªØ¹Ø¯</li>
                  <li>â€¢ Ù…Ø¯ÛŒØ±ÛŒØª ÙØ±Ø¢ÛŒÙ†Ø¯ Ø§Ù†ØªØ®Ø§Ø¨</li>
                  <li>â€¢ Ø§Ø±ØªØ¨Ø§Ø· Ù…Ø³ØªÙ‚ÛŒÙ… Ø¨Ø§ Ø­Ù„â€ŒÚ©Ù†Ù†Ø¯Ú¯Ø§Ù†</li>
                </ul>
              </div>
              <div>
                <h3 className="font-medium mb-2">Ø¨Ø±Ø§ÛŒ Ù†ÙˆØ¢ÙˆØ±Ø§Ù†</h3>
                <ul className="text-sm text-gray-600 space-y-1">
                  <li>â€¢ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ú†Ø§Ù„Ø´â€ŒÙ‡Ø§ÛŒ Ø¬Ø°Ø§Ø¨</li>
                  <li>â€¢ Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯Ø§Øª Ø®Ù„Ø§Ù‚Ø§Ù†Ù‡</li>
                  <li>â€¢ Ú©Ø³Ø¨ Ø§Ù…ØªÛŒØ§Ø² Ùˆ Ø§Ø¹ØªØ¨Ø§Ø±</li>
                  <li>â€¢ Ø´Ø±Ú©Øª Ø¯Ø± Ù†Ù…Ø§ÛŒØ´Ú¯Ø§Ù‡ TESTA</li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      );
    }

    function ChallengesPage({ challenges, orgs }) {
      return (
        <div className="space-y-6">
          <header className="text-center py-6">
            <h1 className="text-2xl font-bold text-gray-900 mb-2">Ú†Ø§Ù„Ø´â€ŒÙ‡Ø§ÛŒ ÙÙ†Ø§ÙˆØ±ÛŒ</h1>
            <p className="text-gray-600">ÙØ±ØµØªâ€ŒÙ‡Ø§ÛŒ Ù‡Ù…Ú©Ø§Ø±ÛŒ Ùˆ Ù†ÙˆØ¢ÙˆØ±ÛŒ</p>
          </header>

          <div className="grid gap-6">
            {challenges.map(challenge => {
              const org = orgs.find(o => o.id === challenge.orgId);
              return (
                <div key={challenge.id} className="bg-white rounded-xl shadow hover:shadow-lg transition-shadow p-6">
                  <div className="flex items-start justify-between mb-4">
                    <div className="flex-1">
                      <h3 className="text-lg font-semibold text-gray-900 mb-2">
                        {challenge.title}
                      </h3>
                      <p className="text-sm text-gray-600 mb-1">
                        {org?.name || 'Ø³Ø§Ø²Ù…Ø§Ù† Ù†Ø§Ù…Ø´Ø®Øµ'}
                      </p>
                      <div className="flex items-center gap-2">
                        <span className="px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full">
                          {challenge.category}
                        </span>
                        <span className={`px-2 py-1 text-xs rounded-full ${
                          challenge.status === 'published' 
                            ? 'bg-green-100 text-green-800' 
                            : 'bg-gray-100 text-gray-800'
                        }`}>
                          {challenge.status === 'published' ? 'Ù…Ù†ØªØ´Ø± Ø´Ø¯Ù‡' : challenge.status}
                        </span>
                      </div>
                    </div>
                    <div className="text-left">
                      <div className="text-lg font-bold text-green-600">
                        {challenge.reward.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù†
                      </div>
                      {challenge.deadline && (
                        <div className="text-xs text-gray-500 mt-1">
                          Ù…Ù‡Ù„Øª: {new Date(challenge.deadline).toLocaleDateString('fa-IR')}
                        </div>
                      )}
                    </div>
                  </div>

                  <p className="text-gray-700 mb-4 leading-relaxed">
                    {challenge.problem}
                  </p>

                  {challenge.success && (
                    <div className="mb-4 p-3 bg-green-50 rounded-lg">
                      <h4 className="font-medium text-green-800 mb-1">Ù…Ø¹ÛŒØ§Ø±Ù‡Ø§ÛŒ Ù…ÙˆÙÙ‚ÛŒØª:</h4>
                      <p className="text-green-700 text-sm">{challenge.success}</p>
                    </div>
                  )}

                  <div className="flex items-center justify-between">
                    <div className="flex flex-wrap gap-1">
                      {challenge.tags?.map(tag => (
                        <span key={tag} className="px-2 py-1 bg-gray-100 text-gray-700 text-xs rounded">
                          {tag}
                        </span>
                      ))}
                    </div>
                    <button className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                      Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø¬Ø²Ø¦ÛŒØ§Øª
                    </button>
                  </div>
                </div>
              );
            })}
          </div>

          {challenges.length === 0 && (
            <div className="text-center py-12">
              <div className="text-4xl mb-4">ğŸ¯</div>
              <p className="text-gray-500">Ù‡ÛŒÚ† Ú†Ø§Ù„Ø´ÛŒ Ø¯Ø± Ø­Ø§Ù„ Ø­Ø§Ø¶Ø± Ù…Ù†ØªØ´Ø± Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª</p>
            </div>
          )}
        </div>
      );
    }

    function TESTAPage({ events, exhibitors }) {
      // Redirect to new TESTA Home page
      React.useEffect(() => {
        window.location.hash = 'testa-home';
      }, []);

      return (
        <div className="text-center py-12">
          <div className="text-4xl mb-4">ğŸ”„</div>
          <p className="text-gray-500">Ø¯Ø± Ø­Ø§Ù„ Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨Ù‡ ØµÙØ­Ù‡ Ø¬Ø¯ÛŒØ¯ TESTA...</p>
        </div>
      );
    }

    // ================================
    // --- PROFILE COMPONENTS ---
    // ================================
    function SolverProfile({ user }) {
      return (
        <div className="space-y-6">
          <header className="text-center py-6">
            <h1 className="text-2xl font-bold text-gray-900 mb-2">Ù¾Ø±ÙˆÙØ§ÛŒÙ„ Ø­Ù„â€ŒÚ©Ù†Ù†Ø¯Ù‡</h1>
            <p className="text-gray-600">{user.name}</p>
          </header>

          <div className="grid md:grid-cols-2 gap-6">
            {/* Basic Info */}
            <div className="bg-white rounded-xl shadow p-6">
              <h2 className="text-lg font-semibold mb-4">Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù¾Ø§ÛŒÙ‡</h2>
              <div className="space-y-3">
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ</label>
                  <p className="text-gray-900">{user.name}</p>
                </div>
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">Ø§ÛŒÙ…ÛŒÙ„</label>
                  <p className="text-gray-900">{user.email}</p>
                </div>
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">Ø§Ù…ØªÛŒØ§Ø² Ø§Ø¹ØªØ¨Ø§Ø±</label>
                  <p className="text-gray-900">{user.reputation || 0}</p>
                </div>
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">ÙˆØ¶Ø¹ÛŒØª</label>
                  <span className={`px-2 py-1 text-xs rounded-full ${
                    user.status === 'approved' ? 'bg-green-100 text-green-800' :
                    user.status === 'pending' ? 'bg-yellow-100 text-yellow-800' :
                    'bg-gray-100 text-gray-800'
                  }`}>
                    {user.status === 'approved' ? 'ØªØ£ÛŒÛŒØ¯ Ø´Ø¯Ù‡' :
                     user.status === 'pending' ? 'Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± ØªØ£ÛŒÛŒØ¯' :
                     user.status || 'ÙØ¹Ø§Ù„'}
                  </span>
                </div>
              </div>
            </div>

            {/* Bio & Skills */}
            <div className="bg-white rounded-xl shadow p-6">
              <h2 className="text-lg font-semibold mb-4">Ø¨ÛŒÙˆÚ¯Ø±Ø§ÙÛŒ Ùˆ Ù…Ù‡Ø§Ø±Øªâ€ŒÙ‡Ø§</h2>
              <div className="space-y-3">
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ù…Ù†</label>
                  <p className="text-gray-700 leading-relaxed">
                    {user.bio || 'Ø¨ÛŒÙˆÚ¯Ø±Ø§ÙÛŒ ÙˆØ§Ø±Ø¯ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.'}
                  </p>
                </div>
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">Ù…Ù‡Ø§Ø±Øªâ€ŒÙ‡Ø§</label>
                  <div className="flex flex-wrap gap-1">
                    {user.skills?.length > 0 ? (
                      user.skills.map((skill, index) => (
                        <span key={index} className="px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded">
                          {skill}
                        </span>
                      ))
                    ) : (
                      <p className="text-gray-500 text-sm">Ù…Ù‡Ø§Ø±ØªÛŒ ÙˆØ§Ø±Ø¯ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</p>
                    )}
                  </div>
                </div>
              </div>
            </div>
          </div>

          {/* Portfolio/Projects */}
          <div className="bg-white rounded-xl shadow p-6">
            <h2 className="text-lg font-semibold mb-4">Ù¾ÙˆØ±ØªÙÙˆÙ„ÛŒÙˆ</h2>
            <div className="text-center py-8">
              <div className="text-4xl mb-4">ğŸ“</div>
              <p className="text-gray-500">Ù¾ÙˆØ±ØªÙÙˆÙ„ÛŒÙˆ Ø¯Ø± Ù…Ø±Ø­Ù„Ù‡ Ø¨Ø¹Ø¯ÛŒ Ø§Ø¶Ø§ÙÙ‡ Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯</p>
              <p className="text-sm text-gray-400 mt-2">Ø´Ø§Ù…Ù„ Ù¾Ø±ÙˆÚ˜Ù‡â€ŒÙ‡Ø§ÛŒ Ù‚Ø¨Ù„ÛŒØŒ Ú¯ÙˆØ§Ù‡ÛŒâ€ŒÙ†Ø§Ù…Ù‡â€ŒÙ‡Ø§ Ùˆ Ù†Ù…ÙˆÙ†Ù‡ Ú©Ø§Ø±Ù‡Ø§</p>
            </div>
          </div>
        </div>
      );
    }

    function SeekerProfile({ user, org }) {
      if (!org) {
        return (
          <div className="text-center py-12">
            <div className="text-4xl mb-4">ğŸ¢</div>
            <p className="text-gray-500">Ø³Ø§Ø²Ù…Ø§Ù† ÛŒØ§ÙØª Ù†Ø´Ø¯</p>
          </div>
        );
      }

      return (
        <div className="space-y-6">
          <header className="text-center py-6">
            <h1 className="text-2xl font-bold text-gray-900 mb-2">Ù¾Ø±ÙˆÙØ§ÛŒÙ„ Ø³Ø§Ø²Ù…Ø§Ù†</h1>
            <p className="text-gray-600">{org.name}</p>
          </header>

          <div className="grid md:grid-cols-2 gap-6">
            {/* Organization Info */}
            <div className="bg-white rounded-xl shadow p-6">
              <h2 className="text-lg font-semibold mb-4">Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø³Ø§Ø²Ù…Ø§Ù†</h2>
              <div className="space-y-3">
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">Ù†Ø§Ù… Ø³Ø§Ø²Ù…Ø§Ù†</label>
                  <p className="text-gray-900">{org.name}</p>
                </div>
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">Ø­ÙˆØ²Ù‡â€ŒÙ‡Ø§ÛŒ ÙØ¹Ø§Ù„ÛŒØª</label>
                  <div className="flex flex-wrap gap-1">
                    {org.domains?.map((domain, index) => (
                      <span key={index} className="px-2 py-1 bg-green-100 text-green-800 text-xs rounded">
                        {domain}
                      </span>
                    ))}
                  </div>
                </div>
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">ÙˆØ¨â€ŒØ³Ø§ÛŒØª</label>
                  <p className="text-gray-900">
                    {org.website ? (
                      <a href={org.website} className="text-blue-600 hover:underline" target="_blank">
                        {org.website}
                      </a>
                    ) : 'ÙˆØ¨â€ŒØ³Ø§ÛŒØª ÙˆØ§Ø±Ø¯ Ù†Ø´Ø¯Ù‡'}
                  </p>
                </div>
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">ÙˆØ¶Ø¹ÛŒØª</label>
                  <span className={`px-2 py-1 text-xs rounded-full ${
                    org.status === 'approved' ? 'bg-green-100 text-green-800' :
                    org.status === 'pending' ? 'bg-yellow-100 text-yellow-800' :
                    'bg-red-100 text-red-800'
                  }`}>
                    {org.status === 'approved' ? 'ØªØ£ÛŒÛŒØ¯ Ø´Ø¯Ù‡' :
                     org.status === 'pending' ? 'Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± ØªØ£ÛŒÛŒØ¯' :
                     org.status === 'rejected' ? 'Ø±Ø¯ Ø´Ø¯Ù‡' :
                     org.status}
                  </span>
                </div>
              </div>
            </div>

            {/* Contact Info */}
            <div className="bg-white rounded-xl shadow p-6">
              <h2 className="text-lg font-semibold mb-4">Ø§Ø·Ù„Ø§Ø¹Ø§Øª ØªÙ…Ø§Ø³</h2>
              <div className="space-y-3">
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">Ù†Ù…Ø§ÛŒÙ†Ø¯Ù‡</label>
                  <p className="text-gray-900">{user.name}</p>
                </div>
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">Ø§ÛŒÙ…ÛŒÙ„</label>
                  <p className="text-gray-900">{user.email}</p>
                </div>
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">ØªÙ„ÙÙ†</label>
                  <p className="text-gray-900">{org.contactInfo?.phone || 'ØªÙ„ÙÙ† ÙˆØ§Ø±Ø¯ Ù†Ø´Ø¯Ù‡'}</p>
                </div>
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">Ø¢Ø¯Ø±Ø³</label>
                  <p className="text-gray-900">{org.contactInfo?.address || 'Ø¢Ø¯Ø±Ø³ ÙˆØ§Ø±Ø¯ Ù†Ø´Ø¯Ù‡'}</p>
                </div>
              </div>
            </div>
          </div>

          {/* About */}
          <div className="bg-white rounded-xl shadow p-6">
            <h2 className="text-lg font-semibold mb-4">Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ø³Ø§Ø²Ù…Ø§Ù†</h2>
            <p className="text-gray-700 leading-relaxed">
              {org.description || 'ØªÙˆØ¶ÛŒØ­Ø§ØªÛŒ Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ø³Ø§Ø²Ù…Ø§Ù† ÙˆØ§Ø±Ø¯ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.'}
            </p>
          </div>

          {/* Logo Placeholder */}
          <div className="bg-white rounded-xl shadow p-6">
            <h2 className="text-lg font-semibold mb-4">Ù„ÙˆÚ¯Ùˆ Ø³Ø§Ø²Ù…Ø§Ù†</h2>
            <div className="text-center py-8">
              <div className="text-6xl mb-4">ğŸ¢</div>
              <p className="text-gray-500">Ø¢Ù¾Ù„ÙˆØ¯ Ù„ÙˆÚ¯Ùˆ Ø¯Ø± Ù…Ø±Ø­Ù„Ù‡ Ø¨Ø¹Ø¯ÛŒ Ø§Ø¶Ø§ÙÙ‡ Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯</p>
            </div>
          </div>

          {/* Members */}
          <div className="bg-white rounded-xl shadow p-6">
            <h2 className="text-lg font-semibold mb-4">Ø§Ø¹Ø¶Ø§ÛŒ Ø³Ø§Ø²Ù…Ø§Ù†</h2>
            <div className="text-center py-8">
              <div className="text-4xl mb-4">ğŸ‘¥</div>
              <p className="text-gray-500">Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ø¹Ø¶Ø§ Ø¯Ø± Ù…Ø±Ø­Ù„Ù‡ Ø¨Ø¹Ø¯ÛŒ Ø§Ø¶Ø§ÙÙ‡ Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯</p>
            </div>
          </div>
        </div>
      );
    }

    // ================================
    // --- CHALLENGE COMPONENTS ---
    // ================================

    // NDA Modal Component
    function NDAModal({ challenge, onAccept, onCancel, session }) {
      const [loading, setLoading] = React.useState(false);

      const handleAccept = async () => {
        setLoading(true);

        try {
          // Store NDA acceptance with timestamp and version
          const ndaKey = `nda_${session.userId}_${challenge.orgId}`;
          const ndaData = {
            acceptedAt: new Date().toISOString(),
            version: '1.0', // Can be updated when NDA terms change
            challengeId: challenge.id,
            orgId: challenge.orgId,
            userId: session.userId
          };

          storage.set(ndaKey, ndaData);

          // Also update the challenge's NDA acceptance timestamp
          onAccept(ndaData);
        } catch (error) {
          console.error('Error saving NDA acceptance:', error);
          alert('Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡ Ù¾Ø°ÛŒØ±Ø´ NDA');
        } finally {
          setLoading(false);
        }
      };

      return (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
          <div className="bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
            <div className="p-6">
              <div className="text-center mb-6">
                <div className="text-4xl mb-4">ğŸ“„</div>
                <h2 className="text-2xl font-bold text-gray-900 mb-2">
                  ØªÙˆØ§ÙÙ‚Ù†Ø§Ù…Ù‡ Ø¹Ø¯Ù… Ø§ÙØ´Ø§ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª (NDA)
                </h2>
                <p className="text-gray-600">
                  Ø¨Ø±Ø§ÛŒ Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ØŒ Ø§Ø¨ØªØ¯Ø§ Ø¨Ø§ÛŒØ¯ NDA Ø±Ø§ Ù…Ø·Ø§Ù„Ø¹Ù‡ Ùˆ Ø¨Ù¾Ø°ÛŒØ±ÛŒØ¯
                </p>
              </div>

              <div className="bg-yellow-50 border border-yellow-200 rounded-lg p-6 mb-6">
                <h3 className="text-lg font-semibold text-yellow-800 mb-4">
                  Ø´Ø±Ø§ÛŒØ· ØªÙˆØ§ÙÙ‚Ù†Ø§Ù…Ù‡ Ø¹Ø¯Ù… Ø§ÙØ´Ø§ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª
                </h3>

                <div className="text-gray-700 space-y-3 text-sm leading-relaxed">
                  <p>
                    <strong>Û±. ØªØ¹Ø±ÛŒÙ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…Ø­Ø±Ù…Ø§Ù†Ù‡:</strong> Ù‡Ø±Ú¯ÙˆÙ†Ù‡ Ø§Ø·Ù„Ø§Ø¹Ø§ØªÛŒ Ú©Ù‡ ØªÙˆØ³Ø· Ø³Ø§Ø²Ù…Ø§Ù† Ø§Ø±Ø§Ø¦Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯ØŒ
                    Ø´Ø§Ù…Ù„ Ø§Ù…Ø§ Ù…Ø­Ø¯ÙˆØ¯ Ø¨Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ÙÙ†ÛŒØŒ ØªØ¬Ø§Ø±ÛŒØŒ Ù…Ø§Ù„ÛŒØŒ Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒÚ© Ùˆ Ø³Ø§ÛŒØ± Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø­Ø³Ø§Ø³.
                  </p>

                  <p>
                    <strong>Û². ØªØ¹Ù‡Ø¯ Ø¨Ù‡ Ù…Ø­Ø±Ù…Ø§Ù†Ú¯ÛŒ:</strong> Ù…ØªØ¹Ù‡Ø¯ Ù…ÛŒâ€ŒØ´ÙˆÙ… Ú©Ù‡ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…Ø­Ø±Ù…Ø§Ù†Ù‡ Ø±Ø§ Ù†Ø²Ø¯ Ø®ÙˆØ¯ Ù†Ú¯Ù‡ Ø¯Ø§Ø±Ù…
                    Ùˆ Ø¨Ø¯ÙˆÙ† Ø§Ø¬Ø§Ø²Ù‡ Ú©ØªØ¨ÛŒ Ø§Ø² Ø³Ø§Ø²Ù…Ø§Ù†ØŒ Ø¢Ù† Ø±Ø§ Ø¨Ù‡ Ù‡ÛŒÚ† Ø´Ø®Øµ Ø«Ø§Ù„Ø«ÛŒ Ø§ÙØ´Ø§ Ù†Ú©Ù†Ù….
                  </p>

                  <p>
                    <strong>Û³. Ù…Ø¯Øª Ø²Ù…Ø§Ù† ØªØ¹Ù‡Ø¯:</strong> Ø§ÛŒÙ† ØªØ¹Ù‡Ø¯ ØªØ§ Ûµ Ø³Ø§Ù„ Ù¾Ø³ Ø§Ø² Ù¾Ø§ÛŒØ§Ù† Ù‡Ù…Ú©Ø§Ø±ÛŒ ÛŒØ§ Ù¾Ø±ÙˆÚ˜Ù‡ Ù…Ø¹ØªØ¨Ø± Ø®ÙˆØ§Ù‡Ø¯ Ø¨ÙˆØ¯.
                  </p>

                  <p>
                    <strong>Û´. Ù…Ø¬Ø§Ø²Ø§Øª Ù†Ù‚Ø¶:</strong> Ø¯Ø± ØµÙˆØ±Øª Ù†Ù‚Ø¶ Ø§ÛŒÙ† ØªÙˆØ§ÙÙ‚Ù†Ø§Ù…Ù‡ØŒ Ù…ØªØ¹Ù‡Ø¯ Ø¨Ù‡ Ù¾Ø±Ø¯Ø§Ø®Øª Ø®Ø³Ø§Ø±Ø§Øª Ùˆ Ù‡Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ
                    Ù‚Ø§Ù†ÙˆÙ†ÛŒ Ø³Ø§Ø²Ù…Ø§Ù† Ø®ÙˆØ§Ù‡Ù… Ø¨ÙˆØ¯.
                  </p>

                  <p>
                    <strong>Ûµ. Ù…Ø§Ù„Ú©ÛŒØª Ù…Ø¹Ù†ÙˆÛŒ:</strong> ØªÙ…Ø§Ù…ÛŒ Ø­Ù‚ÙˆÙ‚ Ù…Ø§Ù„Ú©ÛŒØª Ù…Ø¹Ù†ÙˆÛŒ Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Ø±Ø§Ù‡â€ŒØ­Ù„ Ø§Ø±Ø§Ø¦Ù‡ Ø´Ø¯Ù‡ØŒ
                    Ø¯Ø± Ø§Ø®ØªÛŒØ§Ø± Ø³Ø§Ø²Ù…Ø§Ù† Ø®ÙˆØ§Ù‡Ø¯ Ø¨ÙˆØ¯ Ù…Ú¯Ø± Ø§ÛŒÙ†Ú©Ù‡ Ø®Ù„Ø§Ù Ø¢Ù† ØªÙˆØ§ÙÙ‚ Ø´ÙˆØ¯.
                  </p>
                </div>
              </div>

              <div className="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
                <div className="flex items-start gap-3">
                  <div className="text-blue-600 text-lg">â„¹ï¸</div>
                  <div>
                    <h4 className="font-medium text-blue-900 mb-2">Ù†Ú©Ø§Øª Ù…Ù‡Ù…:</h4>
                    <ul className="text-blue-800 text-sm space-y-1">
                      <li>â€¢ Ø§ÛŒÙ† ØªÙˆØ§ÙÙ‚Ù†Ø§Ù…Ù‡ Ø¨Ø±Ø§ÛŒ Ù…Ø­Ø§ÙØ¸Øª Ø§Ø² Ù…Ù†Ø§ÙØ¹ Ù‡Ø± Ø¯Ùˆ Ø·Ø±Ù Ø§Ø³Øª</li>
                      <li>â€¢ Ù¾Ø°ÛŒØ±Ø´ NDA Ø¨Ø±Ø§ÛŒ Ø§Ø±Ø³Ø§Ù„ Ù‡Ø±Ú¯ÙˆÙ†Ù‡ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª</li>
                      <li>â€¢ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ NDA Ø±Ø§ Ø¯Ø± Ù‡Ø± Ø²Ù…Ø§Ù† Ù„ØºÙˆ Ú©Ù†ÛŒØ¯</li>
                      <li>â€¢ Ø¯Ø± ØµÙˆØ±Øª Ø³ÙˆØ§Ù„Ø§ØªØŒ Ø¨Ø§ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ ØªÙ…Ø§Ø³ Ø¨Ú¯ÛŒØ±ÛŒØ¯</li>
                    </ul>
                  </div>
                </div>
              </div>

              <div className="flex gap-4">
                <button
                  onClick={handleAccept}
                  disabled={loading}
                  className="flex-1 px-6 py-3 bg-green-600 text-white text-lg font-semibold rounded-lg hover:bg-green-700 focus:ring-2 focus:ring-green-500 disabled:opacity-50 transition-colors"
                >
                  {loading ? 'Ø¯Ø± Ø­Ø§Ù„ Ø°Ø®ÛŒØ±Ù‡...' : 'âœ… Ù¾Ø°ÛŒØ±Ø´ NDA Ùˆ Ø§Ø¯Ø§Ù…Ù‡'}
                </button>
                <button
                  onClick={onCancel}
                  className="px-6 py-3 bg-gray-600 text-white text-lg font-semibold rounded-lg hover:bg-gray-700 focus:ring-2 focus:ring-gray-500 transition-colors"
                >
                  Ø§Ù†ØµØ±Ø§Ù
                </button>
              </div>
            </div>
          </div>
        </div>
      );
    }

    function SubmissionForm({ challenge, onSave, onCancel, session }) {
      const [formData, setFormData] = React.useState({
        summary: '',
        proposal: '',
        files: [],
        video: ''
      });

      const [errors, setErrors] = React.useState({});
      const [loading, setLoading] = React.useState(false);
      const [showNDAModal, setShowNDAModal] = React.useState(false);
      const [ndaAccepted, setNdaAccepted] = React.useState(null);

      // Check NDA status on component mount
      React.useEffect(() => {
        const ndaKey = `nda_${session.userId}_${challenge.orgId}`;
        const existingNDA = storage.get(ndaKey, null);
        if (!existingNDA) {
          setShowNDAModal(true);
        } else {
          setNdaAccepted(existingNDA);
        }
      }, [session.userId, challenge.orgId]);

      const handleNDAAccept = (ndaData) => {
        setNdaAccepted(ndaData);
        setShowNDAModal(false);
      };

      const handleNDACancel = () => {
        setShowNDAModal(false);
        onCancel();
      };

      const validateForm = () => {
        const newErrors = {};

        if (!formData.summary.trim()) newErrors.summary = 'Ø®Ù„Ø§ØµÙ‡ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª';
        if (!formData.proposal.trim()) newErrors.proposal = 'Ø¬Ø²Ø¦ÛŒØ§Øª Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª';

        setErrors(newErrors);
        return Object.keys(newErrors).length === 0;
      };

      const handleSubmit = async (e) => {
        e.preventDefault();

        if (!validateForm()) return;

        setLoading(true);

        try {
          const submissions = storage.get(KEYS.submissions, []);

          const submissionData = {
            id: `sub-${Date.now()}`,
            challengeId: challenge.id,
            userId: session.userId,
            ndaAcceptedAt: ndaAccepted.acceptedAt,
            ndaVersion: ndaAccepted.version,
            status: 'received', // Start with 'received' status
            data: {
              summary: formData.summary.trim(),
              proposal: formData.proposal.trim(),
              files: formData.files,
              video: formData.video || null
            },
            createdAt: new Date().toISOString(),
            updatedAt: new Date().toISOString()
          };

          submissions.push(submissionData);
          storage.set(KEYS.submissions, submissions);

          onSave(submissionData);

        } catch (error) {
          console.error('Error saving submission:', error);
          alert('Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯');
        } finally {
          setLoading(false);
        }
      };

      const updateField = (field, value) => {
        setFormData(prev => ({ ...prev, [field]: value }));
        if (errors[field]) {
          setErrors(prev => ({ ...prev, [field]: '' }));
        }
      };

      // Show NDA modal if NDA not accepted
      if (showNDAModal) {
        return (
          <NDAModal
            challenge={challenge}
            onAccept={handleNDAAccept}
            onCancel={handleNDACancel}
            session={session}
          />
        );
      }

      return (
        <div className="max-w-4xl mx-auto">
          <div className="bg-white rounded-xl shadow-lg p-8">
            <div className="mb-6">
              <h2 className="text-2xl font-bold text-gray-900 mb-2">
                Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ø¨Ø±Ø§ÛŒ Ú†Ø§Ù„Ø´
              </h2>
              <h3 className="text-lg text-gray-700 mb-4">
                {challenge.title}
              </h3>
              <p className="text-gray-600">
                Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ø§ Ø¬Ø²Ø¦ÛŒØ§Øª Ú©Ø§Ù…Ù„ Ø´Ø±Ø­ Ø¯Ù‡ÛŒØ¯ ØªØ§ Ø´Ø§Ù†Ø³ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù†ØªØ§Ù† Ø§ÙØ²Ø§ÛŒØ´ ÛŒØ§Ø¨Ø¯.
              </p>

              {/* NDA Status */}
              {ndaAccepted && (
                <div className="bg-green-50 border border-green-200 rounded-lg p-4 mt-4">
                  <div className="flex items-center gap-2">
                    <span className="text-green-600">âœ…</span>
                    <div>
                      <p className="text-green-800 font-medium">NDA Ù¾Ø°ÛŒØ±ÙØªÙ‡ Ø´Ø¯Ù‡</p>
                      <p className="text-green-700 text-sm">
                        Ø¯Ø± ØªØ§Ø±ÛŒØ® {new Date(ndaAccepted.acceptedAt).toLocaleDateString('fa-IR')} Ù¾Ø°ÛŒØ±ÙØªÙ‡ Ø´Ø¯Ù‡
                      </p>
                    </div>
                  </div>
                </div>
              )}
            </div>

            <form onSubmit={handleSubmit} className="space-y-6">

              {/* Summary */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Ø®Ù„Ø§ØµÙ‡ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ *
                </label>
                <input
                  type="text"
                  value={formData.summary}
                  onChange={(e) => updateField('summary', e.target.value)}
                  className={`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 ${
                    errors.summary ? 'border-red-300' : 'border-gray-300'
                  }`}
                  placeholder="Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ø®ÙˆØ¯ Ø±Ø§ Ø¯Ø± ÛŒÚ© Ø¬Ù…Ù„Ù‡ Ø®Ù„Ø§ØµÙ‡ Ú©Ù†ÛŒØ¯"
                />
                {errors.summary && <p className="text-red-600 text-sm mt-1">{errors.summary}</p>}
              </div>

              {/* Proposal */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Ø¬Ø²Ø¦ÛŒØ§Øª Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ *
                </label>
                <textarea
                  value={formData.proposal}
                  onChange={(e) => updateField('proposal', e.target.value)}
                  className={`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 ${
                    errors.proposal ? 'border-red-300' : 'border-gray-300'
                  }`}
                  rows="8"
                  placeholder="Ø¬Ø²Ø¦ÛŒØ§Øª Ú©Ø§Ù…Ù„ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ø®ÙˆØ¯ Ø±Ø§ Ø´Ø±Ø­ Ø¯Ù‡ÛŒØ¯..."
                />
                {errors.proposal && <p className="text-red-600 text-sm mt-1">{errors.proposal}</p>}
              </div>

              {/* Files */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¶Ù…ÛŒÙ…Ù‡
                </label>
                <input
                  type="text"
                  value={formData.files.join(', ')}
                  onChange={(e) => updateField('files', e.target.value.split(',').map(f => f.trim()).filter(f => f))}
                  className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                  placeholder="Ù†Ø§Ù… ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ Ø±Ø§ Ø¨Ø§ Ú©Ø§Ù…Ø§ Ø¬Ø¯Ø§ Ú©Ù†ÛŒØ¯ (Ù…Ø«Ø§Ù„: proposal.pdf, demo.mp4)"
                />
              </div>

              {/* Video */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Ù„ÛŒÙ†Ú© ÙˆÛŒØ¯ÛŒÙˆ Ø¯Ù…Ùˆ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)
                </label>
                <input
                  type="url"
                  value={formData.video}
                  onChange={(e) => updateField('video', e.target.value)}
                  className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                  placeholder="https://..."
                />
              </div>

              {/* Submit Buttons */}
              <div className="flex gap-4 pt-6">
                <button
                  type="submit"
                  disabled={loading}
                  className="flex-1 px-8 py-3 bg-green-600 text-white text-lg font-semibold rounded-lg hover:bg-green-700 focus:ring-2 focus:ring-green-500 disabled:opacity-50 transition-colors"
                >
                  {loading ? 'Ø¯Ø± Ø­Ø§Ù„ Ø°Ø®ÛŒØ±Ù‡...' : 'ğŸš€ Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯'}
                </button>
                <button
                  type="button"
                  onClick={onCancel}
                  className="px-8 py-3 bg-gray-600 text-white text-lg font-semibold rounded-lg hover:bg-gray-700 focus:ring-2 focus:ring-gray-500 transition-colors"
                >
                  Ø§Ù†ØµØ±Ø§Ù
                </button>
              </div>
            </form>
          </div>
        </div>
      );
    }

    function ChallengeForm({ challenge, onSave, onCancel, session }) {
      const [formData, setFormData] = React.useState({
        title: challenge?.title || '',
        problem: challenge?.problem || '',
        success: challenge?.success || '',
        deliverables: challenge?.deliverables || '',
        reward: challenge?.reward || 0,
        category: challenge?.category || 'Energy',
        deadline: challenge?.deadline ? challenge.deadline.split('T')[0] : '',
        tags: challenge?.tags ? challenge.tags.join(', ') : '',
        attachments: challenge?.attachments || [],
        status: challenge?.status || 'draft'
      });

      const [errors, setErrors] = React.useState({});
      const [loading, setLoading] = React.useState(false);

      const categories = [
        'Energy', 'IoT', 'AI', 'Robotics', 'Biotech', 'FinTech',
        'Agritech', 'EdTech', 'HealthTech', 'CleanTech', 'Other'
      ];

      const validateForm = () => {
        const newErrors = {};

        if (!formData.title.trim()) newErrors.title = 'Ø¹Ù†ÙˆØ§Ù† Ú†Ø§Ù„Ø´ Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª';
        if (!formData.problem.trim()) newErrors.problem = 'ØªÙˆØ¶ÛŒØ­ Ù…Ø³Ø¦Ù„Ù‡ Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª';
        if (!formData.success.trim()) newErrors.success = 'Ù…Ø¹ÛŒØ§Ø±Ù‡Ø§ÛŒ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª';
        if (!formData.deliverables.trim()) newErrors.deliverables = 'ØªØ­ÙˆÛŒÙ„â€ŒÙ¾Ø°ÛŒØ±Ù‡Ø§ Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª';
        if (formData.reward <= 0) newErrors.reward = 'Ù¾Ø§Ø¯Ø§Ø´ Ø¨Ø§ÛŒØ¯ Ø¨ÛŒØ´ØªØ± Ø§Ø² ØµÙØ± Ø¨Ø§Ø´Ø¯';
        if (!formData.deadline) newErrors.deadline = 'Ù…Ù‡Ù„Øª Ø§Ø±Ø³Ø§Ù„ Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª';

        // Check if deadline is in future
        if (formData.deadline) {
          const deadlineDate = new Date(formData.deadline);
          const now = new Date();
          if (deadlineDate <= now) {
            newErrors.deadline = 'Ù…Ù‡Ù„Øª Ø¨Ø§ÛŒØ¯ Ø¯Ø± Ø¢ÛŒÙ†Ø¯Ù‡ Ø¨Ø§Ø´Ø¯';
          }
        }

        setErrors(newErrors);
        return Object.keys(newErrors).length === 0;
      };

      const handleSubmit = async (e) => {
        e.preventDefault();

        if (!validateForm()) return;

        setLoading(true);

        try {
          const challenges = storage.get(KEYS.challenges, []);

          const challengeData = {
            id: challenge?.id || `c-${Date.now()}`,
            orgId: session.orgId,
            title: formData.title.trim(),
            problem: formData.problem.trim(),
            success: formData.success.trim(),
            deliverables: formData.deliverables.trim(),
            reward: Number(formData.reward),
            category: formData.category,
            deadline: new Date(formData.deadline).toISOString(),
            tags: formData.tags.split(',').map(tag => tag.trim()).filter(tag => tag),
            attachments: formData.attachments,
            status: formData.status,
            createdAt: challenge?.createdAt || new Date().toISOString(),
            updatedAt: new Date().toISOString()
          };

          if (challenge) {
            // Update existing challenge
            const index = challenges.findIndex(c => c.id === challenge.id);
            if (index !== -1) {
              challenges[index] = challengeData;
            }
          } else {
            // Create new challenge
            challenges.push(challengeData);
          }

          storage.set(KEYS.challenges, challenges);
          onSave(challengeData);

        } catch (error) {
          console.error('Error saving challenge:', error);
          alert('Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡ Ú†Ø§Ù„Ø´');
        } finally {
          setLoading(false);
        }
      };

      const updateField = (field, value) => {
        setFormData(prev => ({ ...prev, [field]: value }));
        // Clear error when user starts typing
        if (errors[field]) {
          setErrors(prev => ({ ...prev, [field]: '' }));
        }
      };

      return (
        <div className="max-w-4xl mx-auto">
          <div className="bg-white rounded-xl shadow-lg p-8">
            <div className="mb-6">
              <h2 className="text-2xl font-bold text-gray-900 mb-2">
                {challenge ? 'ÙˆÛŒØ±Ø§ÛŒØ´ Ú†Ø§Ù„Ø´' : 'Ø§ÛŒØ¬Ø§Ø¯ Ú†Ø§Ù„Ø´ Ø¬Ø¯ÛŒØ¯'}
              </h2>
              <p className="text-gray-600">
                Ú†Ø§Ù„Ø´ Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ø§ Ø¬Ø²Ø¦ÛŒØ§Øª Ú©Ø§Ù…Ù„ ØªØ¹Ø±ÛŒÙ Ú©Ù†ÛŒØ¯ ØªØ§ Ø­Ù„â€ŒÚ©Ù†Ù†Ø¯Ú¯Ø§Ù† Ø¨ØªÙˆØ§Ù†Ù†Ø¯ Ø¨Ù‡ØªØ±ÛŒÙ† Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯Ù‡Ø§ Ø±Ø§ Ø§Ø±Ø§Ø¦Ù‡ Ø¯Ù‡Ù†Ø¯.
              </p>
            </div>

            <form onSubmit={handleSubmit} className="space-y-6">
              {/* Basic Information */}
              <div className="grid md:grid-cols-2 gap-6">
                <div className="md:col-span-2">
                  <FormField
                    label="Ø¹Ù†ÙˆØ§Ù† Ú†Ø§Ù„Ø´"
                    required
                    error={errors.title}
                  >
                    <TextInput
                      id="challenge-title"
                      type="text"
                      value={formData.title}
                      onChange={(e) => updateField('title', e.target.value)}
                      error={!!errors.title}
                      placeholder="Ù…Ø«Ø§Ù„: Ø³Ø§Ù…Ø§Ù†Ù‡ Ù‡ÙˆØ´Ù…Ù†Ø¯ Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ù†Ø±Ú˜ÛŒ"
                      maxLength={100}
                      aria-describedby="title-help"
                    />
                    <div id="title-help" className="sr-only">
                      Ø¹Ù†ÙˆØ§Ù† Ú†Ø§Ù„Ø´ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯ (Ø­Ø¯Ø§Ú©Ø«Ø± Û±Û°Û° Ú©Ø§Ø±Ø§Ú©ØªØ±)
                    </div>
                  </FormField>
                </div>

                <div>
                  <FormField label="Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ" required>
                    <SelectInput
                      id="challenge-category"
                      value={formData.category}
                      onChange={(e) => updateField('category', e.target.value)}
                      aria-describedby="category-help"
                    >
                      {categories.map(cat => (
                        <option key={cat} value={cat}>{cat}</option>
                      ))}
                    </SelectInput>
                    <div id="category-help" className="sr-only">
                      Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ù…Ù†Ø§Ø³Ø¨ Ø¨Ø±Ø§ÛŒ Ú†Ø§Ù„Ø´ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯
                    </div>
                  </FormField>
                </div>

                <div>
                  <FormField
                    label="Ù¾Ø§Ø¯Ø§Ø´ (ØªÙˆÙ…Ø§Ù†)"
                    required
                    error={errors.reward}
                    help="Ù¾Ø§Ø¯Ø§Ø´ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ Ø¨Ø±Ø§ÛŒ Ø­Ù„ Ú†Ø§Ù„Ø´"
                  >
                    <TextInput
                      id="challenge-reward"
                      type="number"
                      value={formData.reward}
                      onChange={(e) => updateField('reward', Number(e.target.value))}
                      error={!!errors.reward}
                      placeholder="Ù…Ø«Ø§Ù„: 50000000"
                      min="0"
                      step="100000"
                      aria-describedby="reward-help"
                    />
                  </FormField>
                </div>
              </div>

              {/* Problem Description */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  ØªÙˆØ¶ÛŒØ­ Ù…Ø³Ø¦Ù„Ù‡ *
                </label>
                <textarea
                  value={formData.problem}
                  onChange={(e) => updateField('problem', e.target.value)}
                  className={`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 ${
                    errors.problem ? 'border-red-300' : 'border-gray-300'
                  }`}
                  rows="4"
                  placeholder="Ù…Ø³Ø¦Ù„Ù‡ Ø±Ø§ Ø¨Ù‡ ØµÙˆØ±Øª Ú©Ø§Ù…Ù„ Ùˆ ÙˆØ§Ø¶Ø­ ØªÙˆØ¶ÛŒØ­ Ø¯Ù‡ÛŒØ¯..."
                />
                {errors.problem && <p className="text-red-600 text-sm mt-1">{errors.problem}</p>}
              </div>

              {/* Success Criteria */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Ù…Ø¹ÛŒØ§Ø±Ù‡Ø§ÛŒ Ù…ÙˆÙÙ‚ÛŒØª *
                </label>
                <textarea
                  value={formData.success}
                  onChange={(e) => updateField('success', e.target.value)}
                  className={`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 ${
                    errors.success ? 'border-red-300' : 'border-gray-300'
                  }`}
                  rows="3"
                  placeholder="Ú†Ù‡ Ù…Ø¹ÛŒØ§Ø±Ù‡Ø§ÛŒÛŒ Ø¨Ø±Ø§ÛŒ Ù…ÙˆÙÙ‚ÛŒØª Ø¯Ø± Ù†Ø¸Ø± Ø¯Ø§Ø±ÛŒØ¯ØŸ"
                />
                {errors.success && <p className="text-red-600 text-sm mt-1">{errors.success}</p>}
              </div>

              {/* Deliverables */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  ØªØ­ÙˆÛŒÙ„â€ŒÙ¾Ø°ÛŒØ±Ù‡Ø§ *
                </label>
                <textarea
                  value={formData.deliverables}
                  onChange={(e) => updateField('deliverables', e.target.value)}
                  className={`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 ${
                    errors.deliverables ? 'border-red-300' : 'border-gray-300'
                  }`}
                  rows="3"
                  placeholder="Ú†Ù‡ Ú†ÛŒØ²Ù‡Ø§ÛŒÛŒ Ø¨Ø§ÛŒØ¯ ØªØ­ÙˆÛŒÙ„ Ø¯Ø§Ø¯Ù‡ Ø´ÙˆØ¯ØŸ (Ú©Ø¯ØŒ Ú¯Ø²Ø§Ø±Ø´ØŒ Ù†Ù…ÙˆÙ†Ù‡ØŒ ...)"
                />
                {errors.deliverables && <p className="text-red-600 text-sm mt-1">{errors.deliverables}</p>}
              </div>

              {/* Deadline and Tags */}
              <div className="grid md:grid-cols-2 gap-6">
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">
                    Ù…Ù‡Ù„Øª Ø§Ø±Ø³Ø§Ù„ *
                  </label>
                  <input
                    type="date"
                    value={formData.deadline}
                    onChange={(e) => updateField('deadline', e.target.value)}
                    className={`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 ${
                      errors.deadline ? 'border-red-300' : 'border-gray-300'
                    }`}
                  />
                  {errors.deadline && <p className="text-red-600 text-sm mt-1">{errors.deadline}</p>}
                </div>

                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">
                    Ø¨Ø±Ú†Ø³Ø¨â€ŒÙ‡Ø§
                  </label>
                  <input
                    type="text"
                    value={formData.tags}
                    onChange={(e) => updateField('tags', e.target.value)}
                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                    placeholder="Ø§Ù†Ø±Ú˜ÛŒØŒ IoTØŒ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ"
                  />
                  <p className="text-xs text-gray-500 mt-1">Ø¨Ø§ Ú©Ø§Ù…Ø§ Ø¬Ø¯Ø§ Ú©Ù†ÛŒØ¯</p>
                </div>
              </div>

              {/* Attachments */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Ù¾ÛŒÙˆØ³Øªâ€ŒÙ‡Ø§
                </label>
                <div className="border border-gray-300 rounded-lg p-4 space-y-3">
                  {formData.attachments.length > 0 ? (
                    <div className="space-y-2">
                      {formData.attachments.map((file, index) => (
                        <div key={index} className="flex items-center justify-between bg-gray-50 p-2 rounded">
                          <div className="flex items-center gap-2">
                            <span className="text-gray-600">ğŸ“„</span>
                            <span className="text-gray-700">{file}</span>
                          </div>
                          <button 
                            type="button"
                            onClick={() => {
                              const newAttachments = [...formData.attachments];
                              newAttachments.splice(index, 1);
                              updateField('attachments', newAttachments);
                            }}
                            className="text-red-600 hover:text-red-800"
                          >
                            âœ•
                          </button>
                        </div>
                      ))}
                    </div>
                  ) : (
                    <p className="text-gray-500 text-center py-2">Ù‡ÛŒÚ† Ù¾ÛŒÙˆØ³ØªÛŒ Ø§Ø¶Ø§ÙÙ‡ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª</p>
                  )}
                  
                  <div className="flex items-center gap-2">
                    <input
                      type="text"
                      id="attachment-name"
                      placeholder="Ù†Ø§Ù… ÙØ§ÛŒÙ„ Ù¾ÛŒÙˆØ³Øª"
                      className="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                    />
                    <button
                      type="button"
                      onClick={() => {
                        const input = document.getElementById('attachment-name');
                        if (input.value.trim()) {
                          updateField('attachments', [...formData.attachments, input.value.trim()]);
                          input.value = '';
                        }
                      }}
                      className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 focus:ring-2 focus:ring-blue-500"
                    >
                      Ø§ÙØ²ÙˆØ¯Ù†
                    </button>
                  </div>
                  <p className="text-xs text-gray-500">Ø¯Ø± Ø§ÛŒÙ† Ù†Ø³Ø®Ù‡ØŒ ÙÙ‚Ø· Ù†Ø§Ù… ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ Ø°Ø®ÛŒØ±Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯</p>
                </div>
              </div>
              
              {/* Status */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  ÙˆØ¶Ø¹ÛŒØª Ø§Ù†ØªØ´Ø§Ø±
                </label>
                <select
                  value={formData.status}
                  onChange={(e) => updateField('status', e.target.value)}
                  className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                >
                  <option value="draft">Ù¾ÛŒØ´â€ŒÙ†ÙˆÛŒØ³</option>
                  <option value="published">Ù…Ù†ØªØ´Ø± Ø´Ø¯Ù‡</option>
                  <option value="closed">Ø¨Ø³ØªÙ‡ Ø´Ø¯Ù‡</option>
                </select>
              </div>

              {/* Submit Buttons */}
              <div className="flex gap-4 pt-6 border-t">
                <ButtonLoader
                  type="submit"
                  loading={loading}
                  className="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 disabled:opacity-50 transition-colors focus-ring"
                  aria-describedby="submit-help"
                >
                  {loading ? 'Ø¯Ø± Ø­Ø§Ù„ Ø°Ø®ÛŒØ±Ù‡...' : (challenge ? 'Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ú†Ø§Ù„Ø´' : 'Ø§ÛŒØ¬Ø§Ø¯ Ú†Ø§Ù„Ø´')}
                </ButtonLoader>
                <div id="submit-help" className="sr-only">
                  {challenge ? 'Ú†Ø§Ù„Ø´ Ø±Ø§ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ú©Ù†ÛŒØ¯' : 'Ú†Ø§Ù„Ø´ Ø¬Ø¯ÛŒØ¯ Ø§ÛŒØ¬Ø§Ø¯ Ú©Ù†ÛŒØ¯'}
                </div>
                <button
                  type="button"
                  onClick={onCancel}
                  className="px-6 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 focus:ring-2 focus:ring-gray-500 transition-colors focus-ring"
                  aria-label="Ø§Ù†ØµØ±Ø§Ù Ùˆ Ø¨Ø§Ø²Ú¯Ø´Øª"
                >
                  Ø§Ù†ØµØ±Ø§Ù
                </button>
              </div>
            </form>
          </div>
        </div>
      );
    }

    function ChallengeCatalog({ challenges, onSelectChallenge, session }) {
      const [searchTerm, setSearchTerm] = React.useState('');
      const [selectedCategory, setSelectedCategory] = React.useState('');
      const [sortBy, setSortBy] = React.useState('newest');
      const [viewMode, setViewMode] = React.useState('grid');

      const categories = ['All', 'Energy', 'IoT', 'AI', 'Robotics', 'Biotech', 'FinTech', 'Agritech', 'EdTech', 'HealthTech', 'CleanTech', 'Other'];

      // Filter challenges
      const filteredChallenges = challenges.filter(challenge => {
        const matchesSearch = !searchTerm ||
          challenge.title.toLowerCase().includes(searchTerm.toLowerCase()) ||
          challenge.problem.toLowerCase().includes(searchTerm.toLowerCase()) ||
          challenge.tags?.some(tag => tag.toLowerCase().includes(searchTerm.toLowerCase()));

        const matchesCategory = !selectedCategory || selectedCategory === 'All' || challenge.category === selectedCategory;

        return matchesSearch && matchesCategory && challenge.status === 'published';
      });

      // Sort challenges
      const sortedChallenges = [...filteredChallenges].sort((a, b) => {
        switch (sortBy) {
          case 'newest':
            return new Date(b.createdAt) - new Date(a.createdAt);
          case 'oldest':
            return new Date(a.createdAt) - new Date(b.createdAt);
          case 'reward-high':
            return b.reward - a.reward;
          case 'reward-low':
            return a.reward - b.reward;
          case 'deadline':
            return new Date(a.deadline) - new Date(b.deadline);
          default:
            return 0;
        }
      });

      const formatReward = (amount) => {
        return new Intl.NumberFormat('fa-IR').format(amount);
      };

      const getDaysLeft = (deadline) => {
        const now = new Date();
        const deadlineDate = new Date(deadline);
        const diffTime = deadlineDate - now;
        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        return diffDays;
      };

      return (
        <div className="space-y-6">
          {/* Header */}
          <div className="text-center py-6">
            <h1 className="text-2xl font-bold text-gray-900 mb-2">Ú©Ø§ØªØ§Ù„ÙˆÚ¯ Ú†Ø§Ù„Ø´â€ŒÙ‡Ø§</h1>
            <p className="text-gray-600">Ú†Ø§Ù„Ø´â€ŒÙ‡Ø§ÛŒ ÙÙ†Ø§ÙˆØ±ÛŒ Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø±Ø§ÛŒ Ø­Ù„</p>
          </div>

          {/* Filters and Search */}
          <div className="bg-white rounded-xl shadow p-6">
            <div className="grid md:grid-cols-4 gap-4 mb-4">
              {/* Search */}
              <div className="md:col-span-2">
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Ø¬Ø³ØªØ¬Ùˆ
                </label>
                <input
                  type="text"
                  value={searchTerm}
                  onChange={(e) => setSearchTerm(e.target.value)}
                  className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                  placeholder="Ø¬Ø³ØªØ¬Ùˆ Ø¯Ø± Ø¹Ù†ÙˆØ§Ù†ØŒ ØªÙˆØ¶ÛŒØ­ ÛŒØ§ Ø¨Ø±Ú†Ø³Ø¨â€ŒÙ‡Ø§..."
                />
              </div>

              {/* Category Filter */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ
                </label>
                <select
                  value={selectedCategory}
                  onChange={(e) => setSelectedCategory(e.target.value)}
                  className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                >
                  {categories.map(cat => (
                    <option key={cat} value={cat === 'All' ? '' : cat}>
                      {cat === 'All' ? 'Ù‡Ù…Ù‡ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§' : cat}
                    </option>
                  ))}
                </select>
              </div>

              {/* Sort */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Ù…Ø±ØªØ¨â€ŒØ³Ø§Ø²ÛŒ
                </label>
                <select
                  value={sortBy}
                  onChange={(e) => setSortBy(e.target.value)}
                  className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                >
                  <option value="newest">Ø¬Ø¯ÛŒØ¯ØªØ±ÛŒÙ†</option>
                  <option value="oldest">Ù‚Ø¯ÛŒÙ…ÛŒâ€ŒØªØ±ÛŒÙ†</option>
                  <option value="reward-high">Ù¾Ø§Ø¯Ø§Ø´ Ø¨Ø§Ù„Ø§ØªØ±</option>
                  <option value="reward-low">Ù¾Ø§Ø¯Ø§Ø´ Ù¾Ø§ÛŒÛŒÙ†â€ŒØªØ±</option>
                  <option value="deadline">Ù…Ù‡Ù„Øª Ù†Ø²Ø¯ÛŒÚ©â€ŒØªØ±</option>
                </select>
              </div>
            </div>

            {/* View Toggle and Results Count */}
            <div className="flex justify-between items-center">
              <div className="flex items-center gap-4">
                <span className="text-sm text-gray-600">
                  {sortedChallenges.length} Ú†Ø§Ù„Ø´ ÛŒØ§ÙØª Ø´Ø¯
                </span>
              </div>

              <div className="flex items-center gap-4">
                {/* View Toggle */}
                <div className="flex items-center gap-2">
                  <span className="text-sm text-gray-600">Ù†Ù…Ø§ÛŒØ´:</span>
                  <button
                    onClick={() => setViewMode('grid')}
                    className={`p-2 rounded ${viewMode === 'grid' ? 'bg-blue-100 text-blue-600' : 'text-gray-400'}`}
                  >
                    âŠ
                  </button>
                  <button
                    onClick={() => setViewMode('list')}
                    className={`p-2 rounded ${viewMode === 'list' ? 'bg-blue-100 text-blue-600' : 'text-gray-400'}`}
                  >
                    â˜°
                  </button>
                </div>

                {/* Create Challenge Button for Seekers */}
                {session?.role === 'SEEKER' && (
                  <button
                    onClick={() => window.location.hash = 'create-challenge'}
                    className="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center gap-2"
                  >
                    <span>â•</span>
                    Ø§ÛŒØ¬Ø§Ø¯ Ú†Ø§Ù„Ø´ Ø¬Ø¯ÛŒØ¯
                  </button>
                )}
              </div>
            </div>
          </div>

          {/* Challenges Display */}
          {sortedChallenges.length > 0 ? (
            <div className={viewMode === 'grid'
              ? "grid md:grid-cols-2 lg:grid-cols-3 gap-6"
              : "space-y-4"
            }>
              {sortedChallenges.map(challenge => (
                <div
                  key={challenge.id}
                  className={`bg-white rounded-xl shadow hover:shadow-lg transition-shadow cursor-pointer ${
                    viewMode === 'list' ? 'flex items-center' : ''
                  }`}
                  onClick={() => onSelectChallenge(challenge)}
                >
                  {viewMode === 'grid' ? (
                    // Grid View
                    <div className="p-6">
                      <div className="flex items-start justify-between mb-4">
                        <div className="flex-1">
                          <h3 className="text-lg font-semibold text-gray-900 mb-2 line-clamp-2">
                            {challenge.title}
                          </h3>
                          <div className="flex items-center gap-2 mb-2">
                            <span className="px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full">
                              {challenge.category}
                            </span>
                            <span className={`px-2 py-1 text-xs rounded-full ${
                              getDaysLeft(challenge.deadline) > 7 ? 'bg-green-100 text-green-800' :
                              getDaysLeft(challenge.deadline) > 0 ? 'bg-yellow-100 text-yellow-800' :
                              'bg-red-100 text-red-800'
                            }`}>
                              {getDaysLeft(challenge.deadline) > 0
                                ? `${getDaysLeft(challenge.deadline)} Ø±ÙˆØ²`
                                : 'Ù…Ù‡Ù„Øª ØªÙ…Ø§Ù… Ø´Ø¯Ù‡'
                              }
                            </span>
                          </div>
                        </div>
                        <div className="text-left">
                          <div className="text-lg font-bold text-green-600">
                            {formatReward(challenge.reward)} ØªÙˆÙ…Ø§Ù†
                          </div>
                        </div>
                      </div>

                      <p className="text-gray-700 mb-4 line-clamp-3">
                        {challenge.problem}
                      </p>

                      <div className="flex items-center justify-between">
                        <div className="flex flex-wrap gap-1">
                          {challenge.tags?.slice(0, 3).map((tag, index) => (
                            <span key={index} className="px-2 py-1 bg-gray-100 text-gray-700 text-xs rounded">
                              {tag}
                            </span>
                          ))}
                          {challenge.tags?.length > 3 && (
                            <span className="px-2 py-1 bg-gray-100 text-gray-700 text-xs rounded">
                              +{challenge.tags.length - 3}
                            </span>
                          )}
                        </div>
                        <button className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                          Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø¬Ø²Ø¦ÛŒØ§Øª
                        </button>
                      </div>
                    </div>
                  ) : (
                    // List View
                    <div className="p-4 flex-1">
                      <div className="flex items-center justify-between">
                        <div className="flex-1">
                          <h3 className="text-lg font-semibold text-gray-900 mb-1">
                            {challenge.title}
                          </h3>
                          <p className="text-gray-700 text-sm line-clamp-2 mb-2">
                            {challenge.problem}
                          </p>
                          <div className="flex items-center gap-4 text-sm text-gray-600">
                            <span>ğŸ·ï¸ {challenge.category}</span>
                            <span>ğŸ’° {formatReward(challenge.reward)} ØªÙˆÙ…Ø§Ù†</span>
                            <span>â° {getDaysLeft(challenge.deadline)} Ø±ÙˆØ²</span>
                          </div>
                        </div>
                        <div className="mr-4">
                          <button className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                            Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø¬Ø²Ø¦ÛŒØ§Øª
                          </button>
                        </div>
                      </div>
                    </div>
                  )}
                </div>
              ))}
            </div>
          ) : (
            <div className="text-center py-12">
              <div className="text-4xl mb-4">ğŸ”</div>
              <p className="text-gray-500 mb-2">Ù‡ÛŒÚ† Ú†Ø§Ù„Ø´ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯</p>
              <p className="text-sm text-gray-400">
                {searchTerm || selectedCategory ? 'ÙÛŒÙ„ØªØ±Ù‡Ø§ Ø±Ø§ ØªØºÛŒÛŒØ± Ø¯Ù‡ÛŒØ¯ ÛŒØ§ Ø¬Ø³ØªØ¬ÙˆÛŒ Ø¯ÛŒÚ¯Ø±ÛŒ Ø§Ù†Ø¬Ø§Ù… Ø¯Ù‡ÛŒØ¯' : 'Ù‡ÛŒÚ† Ú†Ø§Ù„Ø´ÛŒ Ù…Ù†ØªØ´Ø± Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª'}
              </p>
            </div>
          )}
        </div>
      );
    }

    function ChallengeDetail({ challenge, onBack, onSolve, session }) {
      const [org, setOrg] = React.useState(null);
      const [isSubmitting, setIsSubmitting] = React.useState(false);

      React.useEffect(() => {
        if (challenge?.orgId) {
          const orgs = storage.get(KEYS.orgs, []);
          const foundOrg = orgs.find(o => o.id === challenge.orgId);
          setOrg(foundOrg);
        }
      }, [challenge]);

      const formatReward = (amount) => {
        return new Intl.NumberFormat('fa-IR').format(amount);
      };

      const getDaysLeft = (deadline) => {
        const now = new Date();
        const deadlineDate = new Date(deadline);
        const diffTime = deadlineDate - now;
        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        return diffDays;
      };

      const handleSolveChallenge = () => {
        if (!session) {
          alert('Ø¨Ø±Ø§ÛŒ Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ø§Ø¨ØªØ¯Ø§ ÙˆØ§Ø±Ø¯ Ø³ÛŒØ³ØªÙ… Ø´ÙˆÛŒØ¯');
          window.location.hash = 'login';
          return;
        }

        if (session.role !== 'SOLVER') {
          alert('ÙÙ‚Ø· Ø­Ù„â€ŒÚ©Ù†Ù†Ø¯Ú¯Ø§Ù† Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ù†Ø¯ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ø§Ø±Ø³Ø§Ù„ Ú©Ù†Ù†Ø¯');
          return;
        }

        // Check if user already submitted for this challenge
        const existingSubmissions = JSON.parse(localStorage.getItem('submissions') || '[]');
        const alreadySubmitted = existingSubmissions.some(sub =>
          sub.challengeId === challenge.id && sub.userId === session.userId
        );

        if (alreadySubmitted) {
          alert('Ø´Ù…Ø§ Ù‚Ø¨Ù„Ø§Ù‹ Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ú†Ø§Ù„Ø´ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ø§Ø±Ø³Ø§Ù„ Ú©Ø±Ø¯Ù‡â€ŒØ§ÛŒØ¯');
          return;
        }

        // Navigate to submission creation
        onSolve(challenge);
      };

      if (!challenge) {
        return (
          <div className="text-center py-12">
            <div className="text-4xl mb-4">âŒ</div>
            <p className="text-gray-500">Ú†Ø§Ù„Ø´ ÛŒØ§ÙØª Ù†Ø´Ø¯</p>
            <button
              onClick={onBack}
              className="mt-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"
            >
              Ø¨Ø§Ø²Ú¯Ø´Øª
            </button>
          </div>
        );
      }

      return (
        <div className="space-y-6">
          {/* Header */}
          <div className="bg-white rounded-xl shadow p-6">
            <div className="flex items-center justify-between mb-4">
              <button
                onClick={onBack}
                className="flex items-center gap-2 text-gray-600 hover:text-gray-900"
              >
                â† Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ú©Ø§ØªØ§Ù„ÙˆÚ¯
              </button>
              <div className="flex gap-2">
                <span className={`px-3 py-1 text-sm rounded-full ${
                  challenge.status === 'published' ? 'bg-green-100 text-green-800' :
                  challenge.status === 'draft' ? 'bg-yellow-100 text-yellow-800' :
                  'bg-gray-100 text-gray-800'
                }`}>
                  {challenge.status === 'published' ? 'Ù…Ù†ØªØ´Ø± Ø´Ø¯Ù‡' :
                   challenge.status === 'draft' ? 'Ù¾ÛŒØ´â€ŒÙ†ÙˆÛŒØ³' :
                   challenge.status}
                </span>
                <span className="px-3 py-1 bg-blue-100 text-blue-800 text-sm rounded-full">
                  {challenge.category}
                </span>
              </div>
            </div>

            <div className="grid md:grid-cols-3 gap-6">
              <div className="md:col-span-2">
                <h1 className="text-3xl font-bold text-gray-900 mb-2">
                  {challenge.title}
                </h1>
                <p className="text-gray-600 mb-4">
                  ØªÙˆØ³Ø· {org?.name || 'Ø³Ø§Ø²Ù…Ø§Ù† Ù†Ø§Ù…Ø´Ø®Øµ'}
                </p>
              </div>
              <div className="text-left">
                <div className="text-3xl font-bold text-green-600 mb-2">
                  {formatReward(challenge.reward)} ØªÙˆÙ…Ø§Ù†
                </div>
                <div className={`text-sm ${
                  getDaysLeft(challenge.deadline) > 7 ? 'text-green-600' :
                  getDaysLeft(challenge.deadline) > 0 ? 'text-yellow-600' :
                  'text-red-600'
                }`}>
                  {getDaysLeft(challenge.deadline) > 0
                    ? `${getDaysLeft(challenge.deadline)} Ø±ÙˆØ² ØªØ§ Ù…Ù‡Ù„Øª`
                    : 'Ù…Ù‡Ù„Øª ØªÙ…Ø§Ù… Ø´Ø¯Ù‡'
                  }
                </div>
              </div>
            </div>

            <div className="mt-6 flex gap-4">
              {session?.role === 'SOLVER' && (
                <button
                  onClick={handleSolveChallenge}
                  disabled={isSubmitting}
                  className="px-8 py-3 bg-green-600 text-white text-lg font-semibold rounded-lg hover:bg-green-700 focus:ring-2 focus:ring-green-500 disabled:opacity-50 transition-colors"
                >
                  ğŸš€ Ø­Ù„ Ø§ÛŒÙ† Ú†Ø§Ù„Ø´
                </button>
              )}

              {/* Edit button for challenge owner (seeker) */}
              {session?.role === 'SEEKER' && session?.orgId === challenge.orgId && (
                <button
                  onClick={() => {
                    setEditingChallenge(challenge);
                    window.location.hash = 'create-challenge';
                  }}
                  className="px-8 py-3 bg-yellow-600 text-white text-lg font-semibold rounded-lg hover:bg-yellow-700 focus:ring-2 focus:ring-yellow-500 transition-colors"
                >
                  âœï¸ ÙˆÛŒØ±Ø§ÛŒØ´ Ú†Ø§Ù„Ø´
                </button>
              )}
            </div>
          </div>

          {/* Problem Description */}
          <div className="bg-white rounded-xl shadow p-6">
            <h2 className="text-xl font-semibold mb-4 flex items-center">
              <span className="ml-2">ğŸ“‹</span>
              ØªÙˆØ¶ÛŒØ­ Ù…Ø³Ø¦Ù„Ù‡
            </h2>
            <p className="text-gray-700 leading-relaxed text-lg">
              {challenge.problem}
            </p>
          </div>

          {/* Success Criteria */}
          <div className="bg-white rounded-xl shadow p-6">
            <h2 className="text-xl font-semibold mb-4 flex items-center">
              <span className="ml-2">âœ…</span>
              Ù…Ø¹ÛŒØ§Ø±Ù‡Ø§ÛŒ Ù…ÙˆÙÙ‚ÛŒØª
            </h2>
            <p className="text-gray-700 leading-relaxed">
              {challenge.success}
            </p>
          </div>

          {/* Deliverables */}
          <div className="bg-white rounded-xl shadow p-6">
            <h2 className="text-xl font-semibold mb-4 flex items-center">
              <span className="ml-2">ğŸ“¦</span>
              ØªØ­ÙˆÛŒÙ„â€ŒÙ¾Ø°ÛŒØ±Ù‡Ø§
            </h2>
            <p className="text-gray-700 leading-relaxed">
              {challenge.deliverables}
            </p>
          </div>

          {/* Tags */}
          <div className="bg-white rounded-xl shadow p-6">
            <h2 className="text-xl font-semibold mb-4 flex items-center">
              <span className="ml-2">ğŸ·ï¸</span>
              Ø¨Ø±Ú†Ø³Ø¨â€ŒÙ‡Ø§
            </h2>
            <div className="flex flex-wrap gap-2">
              {challenge.tags?.map((tag, index) => (
                <span key={index} className="px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm">
                  {tag}
                </span>
              ))}
            </div>
          </div>

          {/* Organization Info */}
          <div className="bg-white rounded-xl shadow p-6">
            <h2 className="text-xl font-semibold mb-4 flex items-center">
              <span className="ml-2">ğŸ¢</span>
              Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø³Ø§Ø²Ù…Ø§Ù†
            </h2>
            <div className="grid md:grid-cols-2 gap-6">
              <div>
                <h3 className="font-medium text-gray-900 mb-2">{org?.name || 'Ø³Ø§Ø²Ù…Ø§Ù† Ù†Ø§Ù…Ø´Ø®Øµ'}</h3>
                <p className="text-gray-600 mb-4">{org?.description || 'ØªÙˆØ¶ÛŒØ­ÛŒ Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛŒØ³Øª'}</p>
                <div className="space-y-2 text-sm text-gray-600">
                  {org?.website && (
                    <div>
                      ğŸŒ <a href={org.website} className="text-blue-600 hover:underline" target="_blank">
                        ÙˆØ¨â€ŒØ³Ø§ÛŒØª Ø³Ø§Ø²Ù…Ø§Ù†
                      </a>
                    </div>
                  )}
                  {org?.contactInfo?.phone && (
                    <div>ğŸ“ {org.contactInfo.phone}</div>
                  )}
                  {org?.contactInfo?.address && (
                    <div>ğŸ“ {org.contactInfo.address}</div>
                  )}
                </div>
              </div>
              <div>
                <h4 className="font-medium text-gray-900 mb-2">Ø­ÙˆØ²Ù‡â€ŒÙ‡Ø§ÛŒ ÙØ¹Ø§Ù„ÛŒØª</h4>
                <div className="flex flex-wrap gap-1">
                  {org?.domains?.map((domain, index) => (
                    <span key={index} className="px-2 py-1 bg-green-100 text-green-800 text-xs rounded">
                      {domain}
                    </span>
                  ))}
                </div>
              </div>
            </div>
          </div>

          {/* Attachments Placeholder */}
          {challenge.attachments?.length > 0 && (
            <div className="bg-white rounded-xl shadow p-6">
              <h2 className="text-xl font-semibold mb-4 flex items-center">
                <span className="ml-2">ğŸ“</span>
                Ù¾ÛŒÙˆØ³Øªâ€ŒÙ‡Ø§
              </h2>
              <div className="space-y-2">
                {challenge.attachments.map((attachment, index) => (
                  <div key={index} className="flex items-center gap-2 p-2 border rounded">
                    <span className="text-gray-600">ğŸ“„</span>
                    <span className="text-gray-700">{attachment}</span>
                    <button className="text-blue-600 hover:underline text-sm mr-auto">
                      Ø¯Ø§Ù†Ù„ÙˆØ¯
                    </button>
                  </div>
                ))}
              </div>
            </div>
          )}
        </div>
      );
    }

    // ================================
    // --- ROLE-SPECIFIC PAGES ---
    // ================================
    function AdminPage({ session }) {
      const [users, setUsers] = useLocalStorage(KEYS.users, []);
      const [orgs, setOrgs] = useLocalStorage(KEYS.orgs, []);
      const [notifications, setNotifications] = useLocalStorage(KEYS.notifications, []);
      const [selectedUser, setSelectedUser] = React.useState(null);
      const [selectedOrg, setSelectedOrg] = React.useState(null);

      // Get pending approvals
      const pendingUsers = users.filter(u => u.status === 'pending' && u.role !== 'ADMIN');
      const pendingOrgs = orgs.filter(o => o.status === 'pending');

      const approveUser = (userId) => {
        const updatedUsers = users.map(u =>
          u.id === userId ? { ...u, status: 'approved' } : u
        );
        setUsers(updatedUsers);

        // Remove notification
        const updatedNotifications = notifications.filter(n =>
          !(n.type === 'user_registration' && n.targetId === userId)
        );
        setNotifications(updatedNotifications);

        alert('Ú©Ø§Ø±Ø¨Ø± Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª ØªØ£ÛŒÛŒØ¯ Ø´Ø¯!');
      };

      const rejectUser = (userId) => {
        const updatedUsers = users.map(u =>
          u.id === userId ? { ...u, status: 'rejected' } : u
        );
        setUsers(updatedUsers);

        // Remove notification
        const updatedNotifications = notifications.filter(n =>
          !(n.type === 'user_registration' && n.targetId === userId)
        );
        setNotifications(updatedNotifications);

        alert('Ú©Ø§Ø±Ø¨Ø± Ø±Ø¯ Ø´Ø¯!');
      };

      const approveOrg = (orgId, userId) => {
        const updatedOrgs = orgs.map(o =>
          o.id === orgId ? { ...o, status: 'approved' } : o
        );
        const updatedUsers = users.map(u =>
          u.id === userId ? { ...u, status: 'approved' } : u
        );
        setOrgs(updatedOrgs);
        setUsers(updatedUsers);

        // Remove notification
        const updatedNotifications = notifications.filter(n =>
          !(n.type === 'org_request' && n.targetId === orgId)
        );
        setNotifications(updatedNotifications);

        alert('Ø³Ø§Ø²Ù…Ø§Ù† Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª ØªØ£ÛŒÛŒØ¯ Ø´Ø¯!');
      };

      const rejectOrg = (orgId, userId) => {
        const updatedOrgs = orgs.map(o =>
          o.id === orgId ? { ...o, status: 'rejected' } : o
        );
        const updatedUsers = users.map(u =>
          u.id === userId ? { ...u, status: 'rejected' } : u
        );
        setOrgs(updatedOrgs);
        setUsers(updatedUsers);

        // Remove notification
        const updatedNotifications = notifications.filter(n =>
          !(n.type === 'org_request' && n.targetId === orgId)
        );
        setNotifications(updatedNotifications);

        alert('Ø³Ø§Ø²Ù…Ø§Ù† Ø±Ø¯ Ø´Ø¯!');
      };

      return (
        <div className="space-y-6">
          <header className="text-center py-6">
            <h1 className="text-2xl font-bold text-gray-900 mb-2">Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª</h1>
            <p className="text-gray-600">Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ùˆ Ø³Ø§Ø²Ù…Ø§Ù†â€ŒÙ‡Ø§</p>
          </header>

          <div className="grid md:grid-cols-2 gap-6">
            {/* Pending Users */}
            <div className="bg-white rounded-xl shadow p-6">
              <h2 className="text-lg font-semibold mb-4 flex items-center">
                <span className="ml-2">ğŸ‘¤</span>
                Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± ØªØ£ÛŒÛŒØ¯ ({pendingUsers.length})
              </h2>

              {pendingUsers.length > 0 ? (
                <div className="space-y-4">
                  {pendingUsers.map(user => (
                    <div key={user.id} className="border border-yellow-200 rounded-lg p-4 bg-yellow-50">
                      <div className="flex items-center justify-between mb-2">
                        <div>
                          <h3 className="font-medium">{user.name}</h3>
                          <p className="text-sm text-gray-600">{user.email}</p>
                          <p className="text-xs text-gray-500">
                            {user.role === 'SOLVER' ? 'Ø­Ù„â€ŒÚ©Ù†Ù†Ø¯Ù‡' : 'Ø¬Ø³ØªØ¬ÙˆÚ¯Ø±'}
                          </p>
                        </div>
                        <div className="flex gap-2">
                          <button
                            onClick={() => setSelectedUser(user)}
                            className="px-3 py-1 bg-blue-500 text-white text-xs rounded hover:bg-blue-600"
                          >
                            Ù…Ø´Ø§Ù‡Ø¯Ù‡
                          </button>
                          <button
                            onClick={() => approveUser(user.id)}
                            className="px-3 py-1 bg-green-500 text-white text-xs rounded hover:bg-green-600"
                          >
                            ØªØ£ÛŒÛŒØ¯
                          </button>
                          <button
                            onClick={() => rejectUser(user.id)}
                            className="px-3 py-1 bg-red-500 text-white text-xs rounded hover:bg-red-600"
                          >
                            Ø±Ø¯
                          </button>
                        </div>
                      </div>
                      {user.bio && (
                        <p className="text-sm text-gray-700 mt-2">{user.bio}</p>
                      )}
                    </div>
                  ))}
                </div>
              ) : (
                <p className="text-gray-500 text-center py-4">Ú©Ø§Ø±Ø¨Ø± Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± ØªØ£ÛŒÛŒØ¯ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯</p>
              )}
            </div>

            {/* Pending Organizations */}
            <div className="bg-white rounded-xl shadow p-6">
              <h2 className="text-lg font-semibold mb-4 flex items-center">
                <span className="ml-2">ğŸ¢</span>
                Ø³Ø§Ø²Ù…Ø§Ù†â€ŒÙ‡Ø§ Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± ØªØ£ÛŒÛŒØ¯ ({pendingOrgs.length})
              </h2>

              {pendingOrgs.length > 0 ? (
                <div className="space-y-4">
                  {pendingOrgs.map(org => {
                    const user = users.find(u => u.orgId === org.id);
                    return (
                      <div key={org.id} className="border border-yellow-200 rounded-lg p-4 bg-yellow-50">
                        <div className="flex items-center justify-between mb-2">
                          <div>
                            <h3 className="font-medium">{org.name}</h3>
                            <p className="text-sm text-gray-600">
                              Ù†Ù…Ø§ÛŒÙ†Ø¯Ù‡: {user?.name || 'Ù†Ø§Ù…Ø´Ø®Øµ'}
                            </p>
                            <div className="flex gap-1 mt-1">
                              {org.domains?.map((domain, index) => (
                                <span key={index} className="px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded">
                                  {domain}
                                </span>
                              ))}
                            </div>
                          </div>
                          <div className="flex gap-2">
                            <button
                              onClick={() => setSelectedOrg({ org, user })}
                              className="px-3 py-1 bg-blue-500 text-white text-xs rounded hover:bg-blue-600"
                            >
                              Ù…Ø´Ø§Ù‡Ø¯Ù‡
                            </button>
                            <button
                              onClick={() => approveOrg(org.id, user?.id)}
                              className="px-3 py-1 bg-green-500 text-white text-xs rounded hover:bg-green-600"
                            >
                              ØªØ£ÛŒÛŒØ¯
                            </button>
                            <button
                              onClick={() => rejectOrg(org.id, user?.id)}
                              className="px-3 py-1 bg-red-500 text-white text-xs rounded hover:bg-red-600"
                            >
                              Ø±Ø¯
                            </button>
                          </div>
                        </div>
                        <p className="text-sm text-gray-700 mt-2">
                          {org.description || 'ØªÙˆØ¶ÛŒØ­ÛŒ ÙˆØ§Ø±Ø¯ Ù†Ø´Ø¯Ù‡'}
                        </p>
                      </div>
                    );
                  })}
                </div>
              ) : (
                <p className="text-gray-500 text-center py-4">Ø³Ø§Ø²Ù…Ø§Ù† Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± ØªØ£ÛŒÛŒØ¯ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯</p>
              )}
            </div>
          </div>

          {/* Statistics */}
          <div className="bg-white rounded-xl shadow p-6">
            <h2 className="text-lg font-semibold mb-4">Ø¢Ù…Ø§Ø± Ø³ÛŒØ³ØªÙ…</h2>
            <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
              <div className="text-center">
                <div className="text-2xl font-bold text-blue-600">{users.length}</div>
                <div className="text-sm text-gray-600">Ú©Ø§Ø±Ø¨Ø± Ú©Ù„</div>
              </div>
              <div className="text-center">
                <div className="text-2xl font-bold text-green-600">{orgs.length}</div>
                <div className="text-sm text-gray-600">Ø³Ø§Ø²Ù…Ø§Ù† Ú©Ù„</div>
              </div>
              <div className="text-center">
                <div className="text-2xl font-bold text-yellow-600">{pendingUsers.length + pendingOrgs.length}</div>
                <div className="text-sm text-gray-600">Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± ØªØ£ÛŒÛŒØ¯</div>
              </div>
              <div className="text-center">
                <div className="text-2xl font-bold text-purple-600">
                  {users.filter(u => u.role === 'ADMIN').length}
                </div>
                <div className="text-sm text-gray-600">Ù…Ø¯ÛŒØ± Ø³ÛŒØ³ØªÙ…</div>
              </div>
            </div>
          </div>

          {/* User/Org Details Modal would go here in full implementation */}
          {selectedUser && (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
              <div className="bg-white rounded-xl p-6 max-w-2xl w-full mx-4 max-h-96 overflow-y-auto">
                <div className="flex justify-between items-center mb-4">
                  <h3 className="text-lg font-semibold">Ø¬Ø²Ø¦ÛŒØ§Øª Ú©Ø§Ø±Ø¨Ø±</h3>
                  <button
                    onClick={() => setSelectedUser(null)}
                    className="text-gray-500 hover:text-gray-700"
                  >
                    âœ•
                  </button>
                </div>
                <SolverProfile user={selectedUser} />
              </div>
            </div>
          )}

          {selectedOrg && (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
              <div className="bg-white rounded-xl p-6 max-w-2xl w-full mx-4 max-h-96 overflow-y-auto">
                <div className="flex justify-between items-center mb-4">
                  <h3 className="text-lg font-semibold">Ø¬Ø²Ø¦ÛŒØ§Øª Ø³Ø§Ø²Ù…Ø§Ù†</h3>
                  <button
                    onClick={() => setSelectedOrg(null)}
                    className="text-gray-500 hover:text-gray-700"
                  >
                    âœ•
                  </button>
                </div>
                <SeekerProfile user={selectedOrg.user} org={selectedOrg.org} />
              </div>
            </div>
          )}
        </div>
      );
    }

    function MyChallengesPage({ session, challenges, orgs }) {
      const userChallenges = challenges.filter(c => {
        const org = orgs.find(o => o.id === session?.orgId);
        return org && c.orgId === org.id;
      });

      return (
        <div className="space-y-6">
          <header className="text-center py-6">
            <h1 className="text-2xl font-bold text-gray-900 mb-2">Ú†Ø§Ù„Ø´â€ŒÙ‡Ø§ÛŒ Ù…Ù†</h1>
            <p className="text-gray-600">Ù…Ø¯ÛŒØ±ÛŒØª Ú†Ø§Ù„Ø´â€ŒÙ‡Ø§ÛŒ Ù…Ù†ØªØ´Ø± Ø´Ø¯Ù‡</p>
          </header>
          
          <div className="bg-white rounded-xl shadow p-6">
            <div className="flex justify-between items-center mb-4">
              <h2 className="text-lg font-semibold">ğŸ“ Ú†Ø§Ù„Ø´â€ŒÙ‡Ø§ÛŒ Ø´Ù…Ø§</h2>
              <button
                onClick={() => window.location.hash = 'create-challenge'}
                className="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center gap-2"
              >
                <span>â•</span>
                Ú†Ø§Ù„Ø´ Ø¬Ø¯ÛŒØ¯
              </button>
            </div>

            {userChallenges.length > 0 ? (
              <div className="space-y-4">
                {userChallenges.map(challenge => (
                  <div key={challenge.id} className="p-4 border rounded-lg hover:bg-gray-50 transition-colors">
                    <div className="flex justify-between items-start mb-2">
                      <div className="flex-1">
                        <h3 className="font-medium">{challenge.title}</h3>
                        <p className="text-sm text-gray-600 mt-1 line-clamp-2">{challenge.problem}</p>
                      </div>
                      <div className="flex gap-2 mr-4">
                        <button
                          onClick={() => {
                            setSelectedChallenge(challenge);
                            navigate('challenge-detail');
                          }}
                          className="px-3 py-1 bg-blue-500 text-white text-xs rounded hover:bg-blue-600"
                        >
                          Ù…Ø´Ø§Ù‡Ø¯Ù‡
                        </button>
                        <button
                          onClick={() => {
                            setEditingChallenge(challenge);
                            navigate('create-challenge');
                          }}
                          className="px-3 py-1 bg-yellow-500 text-white text-xs rounded hover:bg-yellow-600"
                        >
                          ÙˆÛŒØ±Ø§ÛŒØ´
                        </button>
                      </div>
                    </div>
                    <div className="flex items-center gap-4 text-xs text-gray-500">
                      <span>ğŸ’° {challenge.reward.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù†</span>
                      <span>ğŸ“Š {challenge.status}</span>
                      <span>â° {new Date(challenge.deadline).toLocaleDateString('fa-IR')}</span>
                    </div>
                  </div>
                ))}
              </div>
            ) : (
              <div className="text-center py-8">
                <div className="text-4xl mb-4">ğŸ¯</div>
                <p className="text-gray-500 mb-4">Ù‡Ù†ÙˆØ² Ú†Ø§Ù„Ø´ÛŒ Ù…Ù†ØªØ´Ø± Ù†Ú©Ø±Ø¯Ù‡â€ŒØ§ÛŒØ¯.</p>
                <p className="text-sm text-gray-400">
                  Ø¨Ø±Ø§ÛŒ Ø´Ø±ÙˆØ¹ØŒ Ø±ÙˆÛŒ Ø¯Ú©Ù…Ù‡ "Ú†Ø§Ù„Ø´ Ø¬Ø¯ÛŒØ¯" Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯.
                </p>
              </div>
            )}
            
            <div className="mt-6">
              <p className="text-sm text-gray-600">
                ğŸš§ Ø§ÛŒØ¬Ø§Ø¯ Ú†Ø§Ù„Ø´ Ø¬Ø¯ÛŒØ¯ Ùˆ Ù…Ø¯ÛŒØ±ÛŒØª Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯Ø§Øª Ø¯Ø± Ù…Ø±Ø­Ù„Ù‡ Ø¨Ø¹Ø¯ÛŒ Ø§Ø¶Ø§ÙÙ‡ Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯.
              </p>
            </div>
          </div>
        </div>
      );
    }

    // Submissions Management Table for Seekers
    // Rubric and Scoring System
    function SubmissionScoring({ submission, challenge, onScoreUpdate, onClose }) {
      const [scores, setScores] = React.useState({
        fit: submission.scores?.fit || 0,
        feasibility: submission.scores?.feasibility || 0,
        costTime: submission.scores?.costTime || 0,
        innovation: submission.scores?.innovation || 0
      });

      const rubric = {
        fit: { weight: 0.40, label: 'ØªØ·Ø§Ø¨Ù‚ Ø¨Ø§ Ù†ÛŒØ§Ø²Ù‡Ø§', description: 'Ú†Ù‚Ø¯Ø± Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ø¨Ø§ Ù†ÛŒØ§Ø²Ù‡Ø§ÛŒ ØªØ¹Ø±ÛŒÙ Ø´Ø¯Ù‡ Ú†Ø§Ù„Ø´ Ù…Ø·Ø§Ø¨Ù‚Øª Ø¯Ø§Ø±Ø¯' },
        feasibility: { weight: 0.25, label: 'Ù‚Ø§Ø¨Ù„ Ø§Ø¬Ø±Ø§ Ø¨ÙˆØ¯Ù†', description: 'Ú†Ù‚Ø¯Ø± Ø§Ø¬Ø±Ø§ÛŒ ÙÙ†ÛŒ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ø¹Ù…Ù„ÛŒ Ùˆ Ù…Ù…Ú©Ù† Ø§Ø³Øª' },
        costTime: { weight: 0.20, label: 'Ù‡Ø²ÛŒÙ†Ù‡ Ùˆ Ø²Ù…Ø§Ù†', description: 'Ø¨Ù‡ÛŒÙ†Ú¯ÛŒ Ù‡Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ Ùˆ Ø²Ù…Ø§Ù† Ø§Ø¬Ø±Ø§ÛŒ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯' },
        innovation: { weight: 0.15, label: 'Ù†ÙˆØ¢ÙˆØ±ÛŒ', description: 'Ù…ÛŒØ²Ø§Ù† Ø®Ù„Ø§Ù‚ÛŒØª Ùˆ Ù†ÙˆØ¢ÙˆØ±ÛŒ Ø¯Ø± Ø±ÙˆÛŒÚ©Ø±Ø¯ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ' }
      };

      const calculateTotal = () => {
        return (
          scores.fit * rubric.fit.weight +
          scores.feasibility * rubric.feasibility.weight +
          scores.costTime * rubric.costTime.weight +
          scores.innovation * rubric.innovation.weight
        ).toFixed(1);
      };

      const handleSave = () => {
        const totalScore = parseFloat(calculateTotal());
        const updatedSubmission = {
          ...submission,
          scores: {
            fit: scores.fit,
            feasibility: scores.feasibility,
            costTime: scores.costTime,
            innovation: scores.innovation,
            total: totalScore
          },
          scoredAt: new Date().toISOString()
        };

        onScoreUpdate(updatedSubmission);
        onClose();
      };

      const updateScore = (category, value) => {
        setScores(prev => ({ ...prev, [category]: parseInt(value) || 0 }));
      };

      return (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
          <div className="bg-white rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
            <div className="p-6">
              <div className="flex justify-between items-center mb-6">
                <div>
                  <h2 className="text-2xl font-bold text-gray-900">Ù†Ù…Ø±Ù‡â€ŒØ¯Ù‡ÛŒ Ø¨Ù‡ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯</h2>
                  <p className="text-gray-600 mt-1">{challenge.title}</p>
                </div>
                <button
                  onClick={onClose}
                  className="text-gray-400 hover:text-gray-600 text-2xl"
                >
                  âœ•
                </button>
              </div>

              {/* Submission Summary */}
              <div className="bg-gray-50 rounded-lg p-4 mb-6">
                <h3 className="font-semibold text-gray-900 mb-2">Ø®Ù„Ø§ØµÙ‡ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯:</h3>
                <p className="text-gray-700">{submission.data.summary}</p>
              </div>

              {/* Rubric Scoring */}
              <div className="space-y-6">
                {Object.entries(rubric).map(([key, item]) => (
                  <div key={key} className="border border-gray-200 rounded-lg p-4">
                    <div className="flex justify-between items-start mb-3">
                      <div>
                        <h4 className="font-semibold text-gray-900">{item.label}</h4>
                        <p className="text-gray-600 text-sm">{item.description}</p>
                        <p className="text-blue-600 font-medium mt-1">ÙˆØ²Ù†: {(item.weight * 100).toFixed(0)}%</p>
                      </div>
                      <div className="text-left">
                        <div className="text-2xl font-bold text-gray-900">
                          {scores[key] || 0}/10
                        </div>
                        <div className="text-sm text-gray-600">
                          Ø§Ù…ØªÛŒØ§Ø²: {((scores[key] || 0) * item.weight).toFixed(1)}
                        </div>
                      </div>
                    </div>

                    <div className="flex items-center gap-4">
                      <input
                        type="range"
                        min="0"
                        max="10"
                        value={scores[key] || 0}
                        onChange={(e) => updateScore(key, e.target.value)}
                        className="flex-1 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"
                      />
                      <input
                        type="number"
                        min="0"
                        max="10"
                        value={scores[key] || 0}
                        onChange={(e) => updateScore(key, e.target.value)}
                        className="w-16 px-2 py-1 border border-gray-300 rounded text-center"
                      />
                    </div>
                  </div>
                ))}
              </div>

              {/* Total Score */}
              <div className="bg-blue-50 border border-blue-200 rounded-lg p-6 mt-6">
                <div className="flex justify-between items-center">
                  <div>
                    <h3 className="text-xl font-bold text-blue-900">Ù†Ù…Ø±Ù‡ Ú©Ù„</h3>
                    <p className="text-blue-700 text-sm">Ù…Ø¬Ù…ÙˆØ¹ Ù†Ù…Ø±Ø§Øª ÙˆØ²Ù†ÛŒ</p>
                  </div>
                  <div className="text-4xl font-bold text-blue-600">
                    {calculateTotal()}/10
                  </div>
                </div>
              </div>

              {/* Action Buttons */}
              <div className="flex gap-4 mt-6">
                <button
                  onClick={handleSave}
                  className="flex-1 px-6 py-3 bg-green-600 text-white text-lg font-semibold rounded-lg hover:bg-green-700 focus:ring-2 focus:ring-green-500 disabled:opacity-50 transition-colors"
                >
                  ğŸ’¾ Ø°Ø®ÛŒØ±Ù‡ Ù†Ù…Ø±Ø§Øª
                </button>
                <button
                  onClick={onClose}
                  className="px-6 py-3 bg-gray-600 text-white text-lg font-semibold rounded-lg hover:bg-gray-700 focus:ring-2 focus:ring-gray-500 transition-colors"
                >
                  Ø§Ù†ØµØ±Ø§Ù
                </button>
              </div>
            </div>
          </div>
        </div>
      );
    }

    // Comparison View Component
    function SubmissionsComparison({ submissions, challenge, onSelectWinner, onClose }) {
      const [selectedSubmissions, setSelectedSubmissions] = React.useState([]);

      const toggleSubmission = (submissionId) => {
        setSelectedSubmissions(prev =>
          prev.includes(submissionId)
            ? prev.filter(id => id !== submissionId)
            : prev.length < 2
            ? [...prev, submissionId]
            : prev
        );
      };

      const getSelectedSubmissions = () => {
        return submissions.filter(sub => selectedSubmissions.includes(sub.id));
      };

      const handleSelectWinner = (submissionId) => {
        const winner = submissions.find(sub => sub.id === submissionId);
        if (winner) {
          onSelectWinner(winner);
          onClose();
        }
      };

      return (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
          <div className="bg-white rounded-xl shadow-2xl max-w-7xl w-full max-h-[90vh] overflow-y-auto">
            <div className="p-6">
              <div className="flex justify-between items-center mb-6">
                <div>
                  <h2 className="text-2xl font-bold text-gray-900">Ù…Ù‚Ø§ÛŒØ³Ù‡ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯Ø§Øª</h2>
                  <p className="text-gray-600 mt-1">{challenge.title}</p>
                </div>
                <button
                  onClick={onClose}
                  className="text-gray-400 hover:text-gray-600 text-2xl"
                >
                  âœ•
                </button>
              </div>

              {/* Submission Selection */}
              <div className="bg-gray-50 rounded-lg p-4 mb-6">
                <h3 className="font-semibold text-gray-900 mb-3">Ø§Ù†ØªØ®Ø§Ø¨ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯Ø§Øª Ø¨Ø±Ø§ÛŒ Ù…Ù‚Ø§ÛŒØ³Ù‡:</h3>
                <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-3">
                  {submissions.map(submission => {
                    const user = JSON.parse(localStorage.getItem('users') || '[]').find(u => u.id === submission.userId);
                    const isSelected = selectedSubmissions.includes(submission.id);
                    const hasScore = submission.scores?.total;

                    return (
                      <div
                        key={submission.id}
                        className={`border-2 rounded-lg p-3 cursor-pointer transition-colors ${
                          isSelected
                            ? 'border-blue-500 bg-blue-50'
                            : 'border-gray-200 hover:border-gray-300'
                        } ${!hasScore ? 'opacity-50' : ''}`}
                        onClick={() => hasScore && toggleSubmission(submission.id)}
                      >
                        <div className="flex items-center justify-between mb-2">
                          <span className={`text-sm ${isSelected ? 'text-blue-700 font-medium' : 'text-gray-700'}`}>
                            {user?.name || 'Ù†Ø§Ø´Ù†Ø§Ø³'}
                          </span>
                          {hasScore && (
                            <span className="text-lg font-bold text-green-600">
                              {submission.scores.total}/10
                            </span>
                          )}
                        </div>
                        <p className="text-sm text-gray-600 line-clamp-2">{submission.data.summary}</p>
                        {!hasScore && (
                          <p className="text-xs text-orange-600 mt-1">Ù‡Ù†ÙˆØ² Ù†Ù…Ø±Ù‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ Ù†Ø´Ø¯Ù‡</p>
                        )}
                      </div>
                    );
                  })}
                </div>
              </div>

              {/* Side-by-Side Comparison */}
              {selectedSubmissions.length === 2 && (
                <div className="grid md:grid-cols-2 gap-6">
                  {getSelectedSubmissions().map((submission, index) => {
                    const user = JSON.parse(localStorage.getItem('users') || '[]').find(u => u.id === submission.userId);

                    return (
                      <div key={submission.id} className="border border-gray-200 rounded-lg p-6">
                        <div className="flex items-center justify-between mb-4">
                          <h3 className="text-lg font-semibold text-gray-900">
                            Ú¯Ø²ÛŒÙ†Ù‡ {index + 1}: {user?.name || 'Ù†Ø§Ø´Ù†Ø§Ø³'}
                          </h3>
                          {submission.scores?.total && (
                            <div className="text-right">
                              <div className="text-2xl font-bold text-green-600">
                                {submission.scores.total}/10
                              </div>
                              <button
                                onClick={() => handleSelectWinner(submission.id)}
                                className="mt-2 px-4 py-2 bg-green-600 text-white text-sm rounded-lg hover:bg-green-700 transition-colors"
                              >
                                ğŸ† Ø§Ù†ØªØ®Ø§Ø¨ Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† Ø¨Ø±Ù†Ø¯Ù‡
                              </button>
                            </div>
                          )}
                        </div>

                        {/* Scores Breakdown */}
                        {submission.scores && (
                          <div className="grid grid-cols-2 gap-4 mb-4">
                            <div className="bg-blue-50 p-3 rounded">
                              <div className="text-sm text-blue-700">ØªØ·Ø§Ø¨Ù‚</div>
                              <div className="text-lg font-bold">{submission.scores.fit}/10</div>
                            </div>
                            <div className="bg-purple-50 p-3 rounded">
                              <div className="text-sm text-purple-700">Ù‚Ø§Ø¨Ù„ Ø§Ø¬Ø±Ø§</div>
                              <div className="text-lg font-bold">{submission.scores.feasibility}/10</div>
                            </div>
                            <div className="bg-orange-50 p-3 rounded">
                              <div className="text-sm text-orange-700">Ù‡Ø²ÛŒÙ†Ù‡/Ø²Ù…Ø§Ù†</div>
                              <div className="text-lg font-bold">{submission.scores.costTime}/10</div>
                            </div>
                            <div className="bg-pink-50 p-3 rounded">
                              <div className="text-sm text-pink-700">Ù†ÙˆØ¢ÙˆØ±ÛŒ</div>
                              <div className="text-lg font-bold">{submission.scores.innovation}/10</div>
                            </div>
                          </div>
                        )}

                        {/* Proposal Details */}
                        <div className="space-y-3">
                          <div>
                            <h4 className="font-medium text-gray-900">Ø®Ù„Ø§ØµÙ‡:</h4>
                            <p className="text-gray-700 text-sm">{submission.data.summary}</p>
                          </div>
                          <div>
                            <h4 className="font-medium text-gray-900">Ø¬Ø²Ø¦ÛŒØ§Øª:</h4>
                            <p className="text-gray-700 text-sm line-clamp-4">{submission.data.proposal}</p>
                          </div>
                          <div className="flex items-center gap-4 text-sm text-gray-500">
                            <span>ğŸ“… {new Date(submission.createdAt).toLocaleDateString('fa-IR')}</span>
                            {submission.data.files?.length > 0 && (
                              <span>ğŸ“ {submission.data.files.length} ÙØ§ÛŒÙ„</span>
                            )}
                            {submission.data.video && <span>ğŸ¥ ÙˆÛŒØ¯ÛŒÙˆ</span>}
                          </div>
                        </div>
                      </div>
                    );
                  })}
                </div>
              )}

              {selectedSubmissions.length !== 2 && (
                <div className="text-center py-12">
                  <div className="text-4xl mb-4">âš–ï¸</div>
                  <p className="text-gray-500">
                    Ù„Ø·ÙØ§Ù‹ Ø¯Ù‚ÛŒÙ‚Ø§Ù‹ Û² Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ø±Ø§ Ø¨Ø±Ø§ÛŒ Ù…Ù‚Ø§ÛŒØ³Ù‡ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯
                  </p>
                </div>
              )}
            </div>
          </div>
        </div>
      );
    }

    // Duplicate ToastContainer removed; using single definition above.

    // Reputation update function
    const updateReputation = (userId, points, reason) => {
      const users = storage.get(KEYS.users, []);
      const userIndex = users.findIndex(u => u.id === userId);

      if (userIndex !== -1) {
        users[userIndex].reputation = (users[userIndex].reputation || 0) + points;
        storage.set(KEYS.users, users);

        // Add reputation event
        const reputationEvents = storage.get(KEYS.reputationEvents, []);
        reputationEvents.push({
          id: `rep-${Date.now()}`,
          userId: userId,
          type: reason,
          points: points,
          at: new Date().toISOString(),
          description: `Ø§Ù…ØªÛŒØ§Ø² ${points > 0 ? 'Ú©Ø³Ø¨ Ø´Ø¯Ù‡' : 'Ú©Ø§Ù‡Ø´ ÛŒØ§ÙØªÙ‡'} Ø¨Ù‡ Ø¯Ù„ÛŒÙ„: ${reason}`
        });
        storage.set(KEYS.reputationEvents, reputationEvents);

        return users[userIndex];
      }
      return null;
    };

    // Message Thread Component
    function MessageThread({ submission, session, users, onSendMessage, onMarkAsRead }) {
      const [newMessage, setNewMessage] = React.useState('');
      const [sending, setSending] = React.useState(false);

      // Get messages for this submission
      const submissionMessages = JSON.parse(localStorage.getItem('messages') || '[]')
        .filter(msg => msg.submissionId === submission.id)
        .sort((a, b) => new Date(a.createdAt) - new Date(b.createdAt));

      // Mark messages as read when viewing
      React.useEffect(() => {
        const unreadMessages = submissionMessages.filter(msg =>
          msg.fromUserId !== session.userId && !msg.readAt
        );

        if (unreadMessages.length > 0) {
          unreadMessages.forEach(msg => {
            const allMessages = JSON.parse(localStorage.getItem('messages') || '[]');
            const messageIndex = allMessages.findIndex(m => m.id === msg.id);
            if (messageIndex !== -1) {
              allMessages[messageIndex].readAt = new Date().toISOString();
              localStorage.setItem('messages', JSON.stringify(allMessages));
            }
          });
          onMarkAsRead && onMarkAsRead();
        }
      }, [submissionMessages, session.userId]);

      const handleSendMessage = async () => {
        if (!newMessage.trim()) return;

        setSending(true);
        try {
          const messageData = {
            id: `msg-${Date.now()}`,
            submissionId: submission.id,
            fromUserId: session.userId,
            body: newMessage.trim(),
            createdAt: new Date().toISOString(),
            readAt: null
          };

          const messages = JSON.parse(localStorage.getItem('messages') || '[]');
          messages.push(messageData);
          localStorage.setItem('messages', JSON.stringify(messages));

          onSendMessage && onSendMessage(messageData);
          setNewMessage('');

          // Show toast notification
          console.log('Message sent successfully');
        } catch (error) {
          console.error('Error sending message:', error);
        } finally {
          setSending(false);
        }
      };

      const getSenderName = (userId) => {
        const user = users.find(u => u.id === userId);
        return user?.name || 'Ù†Ø§Ø´Ù†Ø§Ø³';
      };

      const formatTime = (dateString) => {
        return new Date(dateString).toLocaleString('fa-IR', {
          year: 'numeric',
          month: 'short',
          day: 'numeric',
          hour: '2-digit',
          minute: '2-digit'
        });
      };

      return (
        <div className="flex flex-col h-full">
          {/* Header */}
          <div className="bg-white border-b p-4">
            <h3 className="text-lg font-semibold text-gray-900">
              Ú¯ÙØªÚ¯ÙˆÛŒ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯: {submission.data.summary.slice(0, 50)}...
            </h3>
            <p className="text-sm text-gray-600 mt-1">
              {(() => {
                const challenge = JSON.parse(localStorage.getItem('challenges') || '[]').find(c => c.id === submission.challengeId);
                const otherUserId = session.role === 'SEEKER'
                  ? submission.userId
                  : (challenge?.orgId === session.orgId ? submission.userId : 'u-seeker');

                return `Ø¨ÛŒÙ† ${getSenderName(session.userId)} Ùˆ ${getSenderName(otherUserId)}`;
              })()}
            </p>
          </div>

          {/* Messages */}
          <div className="flex-1 overflow-y-auto p-4 space-y-4">
            {submissionMessages.length > 0 ? (
              submissionMessages.map(message => {
                const isFromMe = message.fromUserId === session.userId;
                const sender = users.find(u => u.id === message.fromUserId);

                return (
                  <div key={message.id} className={`flex ${isFromMe ? 'justify-end' : 'justify-start'}`}>
                    <div className={`max-w-xs lg:max-w-md px-4 py-2 rounded-lg ${
                      isFromMe
                        ? 'bg-blue-500 text-white'
                        : 'bg-gray-200 text-gray-900'
                    }`}>
                      <div className="text-sm font-medium mb-1">
                        {sender?.name || 'Ù†Ø§Ø´Ù†Ø§Ø³'}
                      </div>
                      <div className="text-sm">{message.body}</div>
                      <div className={`text-xs mt-1 ${isFromMe ? 'text-blue-100' : 'text-gray-500'}`}>
                        {formatTime(message.createdAt)}
                        {message.readAt && isFromMe && (
                          <span className="ml-2">âœ“âœ“</span>
                        )}
                      </div>
                    </div>
                  </div>
                );
              })
            ) : (
              <div className="text-center py-8">
                <div className="text-4xl mb-4">ğŸ’¬</div>
                <p className="text-gray-500">Ù‡Ù†ÙˆØ² Ù¾ÛŒØ§Ù…ÛŒ Ø§Ø±Ø³Ø§Ù„ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª</p>
              </div>
            )}
          </div>

          {/* Message Composer */}
          <div className="border-t bg-white p-4">
            <div className="flex gap-2">
              <textarea
                value={newMessage}
                onChange={(e) => setNewMessage(e.target.value)}
                placeholder="Ù¾ÛŒØ§Ù… Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯..."
                className="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 resize-none"
                rows="2"
                onKeyPress={(e) => {
                  if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    handleSendMessage();
                  }
                }}
              />
              <button
                onClick={handleSendMessage}
                disabled={sending || !newMessage.trim()}
                className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
              >
                {sending ? 'Ø¯Ø± Ø­Ø§Ù„ Ø§Ø±Ø³Ø§Ù„...' : 'ğŸ“¤ Ø§Ø±Ø³Ø§Ù„'}
              </button>
            </div>
          </div>
        </div>
      );
    }

    // Messages Overview Component
    function MessagesOverview({ session, submissions, challenges, users, onSelectThread }) {
      const [messages, setMessages] = React.useState([]);

      React.useEffect(() => {
        const allMessages = JSON.parse(localStorage.getItem('messages') || '[]');
        setMessages(allMessages);
      }, []);

      // Get threads for current user
      const getUserThreads = () => {
        if (session.role === 'ADMIN') {
          // Admin sees all threads
          return [...new Set(messages.map(msg => msg.submissionId))];
        } else {
          // Seeker sees threads for their organization's submissions
          // Solver sees threads for their submissions
          return [...new Set(
            messages
              .filter(msg => {
                const submission = JSON.parse(localStorage.getItem('submissions') || '[]')
                  .find(sub => sub.id === msg.submissionId);

                if (!submission) return false;

                if (session.role === 'SEEKER') {
                  const challenge = challenges.find(c => c.id === submission.challengeId);
                  return challenge && challenge.orgId === session.orgId;
                } else if (session.role === 'SOLVER') {
                  return submission.userId === session.userId;
                }

                return false;
              })
              .map(msg => msg.submissionId)
          )];
        }
      };

      const threads = getUserThreads();

      const getThreadInfo = (submissionId) => {
        const submission = submissions.find(sub => sub.id === submissionId);
        const threadMessages = messages.filter(msg => msg.submissionId === submissionId);
        const lastMessage = threadMessages.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt))[0];

        const unreadCount = threadMessages.filter(msg =>
          msg.fromUserId !== session.userId && !msg.readAt
        ).length;

        return {
          submission,
          lastMessage,
          unreadCount,
          totalMessages: threadMessages.length
        };
      };

      const formatTime = (dateString) => {
        const date = new Date(dateString);
        const now = new Date();
        const diffMs = now - date;
        const diffHours = diffMs / (1000 * 60 * 60);

        if (diffHours < 24) {
          return date.toLocaleTimeString('fa-IR', {
            hour: '2-digit',
            minute: '2-digit'
          });
        } else {
          return date.toLocaleDateString('fa-IR', {
            month: 'short',
            day: 'numeric'
          });
        }
      };

      return (
        <div className="space-y-6">
          <header className="text-center py-6">
            <h1 className="text-2xl font-bold text-gray-900 mb-2">Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§</h1>
            <p className="text-gray-600">Ú¯ÙØªÚ¯ÙˆÙ‡Ø§ÛŒ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯Ø§Øª</p>
          </header>

          <div className="bg-white rounded-xl shadow p-6">
            <h2 className="text-lg font-semibold mb-4">Ú¯ÙØªÚ¯ÙˆÙ‡Ø§</h2>

            {threads.length > 0 ? (
              <div className="space-y-3">
                {threads.map(submissionId => {
                  const { submission, lastMessage, unreadCount, totalMessages } = getThreadInfo(submissionId);
                  const challenge = challenges.find(c => c.id === submission?.challengeId);
                  const otherUserId = session.role === 'SEEKER'
                    ? submission?.userId
                    : challenge?.orgId;
                  const otherUser = users.find(u => u.id === otherUserId);

                  return (
                    <div
                      key={submissionId}
                      onClick={() => onSelectThread && onSelectThread(submission)}
                      className="p-4 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer transition-colors"
                    >
                      <div className="flex justify-between items-start">
                        <div className="flex-1">
                          <div className="flex items-center gap-2 mb-1">
                            <h3 className="font-medium text-gray-900">
                              {submission?.data.summary.slice(0, 60)}...
                            </h3>
                            {unreadCount > 0 && (
                              <span className="bg-red-500 text-white text-xs px-2 py-1 rounded-full">
                                {unreadCount}
                              </span>
                            )}
                          </div>
                          <p className="text-sm text-gray-600 mb-1">
                            Ú†Ø§Ù„Ø´: {challenge?.title || 'Ù†Ø§Ù…Ø´Ø®Øµ'}
                          </p>
                          <p className="text-sm text-gray-500">
                            Ø¨Ø§: {otherUser?.name || 'Ù†Ø§Ø´Ù†Ø§Ø³'}
                          </p>
                        </div>
                        <div className="text-left">
                          {lastMessage && (
                            <div className="text-xs text-gray-500">
                              {formatTime(lastMessage.createdAt)}
                            </div>
                          )}
                          <div className="text-xs text-gray-400 mt-1">
                            {totalMessages} Ù¾ÛŒØ§Ù…
                          </div>
                        </div>
                      </div>
                      {lastMessage && (
                        <div className="mt-2 text-sm text-gray-700 line-clamp-1">
                          {lastMessage.body}
                        </div>
                      )}
                    </div>
                  );
                })}
              </div>
            ) : (
              <div className="text-center py-12">
                <div className="text-4xl mb-4">ğŸ’¬</div>
                <p className="text-gray-500">Ù‡Ù†ÙˆØ² Ú¯ÙØªÚ¯ÙˆÛŒÛŒ Ù†Ø¯Ø§Ø±ÛŒØ¯</p>
                <p className="text-sm text-gray-400 mt-2">
                  Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ Ø¯Ø± Ø§ÛŒÙ† Ø¨Ø®Ø´ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ø®ÙˆØ§Ù‡Ù†Ø¯ Ø´Ø¯
                </p>
              </div>
            )}
          </div>
        </div>
      );
    }

    // Countdown Timer Component
    function CountdownTimer({ targetDate }) {
      const [timeLeft, setTimeLeft] = React.useState(calculateTimeLeft());

      function calculateTimeLeft() {
        const difference = new Date(targetDate) - new Date();
        let timeLeft = {};

        if (difference > 0) {
          timeLeft = {
            days: Math.floor(difference / (1000 * 60 * 60 * 24)),
            hours: Math.floor((difference / (1000 * 60 * 60)) % 24),
            minutes: Math.floor((difference / 1000 / 60) % 60),
            seconds: Math.floor((difference / 1000) % 60)
          };
        }

        return timeLeft;
      }

      React.useEffect(() => {
        const timer = setTimeout(() => {
          setTimeLeft(calculateTimeLeft());
        }, 1000);

        return () => clearTimeout(timer);
      });

      const timerComponents = [];

      Object.keys(timeLeft).forEach((interval) => {
        if (!timeLeft[interval]) {
          return;
        }

        const label = {
          days: 'Ø±ÙˆØ²',
          hours: 'Ø³Ø§Ø¹Øª',
          minutes: 'Ø¯Ù‚ÛŒÙ‚Ù‡',
          seconds: 'Ø«Ø§Ù†ÛŒÙ‡'
        }[interval];

        timerComponents.push(
          <span key={interval} className="mx-2">
            <span className="text-2xl font-bold text-blue-600">{timeLeft[interval]}</span>
            <span className="text-sm text-gray-600 mr-1">{label}</span>
          </span>
        );
      });

      return (
        <div className="text-center">
          {timerComponents.length ? (
            <div className="flex justify-center items-center">
              {timerComponents}
            </div>
          ) : (
            <div className="text-lg font-semibold text-green-600">
              ğŸ‰ Ù†Ù…Ø§ÛŒØ´Ú¯Ø§Ù‡ TESTA Ø¢ØºØ§Ø² Ø´Ø¯Ù‡ Ø§Ø³Øª!
            </div>
          )}
        </div>
      );
    }

    // Announcements Rolling Bulletin Component
    function RollingAnnouncements({ announcements }) {
      const [currentIndex, setCurrentIndex] = React.useState(0);

      React.useEffect(() => {
        const interval = setInterval(() => {
          setCurrentIndex((prevIndex) =>
            prevIndex === announcements.length - 1 ? 0 : prevIndex + 1
          );
        }, 4000); // Change announcement every 4 seconds

        return () => clearInterval(interval);
      }, [announcements.length]);

      if (!announcements || announcements.length === 0) {
        return null;
      }

      return (
        <div className="bg-gradient-to-r from-blue-600 to-purple-600 text-white p-4 rounded-lg shadow-lg mb-6">
          <div className="flex items-center justify-center">
            <div className="text-2xl mr-3">ğŸ“¢</div>
            <div className="text-center">
              <div className="font-semibold text-lg mb-1">Ø§Ø¹Ù„Ø§Ù† ÙˆÛŒÚ˜Ù‡</div>
              <div className="text-sm opacity-90">
                {announcements[currentIndex]}
              </div>
            </div>
          </div>
        </div>
      );
    }

    // Duplicate UI loader components removed (LoadingSpinner, SkeletonLoader, PageLoader, ButtonLoader).

    // Duplicate Enhanced Form Components removed; using earlier definitions.

    // Animation Components
    function FadeIn({ children, delay = 0, className = '' }) {
      return (
        <div
          className={`animate-fade-in ${className}`}
          style={{ animationDelay: `${delay}ms` }}
        >
          {children}
        </div>
      );
    }

    function SlideIn({ children, direction = 'up', delay = 0, className = '' }) {
      const directionClasses = {
        up: 'animate-slide-in-up',
        down: 'animate-slide-in-down',
        left: 'animate-slide-in-left',
        right: 'animate-slide-in-right'
      };

      return (
        <div
          className={`${directionClasses[direction]} ${className}`}
          style={{ animationDelay: `${delay}ms` }}
        >
          {children}
        </div>
      );
    }

    function ScaleIn({ children, delay = 0, className = '' }) {
      return (
        <div
          className={`animate-scale-in ${className}`}
          style={{ animationDelay: `${delay}ms` }}
        >
          {children}
        </div>
      );
    }

    // Notification System with Animations
    function Notification({ type = 'info', title, message, onClose, autoClose = 5000 }) {
      const [visible, setVisible] = React.useState(true);

      React.useEffect(() => {
        if (autoClose > 0) {
          const timer = setTimeout(() => {
            setVisible(false);
            setTimeout(onClose, 300); // Wait for animation
          }, autoClose);
          return () => clearTimeout(timer);
        }
      }, [autoClose, onClose]);

      const typeStyles = {
        success: 'bg-green-50 border-green-200 text-green-800',
        error: 'bg-red-50 border-red-200 text-red-800',
        warning: 'bg-yellow-50 border-yellow-200 text-yellow-800',
        info: 'bg-blue-50 border-blue-200 text-blue-800'
      };

      const iconStyles = {
        success: 'âœ…',
        error: 'âŒ',
        warning: 'âš ï¸',
        info: 'â„¹ï¸'
      };

      if (!visible) return null;

      return (
        <div className={`fixed top-4 left-4 z-50 max-w-sm animate-slide-in-right`}>
          <div className={`p-4 rounded-lg border shadow-lg ${typeStyles[type]}`}>
            <div className="flex items-start gap-3">
              <span className="text-lg">{iconStyles[type]}</span>
              <div className="flex-1">
                {title && <h4 className="font-semibold text-sm mb-1">{title}</h4>}
                <p className="text-sm">{message}</p>
              </div>
              <button
                onClick={() => {
                  setVisible(false);
                  setTimeout(onClose, 300);
                }}
                className="text-gray-400 hover:text-gray-600 transition-colors"
                aria-label="Ø¨Ø³ØªÙ† Ø§Ø¹Ù„Ø§Ù†"
              >
                âœ•
              </button>
            </div>
          </div>
        </div>
      );
    }

    // QR Code Generator Component
    function QRCodeGenerator({ text, size = 128, className = "" }) {
      const canvasRef = React.useRef(null);

      React.useEffect(() => {
        if (canvasRef.current && text) {
          generateQRCode(text, size);
        }
      }, [text, size]);

      const generateQRCode = (data, canvasSize) => {
        const canvas = canvasRef.current;
        const ctx = canvas.getContext('2d');

        // Clear canvas
        ctx.clearRect(0, 0, canvasSize, canvasSize);

        // Simple QR-like pattern generation (simplified for demo)
        // In a real implementation, you'd use a proper QR code library
        const pattern = generateQRPattern(data, 21); // 21x21 QR code

        const moduleSize = canvasSize / pattern.length;

        // Draw the pattern
        for (let y = 0; y < pattern.length; y++) {
          for (let x = 0; x < pattern.length; x++) {
            if (pattern[y][x]) {
              ctx.fillStyle = '#000000';
              ctx.fillRect(x * moduleSize, y * moduleSize, moduleSize, moduleSize);
            }
          }
        }

        // Add finder patterns (the big squares at corners)
        drawFinderPattern(ctx, 0, 0, moduleSize);
        drawFinderPattern(ctx, pattern.length - 7, 0, moduleSize);
        drawFinderPattern(ctx, 0, pattern.length - 7, moduleSize);
      };

      const generateQRPattern = (data, size) => {
        // Create a simple but more recognizable QR-like pattern
        const pattern = Array(size).fill().map(() => Array(size).fill(false));

        // Generate a hash from the data
        let hash = 0;
        for (let i = 0; i < data.length; i++) {
          hash = ((hash << 5) - hash) + data.charCodeAt(i);
          hash = hash & hash; // Convert to 32-bit integer
        }

        // Create a more structured pattern
        for (let i = 0; i < size; i++) {
          for (let j = 0; j < size; j++) {
            // Use multiple hash functions for better distribution
            const h1 = (hash + i * 31 + j * 37) % 2;
            const h2 = ((hash >> 8) + i * 41 + j * 43) % 2;
            const h3 = ((hash >> 16) + i * 47 + j * 53) % 2;

            // Combine patterns to create a more QR-like appearance
            pattern[i][j] = (h1 + h2 + h3) >= 2;
          }
        }

        // Reserve space for finder patterns (keep them solid)
        for (let i = 0; i < 7; i++) {
          for (let j = 0; j < 7; j++) {
            pattern[i][j] = true;
            pattern[size - 1 - i][j] = true;
            pattern[i][size - 1 - j] = true;
          }
        }

        // Add some timing patterns (alternating black/white)
        for (let i = 8; i < size - 8; i += 2) {
          pattern[6][i] = true; // Top timing pattern
          pattern[i][6] = true; // Left timing pattern
        }

        return pattern;
      };

      const drawFinderPattern = (ctx, startX, startY, moduleSize) => {
        const size = 7;
        ctx.fillStyle = '#000000';

        // Draw the outer square
        ctx.fillRect(startX * moduleSize, startY * moduleSize, size * moduleSize, size * moduleSize);

        // Draw the inner white square
        ctx.fillStyle = '#FFFFFF';
        ctx.fillRect((startX + 1) * moduleSize, (startY + 1) * moduleSize, 5 * moduleSize, 5 * moduleSize);

        // Draw the inner black square
        ctx.fillStyle = '#000000';
        ctx.fillRect((startX + 2) * moduleSize, (startY + 2) * moduleSize, 3 * moduleSize, 3 * moduleSize);
      };

      const downloadQR = () => {
        const canvas = canvasRef.current;
        const link = document.createElement('a');
        link.download = 'qr-code.png';
        link.href = canvas.toDataURL();
        link.click();
      };

      if (!text) {
        return (
          <div className={`flex items-center justify-center bg-gray-100 rounded-lg ${className}`}
               style={{ width: size, height: size }}>
            <div className="text-gray-400 text-sm">No data</div>
          </div>
        );
      }

      const scanQR = () => {
        // Simulate QR scan by navigating to the target route
        try {
          const url = new URL(text);
          if (url.pathname && url.pathname !== '/') {
            const route = url.pathname.substring(1); // Remove leading slash
            const hash = url.hash; // Get the hash part
            window.location.hash = route + hash;
            console.log('QR Scanned - Navigating to:', route + hash);

            // Update QR scan stats
            const currentStats = JSON.parse(localStorage.getItem('testaStats') || '{}');
            currentStats.qrScans = (currentStats.qrScans || 0) + 1;
            localStorage.setItem('testaStats', JSON.stringify(currentStats));
          }
        } catch (error) {
          console.error('Invalid QR code URL:', text);
        }
      };

      return (
        <div className={`inline-block ${className}`}>
          <canvas
            ref={canvasRef}
            width={size}
            height={size}
            className="border border-gray-300 rounded cursor-pointer hover:border-blue-500 transition-colors"
            onClick={scanQR}
            title="Ø¨Ø±Ø§ÛŒ Ø§Ø³Ú©Ù† Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯"
          />
          <div className="mt-2 flex gap-2">
            <button
              onClick={downloadQR}
              className="flex-1 px-2 py-1 bg-blue-600 text-white text-xs rounded hover:bg-blue-700 transition-colors"
            >
              ğŸ“¥ Ø¯Ø§Ù†Ù„ÙˆØ¯
            </button>
            <button
              onClick={scanQR}
              className="flex-1 px-2 py-1 bg-green-600 text-white text-xs rounded hover:bg-green-700 transition-colors"
            >
              ğŸ“± Ø§Ø³Ú©Ù†
            </button>
          </div>
        </div>
      );
    }

    // Statistics Dashboard Component
    function TESTAStatsPage({ session }) {
      const [stats, setStats] = React.useState({
        visitorsToday: 0,
        qrScans: 0,
        sessionsStarted: 0,
        eventRegistrations: 0,
        messagesSent: 0
      });

      React.useEffect(() => {
        // Load stats from localStorage or generate mock data
        const loadStats = () => {
          const today = new Date().toDateString();
          const storedStats = JSON.parse(localStorage.getItem('testaStats') || '{}');

          if (storedStats.date !== today) {
            // Reset for new day
            const newStats = {
              date: today,
              visitorsToday: Math.floor(Math.random() * 50) + 20,
              qrScans: Math.floor(Math.random() * 30) + 10,
              sessionsStarted: Math.floor(Math.random() * 15) + 5,
              eventRegistrations: JSON.parse(localStorage.getItem('eventRegistrations') || '[]').length,
              messagesSent: JSON.parse(localStorage.getItem('messages') || '[]').length
            };
            localStorage.setItem('testaStats', JSON.stringify(newStats));
            setStats(newStats);
          } else {
            setStats(storedStats);
          }
        };

        loadStats();

        // Update stats periodically
        const interval = setInterval(() => {
          const currentStats = JSON.parse(localStorage.getItem('testaStats') || '{}');
          setStats(currentStats);
        }, 5000);

        return () => clearInterval(interval);
      }, []);

      const SimpleBarChart = ({ data, maxValue, color = '#3B82F6' }) => {
        return (
          <div className="flex items-end gap-2 h-32">
            {data.map((value, index) => (
              <div key={index} className="flex flex-col items-center gap-1">
                <div
                  className="w-8 bg-blue-500 rounded-t transition-all duration-500"
                  style={{
                    height: `${(value / maxValue) * 100}%`,
                    backgroundColor: color
                  }}
                />
                <span className="text-xs text-gray-500">{value}</span>
              </div>
            ))}
          </div>
        );
      };

      const PieChart = ({ data, colors = ['#3B82F6', '#EF4444', '#10B981'] }) => {
        const total = data.reduce((sum, value) => sum + value, 0);
        let currentAngle = -90; // Start from top

        return (
          <div className="relative w-32 h-32 mx-auto">
            <svg viewBox="0 0 100 100" className="w-full h-full">
              {data.map((value, index) => {
                const angle = (value / total) * 360;
                const startAngle = currentAngle;
                const endAngle = currentAngle + angle;

                const x1 = 50 + 40 * Math.cos((startAngle * Math.PI) / 180);
                const y1 = 50 + 40 * Math.sin((startAngle * Math.PI) / 180);
                const x2 = 50 + 40 * Math.cos((endAngle * Math.PI) / 180);
                const y2 = 50 + 40 * Math.sin((endAngle * Math.PI) / 180);

                const largeArcFlag = angle > 180 ? 1 : 0;

                currentAngle = endAngle;

                return (
                  <path
                    key={index}
                    d={`M 50 50 L ${x1} ${y1} A 40 40 0 ${largeArcFlag} 1 ${x2} ${y2} Z`}
                    fill={colors[index % colors.length]}
                  />
                );
              })}
            </svg>
          </div>
        );
      };

      return (
        <div className="space-y-6">
          <header className="text-center py-6">
            <h1 className="text-2xl font-bold text-gray-900 mb-2">ğŸ“Š Ø¢Ù…Ø§Ø± TESTA</h1>
            <p className="text-gray-600">Ø¢Ù…Ø§Ø± Ù„Ø­Ø¸Ù‡â€ŒØ§ÛŒ Ù†Ù…Ø§ÛŒØ´Ú¯Ø§Ù‡</p>
          </header>

          {/* Key Metrics */}
          <div className="grid md:grid-cols-2 lg:grid-cols-4 gap-6">
            <div className="bg-white rounded-xl shadow p-6 text-center">
              <div className="text-3xl mb-2">ğŸ‘¥</div>
              <div className="text-2xl font-bold text-blue-600">{stats.visitorsToday}</div>
              <div className="text-sm text-gray-600">Ø¨Ø§Ø²Ø¯ÛŒØ¯Ú©Ù†Ù†Ø¯Ù‡ Ø§Ù…Ø±ÙˆØ²</div>
            </div>

            <div className="bg-white rounded-xl shadow p-6 text-center">
              <div className="text-3xl mb-2">ğŸ“±</div>
              <div className="text-2xl font-bold text-green-600">{stats.qrScans}</div>
              <div className="text-sm text-gray-600">Ø§Ø³Ú©Ù† QR</div>
            </div>

            <div className="bg-white rounded-xl shadow p-6 text-center">
              <div className="text-3xl mb-2">ğŸ’¬</div>
              <div className="text-2xl font-bold text-purple-600">{stats.sessionsStarted}</div>
              <div className="text-sm text-gray-600">Ø¬Ù„Ø³Ù‡ Ø´Ø±ÙˆØ¹ Ø´Ø¯Ù‡</div>
            </div>

            <div className="bg-white rounded-xl shadow p-6 text-center">
              <div className="text-3xl mb-2">ğŸ«</div>
              <div className="text-2xl font-bold text-orange-600">{stats.eventRegistrations}</div>
              <div className="text-sm text-gray-600">Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ø±ÙˆÛŒØ¯Ø§Ø¯</div>
            </div>
          </div>

          {/* Charts */}
          <div className="grid md:grid-cols-2 gap-6">
            {/* Visitors Trend */}
            <div className="bg-white rounded-xl shadow p-6">
              <h3 className="text-lg font-semibold mb-4">Ù†Ù…ÙˆØ¯Ø§Ø± Ø¨Ø§Ø²Ø¯ÛŒØ¯Ú©Ù†Ù†Ø¯Ú¯Ø§Ù†</h3>
              <SimpleBarChart
                data={[12, 19, 15, 25, stats.visitorsToday, 28, 22]}
                maxValue={40}
                color="#3B82F6"
              />
              <div className="flex justify-between mt-2 text-xs text-gray-500">
                <span>Ø´Ù†Ø¨Ù‡</span>
                <span>ÛŒÚ©Ø´Ù†Ø¨Ù‡</span>
                <span>Ø¯ÙˆØ´Ù†Ø¨Ù‡</span>
                <span>Ø³Ù‡â€ŒØ´Ù†Ø¨Ù‡</span>
                <span>Ú†Ù‡Ø§Ø±Ø´Ù†Ø¨Ù‡</span>
                <span>Ù¾Ù†Ø¬â€ŒØ´Ù†Ø¨Ù‡</span>
                <span>Ø¬Ù…Ø¹Ù‡</span>
              </div>
            </div>

            {/* Activity Distribution */}
            <div className="bg-white rounded-xl shadow p-6">
              <h3 className="text-lg font-semibold mb-4">ØªÙˆØ²ÛŒØ¹ ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§</h3>
              <PieChart
                data={[stats.qrScans, stats.eventRegistrations, stats.messagesSent]}
              />
              <div className="mt-4 space-y-2">
                <div className="flex items-center gap-2">
                  <div className="w-3 h-3 bg-blue-500 rounded"></div>
                  <span className="text-sm">Ø§Ø³Ú©Ù† QR</span>
                </div>
                <div className="flex items-center gap-2">
                  <div className="w-3 h-3 bg-red-500 rounded"></div>
                  <span className="text-sm">Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ø±ÙˆÛŒØ¯Ø§Ø¯</span>
                </div>
                <div className="flex items-center gap-2">
                  <div className="w-3 h-3 bg-green-500 rounded"></div>
                  <span className="text-sm">Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§</span>
                </div>
              </div>
            </div>
          </div>

          {/* QR Code Testing */}
          <div className="bg-white rounded-xl shadow p-6">
            <h3 className="text-lg font-semibold mb-4">ğŸ§ª Ø¢Ø²Ù…Ø§ÛŒØ´ ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡</h3>
            <div className="grid md:grid-cols-2 gap-6">
              <div>
                <h4 className="font-medium mb-3">ğŸ“± Ø¢Ø²Ù…Ø§ÛŒØ´ QR Code</h4>
                <ul className="text-sm text-gray-600 space-y-1">
                  <li>â€¢ Ø±ÙˆÛŒ Ú©Ø¯ QR Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯</li>
                  <li>â€¢ ÛŒØ§ Ø§Ø² Ø¯Ú©Ù…Ù‡ "Ø§Ø³Ú©Ù†" Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯</li>
                  <li>â€¢ Ø¢Ù…Ø§Ø± Ø§Ø³Ú©Ù†â€ŒÙ‡Ø§ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯</li>
                  <li>â€¢ Ø¨Ù‡ ØµÙØ­Ù‡ Ù…Ø±Ø¨ÙˆØ·Ù‡ Ù…Ù†ØªÙ‚Ù„ Ø®ÙˆØ§Ù‡ÛŒØ¯ Ø´Ø¯</li>
                </ul>
              </div>
              <div>
                <h4 className="font-medium mb-3">ğŸ–¥ï¸ Ø­Ø§Ù„Øª Ú©ÛŒÙˆØ³Ú©</h4>
                <ul className="text-sm text-gray-600 space-y-1">
                  <li>â€¢ Ø§Ø² Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª ÙˆØ§Ø±Ø¯ Ø­Ø§Ù„Øª Ú©ÛŒÙˆØ³Ú© Ø´ÙˆÛŒØ¯</li>
                  <li>â€¢ Ø§Ù†Ø¯Ø§Ø²Ù‡ UI Ø¨Ø²Ø±Ú¯â€ŒØªØ± Ù…ÛŒâ€ŒØ´ÙˆØ¯</li>
                  <li>â€¢ Ø§ÛŒÙ…ÛŒÙ„â€ŒÙ‡Ø§ Ù…Ø­Ø§ÙØ¸Øª Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯</li>
                  <li>â€¢ Ù¾Ø³ Ø§Ø² Ûµ Ø¯Ù‚ÛŒÙ‚Ù‡ Ø¹Ø¯Ù… ÙØ¹Ø§Ù„ÛŒØªØŒ Ø®Ø±ÙˆØ¬ Ø®ÙˆØ¯Ú©Ø§Ø±</li>
                </ul>
              </div>
            </div>
          </div>

          {/* Recent Activity */}
          <div className="bg-white rounded-xl shadow p-6">
            <h3 className="text-lg font-semibold mb-4">ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø§Ø®ÛŒØ±</h3>
            <div className="space-y-3">
              <div className="flex items-center gap-3 p-3 bg-blue-50 rounded-lg">
                <div className="text-blue-600">ğŸ“±</div>
                <div className="flex-1">
                  <div className="font-medium">QR Code Ø§Ø³Ú©Ù† Ø´Ø¯</div>
                  <div className="text-sm text-gray-600">Ø¨Ø±Ø§ÛŒ ØºØ±ÙÙ‡ Ù¾Ø§Ø±Ø³â€ŒØªÚ©</div>
                </div>
                <div className="text-xs text-gray-500">Û² Ø¯Ù‚ÛŒÙ‚Ù‡ Ù¾ÛŒØ´</div>
              </div>

              <div className="flex items-center gap-3 p-3 bg-green-50 rounded-lg">
                <div className="text-green-600">ğŸ«</div>
                <div className="flex-1">
                  <div className="font-medium">Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ø¯Ø± Ø±ÙˆÛŒØ¯Ø§Ø¯</div>
                  <div className="text-sm text-gray-600">Ú©Ø§Ø±Ú¯Ø§Ù‡ IoT Ùˆ Ù‡ÙˆØ´Ù…Ù†Ø¯Ø³Ø§Ø²ÛŒ</div>
                </div>
                <div className="text-xs text-gray-500">Ûµ Ø¯Ù‚ÛŒÙ‚Ù‡ Ù¾ÛŒØ´</div>
              </div>

              <div className="flex items-center gap-3 p-3 bg-purple-50 rounded-lg">
                <div className="text-purple-600">ğŸ’¬</div>
                <div className="flex-1">
                  <div className="font-medium">Ù¾ÛŒØ§Ù… Ø¬Ø¯ÛŒØ¯</div>
                  <div className="text-sm text-gray-600">Ø¯Ø± Ú¯ÙØªÚ¯ÙˆÛŒ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯</div>
                </div>
                <div className="text-xs text-gray-500">Û±Û° Ø¯Ù‚ÛŒÙ‚Ù‡ Ù¾ÛŒØ´</div>
              </div>
            </div>
          </div>
        </div>
      );
    }

    // Kiosk Mode Context and Hook
    const KioskContext = React.createContext();

    function useKioskMode() {
      const [isKioskMode, setIsKioskMode] = React.useState(() => {
        return JSON.parse(localStorage.getItem('kioskMode') || 'false');
      });

      const [lastActivity, setLastActivity] = React.useState(Date.now());
      const [autoResetInterval, setAutoResetInterval] = React.useState(null);

      const enableKioskMode = () => {
        setIsKioskMode(true);
        localStorage.setItem('kioskMode', 'true');

        // Start auto-reset timer (15 minutes)
        const interval = setInterval(() => {
          resetDemoData();
        }, 15 * 60 * 1000); // 15 minutes

        setAutoResetInterval(interval);
      };

      const disableKioskMode = () => {
        setIsKioskMode(false);
        localStorage.setItem('kioskMode', 'false');

        if (autoResetInterval) {
          clearInterval(autoResetInterval);
          setAutoResetInterval(null);
        }
      };

      const resetDemoData = () => {
        console.log('Auto-resetting demo data...');

        // Reset all demo data
        const seedDataOnce = window.seedDataOnce;
        if (seedDataOnce) {
          localStorage.removeItem('seeded');
          seedDataOnce();
        }

        // Clear session
        localStorage.setItem('session', 'null');

        // Reset kiosk mode
        setIsKioskMode(false);
        localStorage.setItem('kioskMode', 'false');
      };

      const updateActivity = () => {
        setLastActivity(Date.now());
      };

      // Auto-logout on inactivity (5 minutes in kiosk mode)
      React.useEffect(() => {
        if (!isKioskMode) return;

        const checkInactivity = () => {
          const now = Date.now();
          const timeSinceActivity = now - lastActivity;

          if (timeSinceActivity > 5 * 60 * 1000) { // 5 minutes
            console.log('Auto-logout due to inactivity');
            localStorage.setItem('session', 'null');
            window.location.reload();
          }
        };

        const interval = setInterval(checkInactivity, 30000); // Check every 30 seconds
        return () => clearInterval(interval);
      }, [isKioskMode, lastActivity]);

      // Track user activity
      React.useEffect(() => {
        if (!isKioskMode) return;

        const handleActivity = () => updateActivity();

        const events = ['mousedown', 'mousemove', 'keypress', 'scroll', 'touchstart'];
        events.forEach(event => {
          document.addEventListener(event, handleActivity, true);
        });

        return () => {
          events.forEach(event => {
            document.removeEventListener(event, handleActivity, true);
          });
        };
      }, [isKioskMode]);

      return {
        isKioskMode,
        enableKioskMode,
        disableKioskMode,
        resetDemoData,
        updateActivity
      };
    }

    // Privacy Mask Utility
    function maskEmail(email) {
      if (!email) return '';

      const [username, domain] = email.split('@');
      if (!domain) return email;

      const maskedUsername = username.length > 2
        ? username.substring(0, 2) + '*'.repeat(username.length - 2)
        : username;

      const domainParts = domain.split('.');
      const maskedDomain = domainParts[0].length > 2
        ? domainParts[0].substring(0, 2) + '*'.repeat(domainParts[0].length - 2)
        : domainParts[0];

      return `${maskedUsername}@${maskedDomain}.${domainParts.slice(1).join('.')}`;
    }

    // TESTA Home Page
    function TESTAHomePage({ session }) {
      const [loading, setLoading] = React.useState(true);
      const targetDate = "2024-06-30T09:00:00Z"; // TESTA start date

      const announcements = [
        "ğŸ† Ø¬ÙˆØ§ÛŒØ² ÙˆÛŒÚ˜Ù‡ Ø¨Ø±Ø§ÛŒ Ø¨Ù‡ØªØ±ÛŒÙ† Ø·Ø±Ø­â€ŒÙ‡Ø§ÛŒ Ù†ÙˆØ¢ÙˆØ±Ø§Ù†Ù‡",
        "ğŸ¤ ÙØ±ØµØª Ù…Ù„Ø§Ù‚Ø§Øª Ø¨Ø§ Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±Ø§Ù† Ùˆ Ø´ØªØ§Ø¨â€ŒØ¯Ù‡Ù†Ø¯Ù‡â€ŒÙ‡Ø§",
        "ğŸ¯ Ú†Ø§Ù„Ø´â€ŒÙ‡Ø§ÛŒ Ø²Ù†Ø¯Ù‡ Ø¨Ø§ Ø¬ÙˆØ§ÛŒØ² Ù†Ù‚Ø¯ÛŒ",
        "ğŸŒŸ Ù†Ù…Ø§ÛŒØ´ Ø¢Ø®Ø±ÛŒÙ† Ø¯Ø³ØªØ§ÙˆØ±Ø¯Ù‡Ø§ÛŒ ÙÙ†Ø§ÙˆØ±ÛŒ Ø§ÛŒØ±Ø§Ù†",
        "ğŸ“… Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ÛŒ Ø¬Ø§Ù†Ø¨ÛŒ Ø¯Ø± Ø·ÙˆÙ„ Ù†Ù…Ø§ÛŒØ´Ú¯Ø§Ù‡"
      ];

      // Simulate loading
      React.useEffect(() => {
        const timer = setTimeout(() => setLoading(false), 1000);
        return () => clearTimeout(timer);
      }, []);

      if (loading) {
        return <PageLoader message="Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ TESTA..." />;
      }

      return (
        <div className="space-y-8">
          {/* Hero Section */}
          <FadeIn>
            <div className="text-center py-12 bg-gradient-to-br from-purple-600 via-blue-600 to-indigo-700 text-white rounded-2xl shadow-2xl">
              <div className="max-w-4xl mx-auto px-6">
              <h1 className="text-5xl font-bold mb-4">
                ğŸª TESTA Û²Û°Û²Û´
              </h1>
              <p className="text-xl mb-8 opacity-90">
                Ù†Ù…Ø§ÛŒØ´Ú¯Ø§Ù‡ ÙÙ†Ø§ÙˆØ±ÛŒ Ùˆ Ù†ÙˆØ¢ÙˆØ±ÛŒ Ø§ÛŒØ±Ø§Ù†
              </p>

              {/* Countdown Timer */}
              <div className="bg-white/10 backdrop-blur-sm rounded-xl p-8 mb-8">
                <h2 className="text-2xl font-semibold mb-4">Ø²Ù…Ø§Ù† Ø¨Ø§Ù‚ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ù‡ ØªØ§ Ø¢ØºØ§Ø² Ù†Ù…Ø§ÛŒØ´Ú¯Ø§Ù‡</h2>
                <CountdownTimer targetDate={targetDate} />
              </div>

              <div className="grid md:grid-cols-3 gap-6 text-center">
                <div className="bg-white/10 rounded-lg p-4">
                  <div className="text-3xl mb-2">ğŸ¢</div>
                  <div className="font-semibold">ÛµÛ°+ Ø´Ø±Ú©Øª</div>
                  <div className="text-sm opacity-80">Ù†Ù…Ø§ÛŒØ´Ú¯Ø§Ù‡â€ŒØ¯Ø§Ø±</div>
                </div>
                <div className="bg-white/10 rounded-lg p-4">
                  <div className="text-3xl mb-2">ğŸ‘¥</div>
                  <div className="font-semibold">Û±Û°Û°Û°+ Ø¨Ø§Ø²Ø¯ÛŒØ¯Ú©Ù†Ù†Ø¯Ù‡</div>
                  <div className="text-sm opacity-80">Ø§Ù†ØªØ¸Ø§Ø± Ù…ÛŒâ€ŒØ±ÙˆØ¯</div>
                </div>
                <div className="bg-white/10 rounded-lg p-4">
                  <div className="text-3xl mb-2">ğŸ¯</div>
                  <div className="font-semibold">Û²Û°+ Ú†Ø§Ù„Ø´</div>
                  <div className="text-sm opacity-80">ÙØ¹Ø§Ù„</div>
                </div>
              </div>
            </div>
            </div>
          </FadeIn>

          {/* Rolling Announcements */}
          <FadeIn delay={400}>
            <RollingAnnouncements announcements={announcements} />
          </FadeIn>

          {/* Quick Actions */}
          <FadeIn delay={600}>
            <div className="grid md:grid-cols-2 lg:grid-cols-4 gap-6">
            <div className="bg-white rounded-xl shadow p-6 text-center hover:shadow-lg transition-shadow cursor-pointer"
                 onClick={() => window.location.hash = 'testa-schedule'}>
              <div className="text-4xl mb-4">ğŸ“…</div>
              <h3 className="font-semibold text-lg mb-2">Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø±ÙˆØ²Ø§Ù†Ù‡</h3>
              <p className="text-gray-600 text-sm">Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø¨Ø±Ù†Ø§Ù…Ù‡ Ú©Ø§Ù…Ù„ Ù†Ù…Ø§ÛŒØ´Ú¯Ø§Ù‡</p>
            </div>

            <div className="bg-white rounded-xl shadow p-6 text-center hover:shadow-lg transition-shadow cursor-pointer"
                 onClick={() => window.location.hash = 'testa-events'}>
              <div className="text-4xl mb-4">ğŸ¤</div>
              <h3 className="font-semibold text-lg mb-2">Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§</h3>
              <p className="text-gray-600 text-sm">Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ø¯Ø± Ú©Ø§Ø±Ú¯Ø§Ù‡â€ŒÙ‡Ø§ Ùˆ Ø³Ø®Ù†Ø±Ø§Ù†ÛŒâ€ŒÙ‡Ø§</p>
            </div>

            <div className="bg-white rounded-xl shadow p-6 text-center hover:shadow-lg transition-shadow cursor-pointer"
                 onClick={() => window.location.hash = 'testa-booths'}>
              <div className="text-4xl mb-4">ğŸª</div>
              <h3 className="font-semibold text-lg mb-2">Ù†Ù…Ø§ÛŒØ´Ú¯Ø§Ù‡â€ŒÙ‡Ø§</h3>
              <p className="text-gray-600 text-sm">Ú¯Ù¾ Ø²Ø¯Ù† Ø¨Ø§ Ø´Ø±Ú©Øªâ€ŒÙ‡Ø§ÛŒ Ø­Ø§Ø¶Ø±</p>
            </div>

            <div className="bg-white rounded-xl shadow p-6 text-center hover:shadow-lg transition-shadow cursor-pointer"
                 onClick={() => window.location.hash = 'challenges'}>
              <div className="text-4xl mb-4">ğŸ¯</div>
              <h3 className="font-semibold text-lg mb-2">Ú†Ø§Ù„Ø´â€ŒÙ‡Ø§</h3>
              <p className="text-gray-600 text-sm">Ù…Ø´Ø§Ø±Ú©Øª Ø¯Ø± Ú†Ø§Ù„Ø´â€ŒÙ‡Ø§ÛŒ ÙÙ†Ø§ÙˆØ±ÛŒ</p>
            </div>
          </div>
          </FadeIn>

          {/* QR Code Demo Section */}
          <FadeIn delay={800}>
            <div className="bg-white rounded-xl shadow p-6">
            <h2 className="text-lg font-semibold mb-4 flex items-center">
              <span className="ml-2">ğŸ“±</span>
              Ú©Ø¯Ù‡Ø§ÛŒ QR Ù‚Ø§Ø¨Ù„ Ø¢Ø²Ù…Ø§ÛŒØ´
            </h2>
            <p className="text-sm text-gray-600 mb-4">
              Ø±ÙˆÛŒ Ú©Ø¯ QR Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯ ÛŒØ§ Ø§Ø² Ø¯Ú©Ù…Ù‡ "Ø§Ø³Ú©Ù†" Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯ ØªØ§ Ø¨Ù‡ ØµÙØ­Ù‡ Ù…Ø±Ø¨ÙˆØ·Ù‡ Ù…Ù†ØªÙ‚Ù„ Ø´ÙˆÛŒØ¯
            </p>
            <div className="grid md:grid-cols-3 gap-4">
              <div className="text-center p-4 border rounded-lg">
                <QRCodeGenerator
                  text={`${window.location.origin}/testa-events`}
                  size={100}
                  className="mb-2"
                />
                <p className="text-sm font-medium">Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§</p>
                <p className="text-xs text-gray-500">Ø¨Ø±Ø§ÛŒ Ø¢Ø²Ù…Ø§ÛŒØ´ Ø§Ø³Ú©Ù†</p>
              </div>
              <div className="text-center p-4 border rounded-lg">
                <QRCodeGenerator
                  text={`${window.location.origin}/testa-booths`}
                  size={100}
                  className="mb-2"
                />
                <p className="text-sm font-medium">Ù†Ù…Ø§ÛŒØ´Ú¯Ø§Ù‡â€ŒÙ‡Ø§</p>
                <p className="text-xs text-gray-500">Ø¨Ø±Ø§ÛŒ Ø¢Ø²Ù…Ø§ÛŒØ´ Ø§Ø³Ú©Ù†</p>
              </div>
              <div className="text-center p-4 border rounded-lg">
                <QRCodeGenerator
                  text={`${window.location.origin}/testa-schedule`}
                  size={100}
                  className="mb-2"
                />
                <p className="text-sm font-medium">Ø¨Ø±Ù†Ø§Ù…Ù‡</p>
                <p className="text-xs text-gray-500">Ø¨Ø±Ø§ÛŒ Ø¢Ø²Ù…Ø§ÛŒØ´ Ø§Ø³Ú©Ù†</p>
              </div>
            </div>
          </div>
          </FadeIn>

          {/* About TESTA */}
          <FadeIn delay={1000}>
            <div className="bg-white rounded-xl shadow p-8">
            <h2 className="text-2xl font-bold text-center mb-6">Ø¯Ø±Ø¨Ø§Ø±Ù‡ TESTA</h2>
            <div className="grid md:grid-cols-2 gap-8">
              <div>
                <h3 className="text-lg font-semibold mb-4 text-blue-600">ğŸ¯ Ø§Ù‡Ø¯Ø§Ù Ù†Ù…Ø§ÛŒØ´Ú¯Ø§Ù‡</h3>
                <ul className="space-y-2 text-gray-700">
                  <li>â€¢ Ø§ÛŒØ¬Ø§Ø¯ Ù¾Ù„ Ø§Ø±ØªØ¨Ø§Ø·ÛŒ Ø¨ÛŒÙ† Ø´Ø±Ú©Øªâ€ŒÙ‡Ø§ Ùˆ Ù†ÙˆØ¢ÙˆØ±Ø§Ù†</li>
                  <li>â€¢ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø³ØªØ§ÙˆØ±Ø¯Ù‡Ø§ÛŒ ÙÙ†Ø§ÙˆØ±ÛŒ Ø§ÛŒØ±Ø§Ù†</li>
                  <li>â€¢ ÙØ±ØµØª Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ Ø¯Ø± Ø§ÛŒØ¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù†Ùˆ</li>
                  <li>â€¢ Ø¨Ø±Ú¯Ø²Ø§Ø±ÛŒ Ú†Ø§Ù„Ø´â€ŒÙ‡Ø§ÛŒ ÙÙ†Ø§ÙˆØ±ÛŒ Ø²Ù†Ø¯Ù‡</li>
                </ul>
              </div>
              <div>
                <h3 className="text-lg font-semibold mb-4 text-green-600">ğŸ“… Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø²Ù…Ø§Ù†ÛŒ</h3>
                <div className="space-y-2 text-gray-700">
                  <div className="flex justify-between">
                    <span>Ø±ÙˆØ² Ø§ÙˆÙ„:</span>
                    <span>Û³Û° Ø®Ø±Ø¯Ø§Ø¯ - Ø§ÙØªØªØ§Ø­ÛŒÙ‡ Ùˆ Ø³Ø®Ù†Ø±Ø§Ù†ÛŒâ€ŒÙ‡Ø§</span>
                  </div>
                  <div className="flex justify-between">
                    <span>Ø±ÙˆØ² Ø¯ÙˆÙ…:</span>
                    <span>Û³Û± Ø®Ø±Ø¯Ø§Ø¯ - Ú©Ø§Ø±Ú¯Ø§Ù‡â€ŒÙ‡Ø§ Ùˆ Ú†Ø§Ù„Ø´â€ŒÙ‡Ø§</span>
                  </div>
                  <div className="flex justify-between">
                    <span>Ø±ÙˆØ² Ø³ÙˆÙ…:</span>
                    <span>Û± ØªÛŒØ± - Ø§Ø®ØªØªØ§Ù…ÛŒÙ‡ Ùˆ Ø¬ÙˆØ§ÛŒØ²</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
          </FadeIn>
        </div>
      );
    }

    // TESTA Schedule Page
    function TESTASchedulePage() {
      const scheduleData = [
        {
          "day": 1,
          "date": "Û³Û° Ø®Ø±Ø¯Ø§Ø¯ Û±Û´Û°Û³",
          "title": "Ø±ÙˆØ² Ø§ÙØªØªØ§Ø­ÛŒÙ‡",
          "events": [
            { "time": "09:00", "title": "Ø§ÙØªØªØ§Ø­ÛŒÙ‡ Ù†Ù…Ø§ÛŒØ´Ú¯Ø§Ù‡", "track": "Main", "speaker": "Ø¯Ú©ØªØ± Ø§Ø­Ù…Ø¯ÛŒ", "location": "Ø³Ø§Ù„Ù† Ø§ØµÙ„ÛŒ" },
            { "time": "10:00", "title": "Ø³Ø®Ù†Ø§Ù† Ú©Ù„ÛŒØ¯ÛŒ: Ø¢ÛŒÙ†Ø¯Ù‡ ÙÙ†Ø§ÙˆØ±ÛŒ Ø¯Ø± Ø§ÛŒØ±Ø§Ù†", "track": "Keynote", "speaker": "Ù…Ù‡Ù†Ø¯Ø³ Ù…Ø­Ù…Ø¯ÛŒ", "location": "Ø³Ø§Ù„Ù† Ø§ØµÙ„ÛŒ" },
            { "time": "11:30", "title": "Ú†Ø§Ù„Ø´â€ŒÙ‡Ø§ÛŒ ÙÙ†Ø§ÙˆØ±ÛŒ Ø³Ø§Ù„ Û±Û´Û°Û³", "track": "Challenges", "speaker": "Ù¾Ù†Ù„ Ø¨Ø±Ú¯Ø²Ø§Ø±Ú©Ù†Ù†Ø¯Ú¯Ø§Ù†", "location": "Ø³Ø§Ù„Ù† Ú†Ø§Ù„Ø´â€ŒÙ‡Ø§" },
            { "time": "14:00", "title": "Ø¢ÛŒÙ†Ø¯Ù‡ Ø§Ù†Ø±Ú˜ÛŒ Ø¯Ø± Ø§ÛŒØ±Ø§Ù†", "track": "Energy", "speaker": "Ø¯Ú©ØªØ± Ø±Ø¶Ø§ÛŒÛŒ", "location": "Ø³Ø§Ù„Ù† Ø§Ù†Ø±Ú˜ÛŒ" },
            { "time": "15:30", "title": "Ú©Ø§Ø±Ú¯Ø§Ù‡ IoT Ùˆ Ù‡ÙˆØ´Ù…Ù†Ø¯Ø³Ø§Ø²ÛŒ", "track": "IoT", "speaker": "Ù…Ù‡Ù†Ø¯Ø³ Ú©Ø±ÛŒÙ…ÛŒ", "location": "Ø³Ø§Ù„Ù† IoT" },
            { "time": "17:00", "title": "Ø§Ø®ØªØªØ§Ù…ÛŒÙ‡ Ø±ÙˆØ² Ø§ÙˆÙ„", "track": "Main", "speaker": "-", "location": "Ø³Ø§Ù„Ù† Ø§ØµÙ„ÛŒ" }
          ]
        },
        {
          "day": 2,
          "date": "Û³Û± Ø®Ø±Ø¯Ø§Ø¯ Û±Û´Û°Û³",
          "title": "Ø±ÙˆØ² ØªØ®ØµØµÛŒ",
          "events": [
            { "time": "09:00", "title": "Ø¨Ø§Ø²Ø¯ÛŒØ¯ Ø§Ø² Ù†Ù…Ø§ÛŒØ´Ú¯Ø§Ù‡â€ŒÙ‡Ø§", "track": "Exhibition", "speaker": "-", "location": "ØªÙ…Ø§Ù… Ø³Ø§Ù„Ù†â€ŒÙ‡Ø§" },
            { "time": "11:00", "title": "Ø§ÛŒÙ†ØªØ±Ù†Øª Ø§Ø´ÛŒØ§Ø¡ Ùˆ Ø´Ù‡Ø± Ù‡ÙˆØ´Ù…Ù†Ø¯", "track": "IoT", "speaker": "Ø¯Ú©ØªØ± Ù†ÙˆØ±ÛŒ", "location": "Ø³Ø§Ù„Ù† IoT" },
            { "time": "12:30", "title": "Ù†Ø§Ù‡Ø§Ø± Ùˆ Ø´Ø¨Ú©Ù‡â€ŒØ³Ø§Ø²ÛŒ", "track": "Networking", "speaker": "-", "location": "Ø³Ø§Ù„Ù† ØºØ°Ø§Ø®ÙˆØ±ÛŒ" },
            { "time": "14:00", "title": "Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ Ø¯Ø± ØµÙ†Ø¹Øª", "track": "AI", "speaker": "Ù…Ù‡Ù†Ø¯Ø³ Ø§Ø­Ù…Ø¯ÛŒ", "location": "Ø³Ø§Ù„Ù† AI" },
            { "time": "15:30", "title": "Ú†Ø§Ù„Ø´â€ŒÙ‡Ø§ÛŒ Ø²Ù†Ø¯Ù‡ ÙÙ†Ø§ÙˆØ±ÛŒ", "track": "Live Challenges", "speaker": "Ø¯Ø§ÙˆØ±Ø§Ù†", "location": "Ø³Ø§Ù„Ù† Ú†Ø§Ù„Ø´â€ŒÙ‡Ø§" },
            { "time": "17:00", "title": "Ø§Ø®ØªØªØ§Ù…ÛŒÙ‡ Ø±ÙˆØ² Ø¯ÙˆÙ…", "track": "Main", "speaker": "-", "location": "Ø³Ø§Ù„Ù† Ø§ØµÙ„ÛŒ" }
          ]
        },
        {
          "day": 3,
          "date": "Û± ØªÛŒØ± Û±Û´Û°Û³",
          "title": "Ø±ÙˆØ² Ø§Ø®ØªØªØ§Ù…ÛŒÙ‡",
          "events": [
            { "time": "09:00", "title": "Ù…Ø±ÙˆØ± Ø¯Ø³ØªØ§ÙˆØ±Ø¯Ù‡Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´Ú¯Ø§Ù‡", "track": "Review", "speaker": "Ú©Ù…ÛŒØªÙ‡ Ø¨Ø±Ú¯Ø²Ø§Ø±ÛŒ", "location": "Ø³Ø§Ù„Ù† Ø§ØµÙ„ÛŒ" },
            { "time": "10:30", "title": "Ø§Ø±Ø§Ø¦Ù‡ Ø¨Ø±Ù†Ø¯Ú¯Ø§Ù† Ú†Ø§Ù„Ø´â€ŒÙ‡Ø§", "track": "Awards", "speaker": "Ù‡ÛŒØ¦Øª Ø¯Ø§ÙˆØ±Ø§Ù†", "location": "Ø³Ø§Ù„Ù† Ø§ØµÙ„ÛŒ" },
            { "time": "12:00", "title": "Ù†Ø§Ù‡Ø§Ø± Ø§Ø®ØªØªØ§Ù…ÛŒÙ‡", "track": "Closing", "speaker": "-", "location": "Ø³Ø§Ù„Ù† ØºØ°Ø§Ø®ÙˆØ±ÛŒ" },
            { "time": "14:00", "title": "Ú©Ø§Ø±Ú¯Ø§Ù‡â€ŒÙ‡Ø§ÛŒ ØªØ®ØµØµÛŒ", "track": "Workshops", "speaker": "Ù…ØªØ®ØµØµÛŒÙ†", "location": "Ø³Ø§Ù„Ù†â€ŒÙ‡Ø§ÛŒ Ù…Ø®ØªÙ„Ù" },
            { "time": "16:00", "title": "Ø§Ø®ØªØªØ§Ù…ÛŒÙ‡ Ù†Ù‡Ø§ÛŒÛŒ", "track": "Closing", "speaker": "Ú©Ù…ÛŒØªÙ‡ Ø¨Ø±Ú¯Ø²Ø§Ø±ÛŒ", "location": "Ø³Ø§Ù„Ù† Ø§ØµÙ„ÛŒ" }
          ]
        }
      ];

      const [selectedDay, setSelectedDay] = React.useState(1);

      const tracks = ["Main", "Keynote", "Energy", "IoT", "AI", "Challenges", "Exhibition", "Networking", "Live Challenges", "Review", "Awards", "Workshops", "Closing"];

      const getTrackColor = (track) => {
        const colors = {
          "Main": "bg-purple-100 text-purple-800",
          "Keynote": "bg-blue-100 text-blue-800",
          "Energy": "bg-green-100 text-green-800",
          "IoT": "bg-orange-100 text-orange-800",
          "AI": "bg-red-100 text-red-800",
          "Challenges": "bg-yellow-100 text-yellow-800",
          "Exhibition": "bg-indigo-100 text-indigo-800",
          "Networking": "bg-pink-100 text-pink-800",
          "Live Challenges": "bg-teal-100 text-teal-800",
          "Review": "bg-cyan-100 text-cyan-800",
          "Awards": "bg-emerald-100 text-emerald-800",
          "Workshops": "bg-violet-100 text-violet-800",
          "Closing": "bg-gray-100 text-gray-800"
        };
        return colors[track] || "bg-gray-100 text-gray-800";
      };

      const selectedDayData = scheduleData.find(day => day["day"] === selectedDay);

      return (
        <div className="space-y-6">
          <header className="text-center py-6">
            <h1 className="text-2xl font-bold text-gray-900 mb-2">Ø¨Ø±Ù†Ø§Ù…Ù‡ TESTA Û²Û°Û²Û´</h1>
            <p className="text-gray-600">Ø¨Ø±Ù†Ø§Ù…Ù‡ Ú©Ø§Ù…Ù„ Ø³Ù‡ Ø±ÙˆØ² Ù†Ù…Ø§ÛŒØ´Ú¯Ø§Ù‡</p>
          </header>

          {/* Day Selector */}
          <div className="flex justify-center mb-8">
            <div className="bg-white rounded-xl shadow p-2 flex">
              {scheduleData.map(day => (
                <button
                  key={day.day}
                  onClick={() => setSelectedDay(day.day)}
                  className={`px-6 py-3 rounded-lg font-medium transition-colors ${
                    selectedDay === day.day
                      ? 'bg-blue-600 text-white'
                      : 'text-gray-600 hover:bg-gray-100'
                  }`}
                >
                  Ø±ÙˆØ² {day.day}
                  <div className="text-sm opacity-75">{day.date}</div>
                </button>
              ))}
            </div>
          </div>

          {/* Day Title */}
          <div className="text-center mb-6">
            <h2 className="text-3xl font-bold text-gray-900">{selectedDayData.title}</h2>
            <p className="text-lg text-gray-600">{selectedDayData.date}</p>
          </div>

          {/* Schedule Grid */}
          <div className="bg-white rounded-xl shadow overflow-hidden">
            <div className="overflow-x-auto">
              <table className="w-full">
                <thead className="bg-gray-50">
                  <tr>
                    <th className="px-6 py-4 text-right font-medium text-gray-700">Ø²Ù…Ø§Ù†</th>
                    <th className="px-6 py-4 text-right font-medium text-gray-700">Ø¹Ù†ÙˆØ§Ù† Ø±ÙˆÛŒØ¯Ø§Ø¯</th>
                    <th className="px-6 py-4 text-right font-medium text-gray-700">ØªØ±Ú©</th>
                    <th className="px-6 py-4 text-right font-medium text-gray-700">Ø³Ø®Ù†Ø±Ø§Ù†</th>
                    <th className="px-6 py-4 text-right font-medium text-gray-700">Ù…Ú©Ø§Ù†</th>
                  </tr>
                </thead>
                <tbody className="divide-y divide-gray-200">
                  {selectedDayData.events.map((event, index) => (
                    <tr key={index} className="hover:bg-gray-50">
                      <td className="px-6 py-4 font-mono font-semibold text-blue-600">
                        {event.time}
                      </td>
                      <td className="px-6 py-4">
                        <div className="font-medium text-gray-900">{event.title}</div>
                      </td>
                      <td className="px-6 py-4">
                        <span className={`px-2 py-1 text-xs rounded-full ${getTrackColor(event.track)}`}>
                          {event.track}
                        </span>
                      </td>
                      <td className="px-6 py-4 text-gray-700">
                        {event.speaker}
                      </td>
                      <td className="px-6 py-4 text-gray-700">
                        {event.location}
                      </td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          </div>

          {/* Track Legend */}
          <div className="bg-white rounded-xl shadow p-6">
            <h3 className="text-lg font-semibold mb-4">Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ ØªØ±Ú©â€ŒÙ‡Ø§</h3>
            <div className="grid grid-cols-2 md:grid-cols-4 gap-3">
              {tracks.map(track => (
                <div key={track} className="flex items-center gap-2">
                  <span className={`px-2 py-1 text-xs rounded-full ${getTrackColor(track)}`}>
                    {track}
                  </span>
                </div>
              ))}
            </div>
          </div>
        </div>
      );
    }

    // TESTA Events Page with Registration
    function TESTAEventsPage({ session }) {
      const [loading, setLoading] = React.useState(true);
      const [eventRegistrations, setEventRegistrations] = React.useState(() => {
        return JSON.parse(localStorage.getItem('eventRegistrations') || '[]');
      });

      // Simulate loading
      React.useEffect(() => {
        const timer = setTimeout(() => setLoading(false), 800);
        return () => clearTimeout(timer);
      }, []);

      const events = [
        {
          id: "event-1",
          title: "Ú©Ø§Ø±Ú¯Ø§Ù‡ IoT Ùˆ Ù‡ÙˆØ´Ù…Ù†Ø¯Ø³Ø§Ø²ÛŒ ØµÙ†Ø¹ØªÛŒ",
          description: "Ø¢Ù…ÙˆØ²Ø´ Ø¹Ù…Ù„ÛŒ Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø±Ø§Ù‡â€ŒØ­Ù„â€ŒÙ‡Ø§ÛŒ IoT Ø¯Ø± ØµÙ†Ø¹Øª Ø¨Ø§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø³Ù†Ø³ÙˆØ±Ù‡Ø§ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯ Ùˆ Ù¾Ù„ØªÙØ±Ù…â€ŒÙ‡Ø§ÛŒ Ø§Ø¨Ø±ÛŒ",
          date: "Û±Û´Û°Û³/Û°Û³/Û³Û±",
          time: "Û±Û´:Û°Û° - Û±Û·:Û°Û°",
          location: "Ø³Ø§Ù„Ù† IoT",
          speaker: "Ù…Ù‡Ù†Ø¯Ø³ Ú©Ø±ÛŒÙ…ÛŒ",
          capacity: 50,
          registered: 0,
          track: "Workshop",
          requirements: "Ø¯Ø§Ù†Ø´ Ù¾Ø§ÛŒÙ‡ Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒÙ†ÙˆÛŒØ³ÛŒ Ùˆ Ø§Ù„Ú©ØªØ±ÙˆÙ†ÛŒÚ©"
        },
        {
          id: "event-2",
          title: "Ø³Ø®Ù†Ø§Ù† Ú©Ù„ÛŒØ¯ÛŒ: Ø¢ÛŒÙ†Ø¯Ù‡ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ Ø¯Ø± Ø§ÛŒØ±Ø§Ù†",
          description: "Ø¨Ø±Ø±Ø³ÛŒ ÙØ±ØµØªâ€ŒÙ‡Ø§ Ùˆ Ú†Ø§Ù„Ø´â€ŒÙ‡Ø§ÛŒ ØªÙˆØ³Ø¹Ù‡ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ Ø¯Ø± Ø§ÛŒØ±Ø§Ù† Ùˆ Ù†Ù‚Ø´ Ø¢Ù† Ø¯Ø± ØªØ­ÙˆÙ„ Ø¯ÛŒØ¬ÛŒØªØ§Ù„",
          date: "Û±Û´Û°Û³/Û°Û³/Û³Û±",
          time: "Û±Û°:Û°Û° - Û±Û±:Û³Û°",
          location: "Ø³Ø§Ù„Ù† Ø§ØµÙ„ÛŒ",
          speaker: "Ø¯Ú©ØªØ± Ø§Ø­Ù…Ø¯ÛŒ",
          capacity: 200,
          registered: 0,
          track: "Keynote",
          requirements: "Ø¹Ù„Ø§Ù‚Ù‡â€ŒÙ…Ù†Ø¯ÛŒ Ø¨Ù‡ Ù…ÙˆØ¶ÙˆØ¹Ø§Øª ÙÙ†Ø§ÙˆØ±ÛŒ"
        },
        {
          id: "event-3",
          title: "Ú†Ø§Ù„Ø´ Ø²Ù†Ø¯Ù‡: Ø±Ø§Ù‡â€ŒØ­Ù„â€ŒÙ‡Ø§ÛŒ Ø§Ù†Ø±Ú˜ÛŒ Ù¾Ø§Ú©",
          description: "Ù…Ø³Ø§Ø¨Ù‚Ù‡ Ø²Ù†Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ø§Ø±Ø§Ø¦Ù‡ Ø±Ø§Ù‡â€ŒØ­Ù„â€ŒÙ‡Ø§ÛŒ Ù†ÙˆØ¢ÙˆØ±Ø§Ù†Ù‡ Ø¯Ø± Ø­ÙˆØ²Ù‡ Ø§Ù†Ø±Ú˜ÛŒâ€ŒÙ‡Ø§ÛŒ ØªØ¬Ø¯ÛŒØ¯Ù¾Ø°ÛŒØ±",
          date: "Û±Û´Û°Û³/Û°Û³/Û³Û±",
          time: "Û±Ûµ:Û³Û° - Û±Û·:Û°Û°",
          location: "Ø³Ø§Ù„Ù† Ú†Ø§Ù„Ø´â€ŒÙ‡Ø§",
          speaker: "Ù‡ÛŒØ¦Øª Ø¯Ø§ÙˆØ±Ø§Ù†",
          capacity: 100,
          registered: 0,
          track: "Live Challenge",
          requirements: "Ø¯Ø§Ù†Ø´ ÙÙ†ÛŒ Ø¯Ø± Ø­ÙˆØ²Ù‡ Ø§Ù†Ø±Ú˜ÛŒ"
        },
        {
          id: "event-4",
          title: "Ø´Ø¨Ú©Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø¨Ø§ Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±Ø§Ù†",
          description: "ÙØ±ØµØª Ù…Ù„Ø§Ù‚Ø§Øª Ùˆ Ú¯ÙØªÚ¯ÙˆÛŒ Ù…Ø³ØªÙ‚ÛŒÙ… Ø¨Ø§ Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±Ø§Ù† Ø±ÛŒØ³Ú©â€ŒÙ¾Ø°ÛŒØ± Ùˆ Ø´ØªØ§Ø¨â€ŒØ¯Ù‡Ù†Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ÙÙ†Ø§ÙˆØ±ÛŒ",
          date: "Û±Û´Û°Û³/Û°Û´/Û°Û±",
          time: "Û±Û´:Û°Û° - Û±Û¶:Û°Û°",
          location: "Ø³Ø§Ù„Ù† Ø´Ø¨Ú©Ù‡â€ŒØ³Ø§Ø²ÛŒ",
          speaker: "Ù…ØªØ®ØµØµÛŒÙ† Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ",
          capacity: 30,
          registered: 0,
          track: "Networking",
          requirements: "Ø¯Ø§Ø´ØªÙ† Ù…Ø­ØµÙˆÙ„ ÛŒØ§ Ø§ÛŒØ¯Ù‡ Ø¢Ù…Ø§Ø¯Ù‡ Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ"
        },
        {
          id: "event-5",
          title: "Ú©Ø§Ø±Ú¯Ø§Ù‡ ØªÙˆØ³Ø¹Ù‡ Ù…Ø­ØµÙˆÙ„ Ø¯ÛŒØ¬ÛŒØªØ§Ù„",
          description: "Ø¢Ù…ÙˆØ²Ø´ Ø±ÙˆØ´â€ŒÙ‡Ø§ÛŒ Ù…Ø¯Ø±Ù† ØªÙˆØ³Ø¹Ù‡ Ù…Ø­ØµÙˆÙ„ Ø¯ÛŒØ¬ÛŒØªØ§Ù„ Ø§Ø² Ø§ÛŒØ¯Ù‡ ØªØ§ Ø¨Ø§Ø²Ø§Ø± Ø¨Ø§ Ø±ÙˆÛŒÚ©Ø±Ø¯ Ú†Ø§Ø¨Ú©",
          date: "Û±Û´Û°Û³/Û°Û´/Û°Û±",
          time: "Û°Û¹:Û°Û° - Û±Û²:Û°Û°",
          location: "Ø³Ø§Ù„Ù† Ø§Ø³ØªØ§Ø±Øªâ€ŒØ¢Ù¾",
          speaker: "Ú©Ø§Ø±Ø´Ù†Ø§Ø³Ø§Ù† Ù…Ø­ØµÙˆÙ„",
          capacity: 40,
          registered: 0,
          track: "Workshop",
          requirements: "ØªØ¬Ø±Ø¨Ù‡ Ú©Ø§Ø±ÛŒ Ø¯Ø± Ø­ÙˆØ²Ù‡ ÙÙ†Ø§ÙˆØ±ÛŒ"
        },
        {
          id: "event-6",
          title: "Ø§Ø±Ø§Ø¦Ù‡ Ø¨Ø±Ù†Ø¯Ú¯Ø§Ù† Ú†Ø§Ù„Ø´â€ŒÙ‡Ø§",
          description: "Ù…Ø¹Ø±ÙÛŒ Ùˆ ØªÙ‚Ø¯ÛŒØ± Ø§Ø² Ø¨Ø±Ù†Ø¯Ú¯Ø§Ù† Ú†Ø§Ù„Ø´â€ŒÙ‡Ø§ÛŒ TESTA Ø¨Ø§ Ø¬ÙˆØ§ÛŒØ² ÙˆÛŒÚ˜Ù‡",
          date: "Û±Û´Û°Û³/Û°Û´/Û°Û±",
          time: "Û±Û°:Û³Û° - Û±Û²:Û°Û°",
          location: "Ø³Ø§Ù„Ù† Ø§ØµÙ„ÛŒ",
          speaker: "Ù‡ÛŒØ¦Øª Ø¯Ø§ÙˆØ±Ø§Ù†",
          capacity: 300,
          registered: 0,
          track: "Awards",
          requirements: "Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ø¯Ø± Ú†Ø§Ù„Ø´â€ŒÙ‡Ø§"
        }
      ];

      const [selectedEvent, setSelectedEvent] = React.useState(null);
      const [showRegistrationForm, setShowRegistrationForm] = React.useState(false);
      const [registrationForm, setRegistrationForm] = React.useState({
        "name": session?.name || '',
        "email": session?.email || '',
        "role": session?.role || 'SOLVER',
        "organization": '',
        "expectations": ''
      });

      // Update registered counts from localStorage
      React.useEffect(() => {
        const registrations = JSON.parse(localStorage.getItem('eventRegistrations') || '[]');
        const updatedEvents = events.map(event => ({
          ...event,
          "registered": registrations.filter(reg => reg["eventId"] === event["id"]).length
        }));
        // Note: This is just for display, the actual events array is static
      }, [eventRegistrations]);

      const handleRegister = (event) => {
        if (!session) {
          alert('Ø¨Ø±Ø§ÛŒ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ø¯Ø± Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ Ø§Ø¨ØªØ¯Ø§ ÙˆØ§Ø±Ø¯ Ø³ÛŒØ³ØªÙ… Ø´ÙˆÛŒØ¯');
          window.location.hash = 'login';
          return;
        }
        setSelectedEvent(event);
        setShowRegistrationForm(true);
      };

      const submitRegistration = () => {
        if (!selectedEvent) return;

        const registration = {
          "id": `reg-${Date.now()}`,
          "eventId": selectedEvent["id"],
          "userId": session["userId"],
          "userName": registrationForm["name"],
          "userEmail": registrationForm["email"],
          "userRole": registrationForm["role"],
          "organization": registrationForm["organization"],
          "expectations": registrationForm["expectations"],
          "registeredAt": new Date().toISOString(),
          "eventTitle": selectedEvent["title"],
          "eventDate": selectedEvent["date"],
          "eventTime": selectedEvent["time"]
        };

        const registrations = JSON.parse(localStorage.getItem('eventRegistrations') || '[]');
        registrations.push(registration);
        localStorage.setItem('eventRegistrations', JSON.stringify(registrations));

        setEventRegistrations(registrations);
        setShowRegistrationForm(false);
        setSelectedEvent(null);

        alert('Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ø´Ù…Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯!');
      };

      const isUserRegistered = (eventId) => {
        if (!session) return false;
        return eventRegistrations.some(reg =>
          reg["eventId"] === eventId && reg["userId"] === session["userId"]
        );
      };

      const getTrackColor = (track) => {
        const colors = {
          "Workshop": "bg-blue-100 text-blue-800",
          "Keynote": "bg-purple-100 text-purple-800",
          "Live Challenge": "bg-green-100 text-green-800",
          "Networking": "bg-orange-100 text-orange-800",
          "Awards": "bg-yellow-100 text-yellow-800"
        };
        return colors[track] || "bg-gray-100 text-gray-800";
      };

      if (loading) {
        return <PageLoader message="Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§..." />;
      }

      return (
        <div className="space-y-6">
          <header className="text-center py-6">
            <h1 className="text-2xl font-bold text-gray-900 mb-2">Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ÛŒ TESTA</h1>
            <p className="text-gray-600">Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ø¯Ø± Ú©Ø§Ø±Ú¯Ø§Ù‡â€ŒÙ‡Ø§ØŒ Ø³Ø®Ù†Ø±Ø§Ù†ÛŒâ€ŒÙ‡Ø§ Ùˆ Ú†Ø§Ù„Ø´â€ŒÙ‡Ø§ÛŒ Ø²Ù†Ø¯Ù‡</p>
          </header>

          {/* Events Grid */}
          <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
            {events.map(event => {
              const isRegistered = isUserRegistered(event.id);
              const isFull = event.registered >= event.capacity;

              return (
                <div key={event.id} className="bg-white rounded-xl shadow hover:shadow-lg transition-shadow p-6">
                  <div className="flex items-start justify-between mb-4">
                    <div className="flex-1">
                      <h3 className="text-lg font-semibold text-gray-900 mb-2">
                        {event.title}
                      </h3>
                      <div className="flex items-center gap-2 mb-2">
                        <span className={`px-2 py-1 text-xs rounded-full ${getTrackColor(event.track)}`}>
                          {event.track}
                        </span>
                        <span className="text-sm text-gray-600">
                          ğŸ‘¥ {event.registered}/{event.capacity}
                        </span>
                      </div>
                    </div>
                    <div className="text-left text-sm text-gray-600">
                      <div>{event.date}</div>
                      <div>{event.time}</div>
                    </div>
                  </div>

                  <p className="text-gray-700 text-sm mb-4 line-clamp-3">
                    {event.description}
                  </p>

                  <div className="space-y-2 text-sm text-gray-600 mb-4">
                    <div>ğŸ¤ {event.speaker}</div>
                    <div>ğŸ“ {event.location}</div>
                    <div>ğŸ“‹ {event.requirements}</div>
                  </div>

                  {/* QR Code for Event */}
                  <div className="mb-4 flex justify-center">
                    <QRCodeGenerator
                      text={`${window.location.origin}/testa-events#register-${event.id}`}
                      size={80}
                      className="mb-2"
                    />
                  </div>

                  <button
                    onClick={() => handleRegister(event)}
                    disabled={isRegistered || isFull}
                    className={`w-full px-4 py-2 text-sm font-medium rounded-lg transition-colors ${
                      isRegistered
                        ? 'bg-green-100 text-green-800 cursor-not-allowed'
                        : isFull
                        ? 'bg-red-100 text-red-800 cursor-not-allowed'
                        : 'bg-blue-600 text-white hover:bg-blue-700'
                    }`}
                  >
                    {isRegistered ? 'âœ… Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ø´Ø¯Ù‡' : isFull ? 'ğŸ Ø¸Ø±ÙÛŒØª ØªÚ©Ù…ÛŒÙ„' : 'ğŸ“ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…'}
                  </button>
                </div>
              );
            })}
          </div>

          {/* Registration Form Modal */}
          {showRegistrationForm && selectedEvent && (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
              <div className="bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
                <div className="p-6">
                  <div className="flex justify-between items-center mb-6">
                    <div>
                      <h2 className="text-2xl font-bold text-gray-900">Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ø¯Ø± Ø±ÙˆÛŒØ¯Ø§Ø¯</h2>
                      <p className="text-gray-600 mt-1">{selectedEvent.title}</p>
                    </div>
                    <button
                      onClick={() => setShowRegistrationForm(false)}
                      className="text-gray-400 hover:text-gray-600 text-2xl"
                    >
                      âœ•
                    </button>
                  </div>

                  <div className="space-y-4">
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-2">
                        Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ *
                      </label>
                      <input
                        type="text"
                        value={registrationForm.name}
                        onChange={(e) => setRegistrationForm(prev => ({ ...prev, name: e.target.value }))}
                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                        required
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-2">
                        Ø§ÛŒÙ…ÛŒÙ„ *
                      </label>
                      <input
                        type="email"
                        value={registrationForm.email}
                        onChange={(e) => setRegistrationForm(prev => ({ ...prev, email: e.target.value }))}
                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                        required
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-2">
                        Ù†Ù‚Ø´ Ø´Ù…Ø§
                      </label>
                      <select
                        value={registrationForm.role}
                        onChange={(e) => setRegistrationForm(prev => ({ ...prev, role: e.target.value }))}
                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                      >
                        <option value="SOLVER">Ø­Ù„â€ŒÚ©Ù†Ù†Ø¯Ù‡ (Ù†ÙˆØ¢ÙˆØ±)</option>
                        <option value="SEEKER">Ø¬Ø³ØªØ¬ÙˆÚ¯Ø± (Ú©Ø§Ø±ÙØ±Ù…Ø§)</option>
                        <option value="ADMIN">Ù…Ø¯ÛŒØ±</option>
                        <option value="VISITOR">Ø¨Ø§Ø²Ø¯ÛŒØ¯Ú©Ù†Ù†Ø¯Ù‡</option>
                      </select>
                    </div>

                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-2">
                        Ø³Ø§Ø²Ù…Ø§Ù† (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)
                      </label>
                      <input
                        type="text"
                        value={registrationForm.organization}
                        onChange={(e) => setRegistrationForm(prev => ({ ...prev, organization: e.target.value }))}
                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                        placeholder="Ù†Ø§Ù… Ø³Ø§Ø²Ù…Ø§Ù† ÛŒØ§ Ø´Ø±Ú©Øª"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-2">
                        Ø§Ù†ØªØ¸Ø§Ø±Ø§Øª Ø´Ù…Ø§ Ø§Ø² Ø§ÛŒÙ† Ø±ÙˆÛŒØ¯Ø§Ø¯
                      </label>
                      <textarea
                        value={registrationForm.expectations}
                        onChange={(e) => setRegistrationForm(prev => ({ ...prev, expectations: e.target.value }))}
                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                        rows="3"
                        placeholder="Ú†Ù‡ Ø§Ù†ØªØ¸Ø§Ø±ÛŒ Ø§Ø² Ø§ÛŒÙ† Ø±ÙˆÛŒØ¯Ø§Ø¯ Ø¯Ø§Ø±ÛŒØ¯ØŸ"
                      />
                    </div>
                  </div>

                  <div className="flex gap-4 mt-6">
                    <button
                      onClick={submitRegistration}
                      disabled={!registrationForm.name || !registrationForm.email}
                      className="flex-1 px-6 py-3 bg-green-600 text-white text-lg font-semibold rounded-lg hover:bg-green-700 focus:ring-2 focus:ring-green-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
                    >
                      âœ… Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ù†Ù‡Ø§ÛŒÛŒ
                    </button>
                    <button
                      onClick={() => setShowRegistrationForm(false)}
                      className="px-6 py-3 bg-gray-600 text-white text-lg font-semibold rounded-lg hover:bg-gray-700 focus:ring-2 focus:ring-gray-500 transition-colors"
                    >
                      Ø§Ù†ØµØ±Ø§Ù
                    </button>
                  </div>
                </div>
              </div>
            </div>
          )}
        </div>
      );
    }

    // TESTA Map & Booths Page
    function TESTABoothsPage() {
      const exhibitors = [
        {
          "id": "ex-1",
          "name": "Ù¾Ø§Ø±Ø³â€ŒØªÚ©",
          "boothCode": "A12",
          "category": "Energy",
          "description": "Ù†Ù…Ø§ÛŒØ´Ú¯Ø± Ø±Ø§Ù‡â€ŒØ­Ù„â€ŒÙ‡Ø§ÛŒ Ø§Ù†Ø±Ú˜ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø¨Ø§ ØªÙ…Ø±Ú©Ø² Ø¨Ø± IoT ØµÙ†Ø¹ØªÛŒ",
          "logo": null,
          "website": "https://parstech.ir",
          "contactInfo": {
            "phone": "+98-21-12345678",
            "email": "info@parstech.ir"
          },
          "products": ["Ø³Ù†Ø³ÙˆØ±Ù‡Ø§ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø§Ù†Ø±Ú˜ÛŒ", "Ù¾Ù„ØªÙØ±Ù… Ù…Ø§Ù†ÛŒØªÙˆØ±ÛŒÙ†Ú¯ IoT", "Ø±Ø§Ù‡â€ŒØ­Ù„â€ŒÙ‡Ø§ÛŒ Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ Ù…ØµØ±Ù"]
        },
        {
          "id": "ex-2",
          "name": "Ø´Ø±Ú©Øª Ø§Ù†Ø±Ú˜ÛŒ Ø³Ø¨Ø²",
          "boothCode": "B08",
          "category": "Energy",
          "description": "ØªÙˆØ³Ø¹Ù‡â€ŒØ¯Ù‡Ù†Ø¯Ù‡ Ø±Ø§Ù‡â€ŒØ­Ù„â€ŒÙ‡Ø§ÛŒ Ø§Ù†Ø±Ú˜ÛŒ Ù¾Ø§Ú© Ùˆ ØªØ¬Ø¯ÛŒØ¯Ù¾Ø°ÛŒØ±",
          "logo": null,
          "website": "https://greenenergy.ir",
          "contactInfo": {
            "phone": "+98-31-87654321",
            "email": "info@greenenergy.ir"
          },
          "products": ["Ù¾Ù†Ù„â€ŒÙ‡Ø§ÛŒ Ø®ÙˆØ±Ø´ÛŒØ¯ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯", "Ø³ÛŒØ³ØªÙ…â€ŒÙ‡Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ø§Ù†Ø±Ú˜ÛŒ", "Ø±Ø§Ù‡â€ŒØ­Ù„â€ŒÙ‡Ø§ÛŒ ØªØ±Ú©ÛŒØ¨ÛŒ Ø§Ù†Ø±Ú˜ÛŒ"]
        },
        {
          "id": "ex-3",
          "name": "ØªÚ©â€ŒÙ†Ùˆ",
          "boothCode": "C15",
          "category": "IoT",
          "description": "Ù¾Ù„ØªÙØ±Ù…â€ŒÙ‡Ø§ÛŒ IoT Ùˆ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ Ø¨Ø±Ø§ÛŒ ØµÙ†Ø¹Øª Û´.Û°",
          "logo": null,
          "website": "https://techno.ir",
          "contactInfo": {
            "phone": "+98-51-11223344",
            "email": "info@techno.ir"
          },
          "products": ["Ù¾Ù„ØªÙØ±Ù… IoT Ø§Ø¨Ø±ÛŒ", "Ø±Ø§Ù‡â€ŒØ­Ù„â€ŒÙ‡Ø§ÛŒ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ ØµÙ†Ø¹ØªÛŒ", "Ø³Ù†Ø³ÙˆØ±Ù‡Ø§ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯ ØµÙ†Ø¹ØªÛŒ"]
        },
        {
          "id": "ex-4",
          "name": "Ù†ÙˆØ¢ÙˆØ±Ø§Ù† Ø¯ÛŒØ¬ÛŒØªØ§Ù„",
          "boothCode": "D05",
          "category": "AI",
          "description": "Ø±Ø§Ù‡â€ŒØ­Ù„â€ŒÙ‡Ø§ÛŒ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ Ø¨Ø±Ø§ÛŒ Ú©Ø³Ø¨â€ŒÙˆÚ©Ø§Ø±Ù‡Ø§",
          "logo": null,
          "website": "https://digitalinnovators.ir",
          "contactInfo": {
            "phone": "+98-26-33445566",
            "email": "contact@digitalinnovators.ir"
          },
          "products": ["Ù¾Ù„ØªÙØ±Ù…â€ŒÙ‡Ø§ÛŒ ÛŒØ§Ø¯Ú¯ÛŒØ±ÛŒ Ù…Ø§Ø´ÛŒÙ†", "Ø±Ø§Ù‡â€ŒØ­Ù„â€ŒÙ‡Ø§ÛŒ Ù¾Ø±Ø¯Ø§Ø²Ø´ ØªØµÙˆÛŒØ±", "Ú†Øªâ€ŒØ¨Ø§Øªâ€ŒÙ‡Ø§ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯"]
        },
        {
          "id": "ex-5",
          "name": "Ø±Ø¨Ø§ØªÛŒÚ© Ù¾ÛŒØ´Ø±ÙØªÙ‡",
          "boothCode": "E20",
          "category": "Robotics",
          "description": "Ø·Ø±Ø§Ø­ÛŒ Ùˆ Ø³Ø§Ø®Øª Ø±Ø¨Ø§Øªâ€ŒÙ‡Ø§ÛŒ ØµÙ†Ø¹ØªÛŒ Ùˆ Ø®Ø¯Ù…Ø§ØªÛŒ",
          "logo": null,
          "website": "https://advancedrobotics.ir",
          "contactInfo": {
            "phone": "+98-41-55667788",
            "email": "info@advancedrobotics.ir"
          },
          "products": ["Ø±Ø¨Ø§Øªâ€ŒÙ‡Ø§ÛŒ ØµÙ†Ø¹ØªÛŒ", "Ø³ÛŒØ³ØªÙ…â€ŒÙ‡Ø§ÛŒ Ø§ØªÙˆÙ…Ø§Ø³ÛŒÙˆÙ†", "Ø±Ø¨Ø§Øªâ€ŒÙ‡Ø§ÛŒ Ø®Ø¯Ù…Ø§ØªÛŒ"]
        },
        {
          "id": "ex-6",
          "name": "ÙÛŒÙ†â€ŒØªÚ© Ù†ÙˆÛŒÙ†",
          "boothCode": "F10",
          "category": "FinTech",
          "description": "Ø±Ø§Ù‡â€ŒØ­Ù„â€ŒÙ‡Ø§ÛŒ ÙÙ†Ø§ÙˆØ±ÛŒ Ù…Ø§Ù„ÛŒ Ùˆ Ø¨Ù„Ø§Ú©â€ŒÚ†ÛŒÙ†",
          "logo": null,
          "website": "https://fintech.ir",
          "contactInfo": {
            "phone": "+98-11-77889900",
            "email": "contact@fintech.ir"
          },
          "products": ["Ù¾Ù„ØªÙØ±Ù…â€ŒÙ‡Ø§ÛŒ Ù¾Ø±Ø¯Ø§Ø®Øª Ø¯ÛŒØ¬ÛŒØªØ§Ù„", "Ø±Ø§Ù‡â€ŒØ­Ù„â€ŒÙ‡Ø§ÛŒ Ø¨Ù„Ø§Ú©â€ŒÚ†ÛŒÙ†", "Ø³ÛŒØ³ØªÙ…â€ŒÙ‡Ø§ÛŒ Ú©ÛŒÙ Ù¾ÙˆÙ„ Ø§Ù„Ú©ØªØ±ÙˆÙ†ÛŒÚ©"]
        }
      ];

      const [selectedExhibitor, setSelectedExhibitor] = React.useState(null);
      const [searchTerm, setSearchTerm] = React.useState('');
      const [selectedCategory, setSelectedCategory] = React.useState('All');

      const categories = ["All", "Energy", "IoT", "AI", "Robotics", "FinTech"];

      const filteredExhibitors = exhibitors.filter(exhibitor => {
        const matchesSearch = !searchTerm ||
          exhibitor["name"].toLowerCase().includes(searchTerm.toLowerCase()) ||
          exhibitor["description"].toLowerCase().includes(searchTerm.toLowerCase()) ||
          exhibitor["products"].some(product => product.toLowerCase().includes(searchTerm.toLowerCase()));

        const matchesCategory = !selectedCategory || selectedCategory === 'All' || exhibitor["category"] === selectedCategory;

        return matchesSearch && matchesCategory;
      });

      const getCategoryColor = (category) => {
        const colors = {
          "Energy": "bg-green-100 text-green-800",
          "IoT": "bg-blue-100 text-blue-800",
          "AI": "bg-purple-100 text-purple-800",
          "Robotics": "bg-orange-100 text-orange-800",
          "FinTech": "bg-red-100 text-red-800"
        };
        return colors[category] || "bg-gray-100 text-gray-800";
      };

      return (
        <div className="space-y-6">
          <header className="text-center py-6">
            <h1 className="text-2xl font-bold text-gray-900 mb-2">Ù†Ù…Ø§ÛŒØ´Ú¯Ø§Ù‡â€ŒÙ‡Ø§ Ùˆ ØºØ±ÙÙ‡â€ŒÙ‡Ø§</h1>
            <p className="text-gray-600">Ú¯Ù¾ Ø²Ø¯Ù† Ø¨Ø§ Ø´Ø±Ú©Øªâ€ŒÙ‡Ø§ÛŒ Ø­Ø§Ø¶Ø± Ø¯Ø± TESTA</p>
          </header>

          {/* Map Section */}
          <div className="bg-white rounded-xl shadow p-6">
            <h2 className="text-xl font-semibold mb-4 flex items-center">
              <span className="ml-2">ğŸ—ºï¸</span>
              Ù†Ù‚Ø´Ù‡ Ù†Ù…Ø§ÛŒØ´Ú¯Ø§Ù‡
            </h2>
            <div className="bg-gray-100 rounded-lg p-8 text-center">
              <div className="text-6xl mb-4">ğŸ¢</div>
              <p className="text-gray-600 mb-4">
                Ù†Ù‚Ø´Ù‡ ØªØ¹Ø§Ù…Ù„ÛŒ Ù†Ù…Ø§ÛŒØ´Ú¯Ø§Ù‡ TESTA Ø¨Ù‡ Ø²ÙˆØ¯ÛŒ Ø§Ø¶Ø§ÙÙ‡ Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯
              </p>
              <div className="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
                <div className="bg-blue-50 p-3 rounded">
                  <div className="font-medium text-blue-900">Ø³Ø§Ù„Ù† A</div>
                  <div className="text-blue-700">Ø§Ù†Ø±Ú˜ÛŒ Ùˆ IoT</div>
                </div>
                <div className="bg-purple-50 p-3 rounded">
                  <div className="font-medium text-purple-900">Ø³Ø§Ù„Ù† B</div>
                  <div className="text-purple-700">Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ</div>
                </div>
                <div className="bg-green-50 p-3 rounded">
                  <div className="font-medium text-green-900">Ø³Ø§Ù„Ù† C</div>
                  <div className="text-green-700">Ø±Ø¨Ø§ØªÛŒÚ©</div>
                </div>
                <div className="bg-orange-50 p-3 rounded">
                  <div className="font-medium text-orange-900">Ø³Ø§Ù„Ù† D</div>
                  <div className="text-orange-700">ÙÛŒÙ†â€ŒØªÚ©</div>
                </div>
              </div>
            </div>
          </div>

          {/* Filters */}
          <div className="bg-white rounded-xl shadow p-6">
            <div className="grid md:grid-cols-2 gap-4 mb-6">
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Ø¬Ø³ØªØ¬Ùˆ
                </label>
                <input
                  type="text"
                  value={searchTerm}
                  onChange={(e) => setSearchTerm(e.target.value)}
                  className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                  placeholder="Ø¬Ø³ØªØ¬Ùˆ Ø¯Ø± Ù†Ø§Ù… Ø´Ø±Ú©ØªØŒ Ù…Ø­ØµÙˆÙ„Ø§Øª..."
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ
                </label>
                <select
                  value={selectedCategory}
                  onChange={(e) => setSelectedCategory(e.target.value)}
                  className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                >
                  {categories.map(cat => (
                    <option key={cat} value={cat === 'All' ? '' : cat}>
                      {cat === 'All' ? 'Ù‡Ù…Ù‡ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§' : cat}
                    </option>
                  ))}
                </select>
              </div>
            </div>

            {/* Exhibitors Grid */}
            <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
              {filteredExhibitors.map(exhibitor => (
                <div
                  key={exhibitor.id}
                  className="border border-gray-200 rounded-lg p-6 hover:shadow-md transition-shadow cursor-pointer"
                  onClick={() => setSelectedExhibitor(exhibitor)}
                >
                  <div className="flex items-start justify-between mb-4">
                    <div className="flex-1">
                      <h3 className="text-lg font-semibold text-gray-900 mb-2">
                        {exhibitor.name}
                      </h3>
                      <div className="flex items-center gap-2 mb-2">
                        <span className={`px-2 py-1 text-xs rounded-full ${getCategoryColor(exhibitor.category)}`}>
                          {exhibitor.category}
                        </span>
                        <span className="px-2 py-1 bg-gray-100 text-gray-800 text-xs rounded-full">
                          {exhibitor.boothCode}
                        </span>
                      </div>
                    </div>
                    <div className="text-2xl">ğŸ¢</div>
                  </div>

                  <p className="text-gray-700 text-sm mb-4 line-clamp-2">
                    {exhibitor.description}
                  </p>

                  <div className="space-y-1 text-sm text-gray-600 mb-4">
                    <div>ğŸ“§ {exhibitor.contactInfo.email}</div>
                    <div>ğŸ“ {exhibitor.contactInfo.phone}</div>
                  </div>

                  {/* QR Code for Booth */}
                  <div className="mb-4 flex justify-center">
                    <QRCodeGenerator
                      text={`${window.location.origin}/testa-booths#booth-${exhibitor.id}`}
                      size={70}
                      className="mb-1"
                    />
                  </div>

                  <div className="text-blue-600 hover:text-blue-800 text-sm">
                    Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø¬Ø²Ø¦ÛŒØ§Øª â†
                  </div>
                </div>
              ))}
            </div>

            {filteredExhibitors.length === 0 && (
              <div className="text-center py-12">
                <div className="text-4xl mb-4">ğŸ”</div>
                <p className="text-gray-500">Ù‡ÛŒÚ† ØºØ±ÙÙ‡â€ŒØ§ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯</p>
                <p className="text-sm text-gray-400 mt-2">
                  ÙÛŒÙ„ØªØ±Ù‡Ø§ Ø±Ø§ ØªØºÛŒÛŒØ± Ø¯Ù‡ÛŒØ¯ ÛŒØ§ Ø¹Ø¨Ø§Ø±Øª Ø¬Ø³ØªØ¬Ùˆ Ø±Ø§ Ø§ØµÙ„Ø§Ø­ Ú©Ù†ÛŒØ¯
                </p>
              </div>
            )}
          </div>

          {/* Exhibitor Details Modal */}
          {selectedExhibitor && (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
              <div className="bg-white rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
                <div className="p-6">
                  <div className="flex justify-between items-center mb-6">
                    <div>
                      <h2 className="text-2xl font-bold text-gray-900">{selectedExhibitor.name}</h2>
                      <p className="text-gray-600 mt-1">ØºØ±ÙÙ‡ {selectedExhibitor.boothCode}</p>
                    </div>
                    <button
                      onClick={() => setSelectedExhibitor(null)}
                      className="text-gray-400 hover:text-gray-600 text-2xl"
                    >
                      âœ•
                    </button>
                  </div>

                  <div className="grid md:grid-cols-2 gap-8">
                    <div>
                      <h3 className="text-lg font-semibold mb-4">Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ø´Ø±Ú©Øª</h3>
                      <p className="text-gray-700 mb-6">
                        {selectedExhibitor.description}
                      </p>

                      <div className="space-y-3">
                        <div>
                          <h4 className="font-medium text-gray-900 mb-2">Ø§Ø·Ù„Ø§Ø¹Ø§Øª ØªÙ…Ø§Ø³</h4>
                          <div className="space-y-1 text-sm text-gray-600">
                            <div>ğŸ“§ {selectedExhibitor.contactInfo.email}</div>
                            <div>ğŸ“ {selectedExhibitor.contactInfo.phone}</div>
                            {selectedExhibitor.website && (
                              <div>ğŸŒ <a href={selectedExhibitor.website} className="text-blue-600 hover:underline" target="_blank">
                                ÙˆØ¨â€ŒØ³Ø§ÛŒØª Ø´Ø±Ú©Øª
                              </a></div>
                            )}
                          </div>
                        </div>
                      </div>
                    </div>

                    <div>
                      <h3 className="text-lg font-semibold mb-4">Ù…Ø­ØµÙˆÙ„Ø§Øª Ùˆ Ø®Ø¯Ù…Ø§Øª</h3>
                      <div className="space-y-3">
                        {selectedExhibitor.products.map((product, index) => (
                          <div key={index} className="flex items-center gap-3 p-3 bg-gray-50 rounded-lg">
                            <div className="text-blue-600">ğŸ”¹</div>
                            <div className="text-gray-700">{product}</div>
                          </div>
                        ))}
                      </div>
                    </div>
                  </div>

                  <div className="mt-8 pt-6 border-t flex gap-4">
                    {selectedExhibitor.website && (
                      <a
                        href={selectedExhibitor.website}
                        target="_blank"
                        className="flex-1 px-6 py-3 bg-blue-600 text-white text-center rounded-lg hover:bg-blue-700 transition-colors"
                      >
                        ğŸŒ Ø¨Ø§Ø²Ø¯ÛŒØ¯ Ø§Ø² ÙˆØ¨â€ŒØ³Ø§ÛŒØª
                      </a>
                    )}
                    <button
                      onClick={() => setSelectedExhibitor(null)}
                      className="px-6 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors"
                    >
                      Ø¨Ø³ØªÙ†
                    </button>
                  </div>
                </div>
              </div>
            </div>
          )}
        </div>
      );
    }

    function SubmissionsTable({ session, submissions, challenges, users, onStatusUpdate }) {
      const [scoringSubmission, setScoringSubmission] = React.useState(null);
      const [showComparison, setShowComparison] = React.useState(false);
      const [toasts, setToasts] = React.useState([]);
      const [selectedSubmission, setSelectedSubmission] = React.useState(null);

      const orgSubmissions = submissions.filter(sub => {
        const challenge = challenges.find(c => c["id"] === sub["challengeId"]);
        return challenge && challenge["orgId"] === session["orgId"];
      });

      const statusOptions = [
        { "value": 'received', "label": 'Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯Ù‡', "color": 'bg-blue-100 text-blue-800' },
        { "value": 'under_review', "label": 'Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø±Ø±Ø³ÛŒ', "color": 'bg-yellow-100 text-yellow-800' },
        { "value": 'needs_revision', "label": 'Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø¨Ø§Ø²Ù†Ú¯Ø±ÛŒ', "color": 'bg-orange-100 text-orange-800' },
        { "value": 'accepted', "label": 'Ù¾Ø°ÛŒØ±ÙØªÙ‡ Ø´Ø¯Ù‡', "color": 'bg-green-100 text-green-800' },
        { "value": 'rejected', "label": 'Ø±Ø¯ Ø´Ø¯Ù‡', "color": 'bg-red-100 text-red-800' }
      ];

      // Toast management
      const addToast = (type, message) => {
        const toast = {
          "id": Date.now(),
          "type": type,
          "message": message
        };
        setToasts(prev => [...prev, toast]);
        setTimeout(() => removeToast(toast.id), 5000);
      };

      const removeToast = (id) => {
        setToasts(prev => prev.filter(toast => toast["id"] !== id));
      };

      const handleScoreUpdate = (updatedSubmission) => {
        const updatedSubmissions = submissions.map(sub =>
          sub["id"] === updatedSubmission["id"] ? updatedSubmission : sub
        );
        storage.set(KEYS.submissions, updatedSubmissions);
        onStatusUpdate(updatedSubmissions);
        addToast('success', 'Ù†Ù…Ø±Ø§Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯!');
      };

      const handleSelectWinner = (winnerSubmission) => {
        const updatedSubmissions = submissions.map(sub => {
          if (sub["id"] === winnerSubmission["id"]) {
            return { ...sub, "status": 'accepted', "winner": true };
          } else if (sub["challengeId"] === winnerSubmission["challengeId"] && sub["status"] === 'under_review') {
            return { ...sub, "status": 'rejected' };
          }
          return sub;
        });

        storage.set(KEYS.submissions, updatedSubmissions);
        onStatusUpdate(updatedSubmissions);

        // Update reputation for winner
        const winner = users.find(u => u.id === winnerSubmission.userId);
        updateReputation(winnerSubmission.userId, 20, 'accepted_submission');
        updateReputation(winnerSubmission.userId, 5, 'profile_completion'); // Bonus for completing profile
        updateReputation(winnerSubmission.userId, 2, 'on_time_submission'); // Bonus for on-time submission

        // Create notification for winner
        const notifications = storage.get(KEYS.notifications, []);
        notifications.push({
          id: `notif-${Date.now()}`,
          type: 'winner_announcement',
          text: `ğŸ‰ ØªØ¨Ø±ÛŒÚ©! Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ø´Ù…Ø§ Ø¨Ø±Ø§ÛŒ Ú†Ø§Ù„Ø´ "${challenges.find(c => c.id === winnerSubmission.challengeId)?.title}" Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† Ø¨Ø±Ù†Ø¯Ù‡ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯!`,
          createdAt: new Date().toISOString(),
          userId: winnerSubmission.userId,
          targetId: winnerSubmission.id,
          read: false
        });
        storage.set(KEYS.notifications, notifications);

        addToast('success', `ğŸ† Ø¨Ø±Ù†Ø¯Ù‡ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯: ${winner?.name || 'Ù†Ø§Ø´Ù†Ø§Ø³'} - Ø§Ù…ØªÛŒØ§Ø²: +27`);
      };

      const handleStatusChange = (submissionId, newStatus) => {
        const updatedSubmissions = submissions.map(sub =>
          sub.id === submissionId
            ? { ...sub, status: newStatus, updatedAt: new Date().toISOString() }
            : sub
        );
        storage.set(KEYS.submissions, updatedSubmissions);
        onStatusUpdate(updatedSubmissions);

        // Create notification for the solver
        const submission = updatedSubmissions.find(sub => sub.id === submissionId);
        const solver = users.find(u => u.id === submission.userId);

        const notifications = storage.get(KEYS.notifications, []);
        const notification = {
          id: `notif-${Date.now()}`,
          type: 'submission_status_update',
          text: `ÙˆØ¶Ø¹ÛŒØª Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ø´Ù…Ø§ Ø¨Ø±Ø§ÛŒ Ú†Ø§Ù„Ø´ "${challenges.find(c => c.id === submission.challengeId)?.title}" Ø¨Ù‡ "${statusOptions.find(s => s.value === newStatus)?.label}" ØªØºÛŒÛŒØ± ÛŒØ§ÙØª.`,
          createdAt: new Date().toISOString(),
          userId: solver.id,
          targetId: submission.id,
          read: false
        };
        notifications.push(notification);
        storage.set(KEYS.notifications, notifications);

        addToast('success', 'ÙˆØ¶Ø¹ÛŒØª Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø´Ø¯');
      };

      const getStatusBadge = (status) => {
        const statusOption = statusOptions.find(s => s.value === status);
        return statusOption ? statusOption : { label: status, color: 'bg-gray-100 text-gray-800' };
      };

      return (
        <div className="space-y-6">
          {/* Toast Notifications */}
          <ToastContainer toasts={toasts} onRemoveToast={removeToast} />

          <header className="text-center py-6">
            <h1 className="text-2xl font-bold text-gray-900 mb-2">Ù…Ø¯ÛŒØ±ÛŒØª Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯Ø§Øª</h1>
            <p className="text-gray-600">Ø¨Ø±Ø±Ø³ÛŒ Ùˆ Ù…Ø¯ÛŒØ±ÛŒØª Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯Ø§Øª Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯Ù‡</p>
          </header>

          <div className="bg-white rounded-xl shadow p-6">
            <div className="flex items-center justify-between mb-6">
              <h2 className="text-lg font-semibold">Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯Ø§Øª Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯Ù‡</h2>
              <div className="flex items-center gap-4">
                <div className="text-sm text-gray-600">
                  Ù…Ø¬Ù…ÙˆØ¹: {orgSubmissions.length} Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯
                </div>
                {orgSubmissions.filter(s => s.scores?.total).length >= 2 && (
                  <button
                    onClick={() => setShowComparison(true)}
                    className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2"
                  >
                    <span>âš–ï¸</span>
                    Ù…Ù‚Ø§ÛŒØ³Ù‡ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯Ø§Øª
                  </button>
                )}
              </div>
            </div>

            {orgSubmissions.length > 0 ? (
              <div className="overflow-x-auto">
                <table className="w-full text-sm">
                  <thead className="bg-gray-50">
                    <tr>
                      <th className="px-4 py-3 text-right font-medium text-gray-700">Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯â€ŒØ¯Ù‡Ù†Ø¯Ù‡</th>
                      <th className="px-4 py-3 text-right font-medium text-gray-700">Ú†Ø§Ù„Ø´</th>
                      <th className="px-4 py-3 text-right font-medium text-gray-700">Ø®Ù„Ø§ØµÙ‡</th>
                      <th className="px-4 py-3 text-right font-medium text-gray-700">Ù†Ù…Ø±Ù‡</th>
                      <th className="px-4 py-3 text-right font-medium text-gray-700">ØªØ§Ø±ÛŒØ® Ø§Ø±Ø³Ø§Ù„</th>
                      <th className="px-4 py-3 text-right font-medium text-gray-700">ÙˆØ¶Ø¹ÛŒØª</th>
                      <th className="px-4 py-3 text-right font-medium text-gray-700">Ø§Ù‚Ø¯Ø§Ù…Ø§Øª</th>
                    </tr>
                  </thead>
                  <tbody className="divide-y divide-gray-200">
                    {orgSubmissions.map(submission => {
                      const challenge = challenges.find(c => c.id === submission.challengeId);
                      const solver = users.find(u => u.id === submission.userId);
                      const statusBadge = getStatusBadge(submission.status);

                      return (
                        <tr key={submission.id} className="hover:bg-gray-50">
                          <td className="px-4 py-3">
                            <div>
                              <p className="font-medium text-gray-900">{solver?.name || 'Ù†Ø§Ø´Ù†Ø§Ø³'}</p>
                              <p className="text-gray-500 text-xs">{solver?.email}</p>
                            </div>
                          </td>
                          <td className="px-4 py-3">
                            <p className="font-medium text-gray-900">{challenge?.title || 'Ú†Ø§Ù„Ø´ Ù†Ø§Ù…Ø´Ø®Øµ'}</p>
                          </td>
                          <td className="px-4 py-3">
                            <p className="text-gray-700 text-sm line-clamp-2 max-w-xs">
                              {submission.data.summary}
                            </p>
                          </td>
                          <td className="px-4 py-3">
                            {submission.scores?.total ? (
                              <div className="text-center">
                                <div className="text-lg font-bold text-green-600">
                                  {submission.scores.total}/10
                                </div>
                                <button
                                  onClick={() => setScoringSubmission(submission)}
                                  className="text-xs text-blue-600 hover:underline"
                                >
                                  ÙˆÛŒØ±Ø§ÛŒØ´ Ù†Ù…Ø±Ù‡
                                </button>
                              </div>
                            ) : (
                              <button
                                onClick={() => setScoringSubmission(submission)}
                                className="px-3 py-1 bg-green-600 text-white text-sm rounded hover:bg-green-700 transition-colors"
                              >
                                Ù†Ù…Ø±Ù‡â€ŒØ¯Ù‡ÛŒ
                              </button>
                            )}
                          </td>
                          <td className="px-4 py-3 text-gray-600">
                            {new Date(submission.createdAt).toLocaleDateString('fa-IR')}
                          </td>
                          <td className="px-4 py-3">
                            <span className={`px-2 py-1 text-xs rounded-full ${statusBadge.color}`}>
                              {statusBadge.label}
                            </span>
                            {submission.winner && (
                              <span className="ml-2 px-2 py-1 text-xs rounded-full bg-yellow-100 text-yellow-800">
                                ğŸ† Ø¨Ø±Ù†Ø¯Ù‡
                              </span>
                            )}
                          </td>
                          <td className="px-4 py-3">
                            <div className="flex gap-2">
                              <select
                                value={submission.status}
                                onChange={(e) => handleStatusChange(submission.id, e.target.value)}
                                className="px-2 py-1 text-xs border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                              >
                                {statusOptions.map(option => (
                                  <option key={option.value} value={option.value}>
                                    {option.label}
                                  </option>
                                ))}
                              </select>
                              <button
                                onClick={() => {
                                  setSelectedSubmission(submission);
                                  window.location.hash = 'message-thread';
                                }}
                                className="px-2 py-1 bg-blue-600 text-white text-xs rounded hover:bg-blue-700 transition-colors"
                                title="Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§"
                              >
                                ğŸ’¬
                              </button>
                            </div>
                          </td>
                        </tr>
                      );
                    })}
                  </tbody>
                </table>
              </div>
            ) : (
              <div className="text-center py-12">
                <div className="text-4xl mb-4">ğŸ“‹</div>
                <p className="text-gray-500">Ù‡Ù†ÙˆØ² Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ Ø¯Ø±ÛŒØ§ÙØª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª</p>
              </div>
            )}
          </div>

          {/* Scoring Modal */}
          {scoringSubmission && (
            <SubmissionScoring
              submission={scoringSubmission}
              challenge={challenges.find(c => c.id === scoringSubmission.challengeId)}
              onScoreUpdate={handleScoreUpdate}
              onClose={() => setScoringSubmission(null)}
            />
          )}

          {/* Comparison Modal */}
          {showComparison && (
            <SubmissionsComparison
              submissions={orgSubmissions}
              challenge={challenges.find(c => c.id === orgSubmissions[0]?.challengeId)}
              onSelectWinner={handleSelectWinner}
              onClose={() => setShowComparison(false)}
            />
          )}
        </div>
      );
    }

    function MySubmissionsPage({ session, submissions, challenges, orgs }) {
      const [selectedSubmission, setSelectedSubmission] = React.useState(null);
      const userSubmissions = submissions.filter(s => s.userId === session?.userId);

      const statusOptions = [
        { value: 'received', label: 'Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯Ù‡', color: 'bg-blue-100 text-blue-800', icon: 'ğŸ“¬' },
        { value: 'under_review', label: 'Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø±Ø±Ø³ÛŒ', color: 'bg-yellow-100 text-yellow-800', icon: 'ğŸ”' },
        { value: 'needs_revision', label: 'Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø¨Ø§Ø²Ù†Ú¯Ø±ÛŒ', color: 'bg-orange-100 text-orange-800', icon: 'âœï¸' },
        { value: 'accepted', label: 'Ù¾Ø°ÛŒØ±ÙØªÙ‡ Ø´Ø¯Ù‡', color: 'bg-green-100 text-green-800', icon: 'âœ…' },
        { value: 'rejected', label: 'Ø±Ø¯ Ø´Ø¯Ù‡', color: 'bg-red-100 text-red-800', icon: 'âŒ' }
      ];

      const getStatusInfo = (status) => {
        return statusOptions.find(s => s.value === status) || statusOptions[0];
      };

      const getStatusDescription = (status) => {
        switch (status) {
          case 'received': return 'Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ø´Ù…Ø§ Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯Ù‡ Ùˆ Ø¨Ù‡ Ø²ÙˆØ¯ÛŒ Ø¨Ø±Ø±Ø³ÛŒ Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯.';
          case 'under_review': return 'Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ø´Ù…Ø§ Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø±Ø±Ø³ÛŒ ØªÙˆØ³Ø· ØªÛŒÙ… Ø§Ø³Øª.';
          case 'needs_revision': return 'Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ø´Ù…Ø§ Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø¨Ø§Ø²Ù†Ú¯Ø±ÛŒ Ø¯Ø§Ø±Ø¯. Ù„Ø·ÙØ§Ù‹ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù‡Ø¨ÙˆØ¯ Ø¨Ø®Ø´ÛŒØ¯.';
          case 'accepted': return 'Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ø´Ù…Ø§ Ù¾Ø°ÛŒØ±ÙØªÙ‡ Ø´Ø¯Ù‡ Ø§Ø³Øª! ØªØ¨Ø±ÛŒÚ© Ù…ÛŒâ€ŒÚ¯ÙˆÛŒÛŒÙ….';
          case 'rejected': return 'Ù…ØªØ§Ø³ÙØ§Ù†Ù‡ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ø´Ù…Ø§ Ø¯Ø± Ø§ÛŒÙ† Ù…Ø±Ø­Ù„Ù‡ Ù¾Ø°ÛŒØ±ÙØªÙ‡ Ù†Ø´Ø¯.';
          default: return 'ÙˆØ¶Ø¹ÛŒØª Ù†Ø§Ù…Ø´Ø®Øµ';
        }
      };

      return (
        <div className="space-y-6">
          <header className="text-center py-6">
            <h1 className="text-2xl font-bold text-gray-900 mb-2">Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯Ø§Øª Ù…Ù†</h1>
            <p className="text-gray-600">Ù¾ÛŒÚ¯ÛŒØ±ÛŒ ÙˆØ¶Ø¹ÛŒØª Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯Ø§Øª Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯Ù‡</p>
          </header>

          <div className="grid md:grid-cols-3 gap-6 mb-6">
            {statusOptions.map(status => {
              const count = userSubmissions.filter(s => s.status === status.value).length;
              return (
                <div key={status.value} className="bg-white rounded-lg shadow p-4">
                  <div className="flex items-center gap-3">
                    <span className="text-2xl">{status.icon}</span>
                    <div>
                      <p className="font-medium text-gray-900">{status.label}</p>
                      <p className="text-2xl font-bold text-gray-700">{count}</p>
                    </div>
                  </div>
                </div>
              );
            })}
          </div>

          <div className="bg-white rounded-xl shadow p-6">
            <h2 className="text-lg font-semibold mb-4">ğŸ“‹ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯Ø§Øª Ø´Ù…Ø§</h2>
            {userSubmissions.length > 0 ? (
              <div className="space-y-4">
                {userSubmissions.map(submission => {
                  const challenge = challenges.find(c => c.id === submission.challengeId);
                  const org = orgs.find(o => o.id === challenge?.orgId);
                  const statusInfo = getStatusInfo(submission.status);

                  return (
                    <div key={submission.id} className="border border-gray-200 rounded-lg p-6 hover:shadow-md transition-shadow">
                                              <div className="flex items-start justify-between mb-4">
                          <div className="flex-1">
                            <h3 className="text-lg font-semibold text-gray-900 mb-2">
                              {challenge?.title || 'Ú†Ø§Ù„Ø´ Ù†Ø§Ù…Ø´Ø®Øµ'}
                            </h3>
                            <p className="text-gray-600 mb-2">{org?.name || 'Ø³Ø§Ø²Ù…Ø§Ù† Ù†Ø§Ù…Ø´Ø®Øµ'}</p>
                            <p className="text-gray-700">{submission.data.summary}</p>
                          </div>
                          <div className="text-left">
                            <div className="flex flex-col items-end gap-2">
                              <span className={`inline-flex items-center gap-2 px-3 py-1 text-sm rounded-full ${statusInfo.color}`}>
                                <span>{statusInfo.icon}</span>
                                {statusInfo.label}
                              </span>
                              {submission.winner && (
                                <span className="inline-flex items-center gap-2 px-3 py-1 text-sm rounded-full bg-yellow-100 text-yellow-800">
                                  <span>ğŸ†</span>
                                  Ø¨Ø±Ù†Ø¯Ù‡ Ú†Ø§Ù„Ø´
                                </span>
                              )}
                            </div>
                          </div>
                        </div>

                      <div className="bg-gray-50 rounded-lg p-4 mb-4">
                        <p className="text-gray-700 text-sm">{getStatusDescription(submission.status)}</p>
                      </div>

                      <div className="flex items-center justify-between text-sm text-gray-500">
                        <div className="flex items-center gap-4">
                          <span>ğŸ“… Ø§Ø±Ø³Ø§Ù„: {new Date(submission.createdAt).toLocaleDateString('fa-IR')}</span>
                          {submission.ndaAcceptedAt && (
                            <span>ğŸ”’ NDA: {new Date(submission.ndaAcceptedAt).toLocaleDateString('fa-IR')}</span>
                          )}
                        </div>
                        <div className="flex items-center gap-4">
                          {submission.data.files?.length > 0 && (
                            <span>ğŸ“ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§: {submission.data.files.length}</span>
                          )}
                          {submission.data.video && (
                            <span>ğŸ¥ ÙˆÛŒØ¯ÛŒÙˆ</span>
                          )}
                        </div>
                      </div>

                      {/* Show proposal details if status allows */}
                      {(submission.status === 'needs_revision' || submission.status === 'accepted') && (
                        <div className="mt-4 pt-4 border-t border-gray-200">
                          <h4 className="font-medium text-gray-900 mb-2">Ø¬Ø²Ø¦ÛŒØ§Øª Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯:</h4>
                          <p className="text-gray-700 text-sm bg-gray-50 p-3 rounded">
                            {submission.data.proposal}
                          </p>
                        </div>
                      )}

                      {/* Action buttons based on status */}
                      <div className="mt-4 pt-4 border-t border-gray-200 flex gap-2">
                        <button
                          onClick={() => {
                            setSelectedSubmission(submission);
                            window.location.hash = 'message-thread';
                          }}
                          className="px-4 py-2 bg-green-600 text-white text-sm rounded-lg hover:bg-green-700 transition-colors flex items-center gap-1"
                        >
                          <span>ğŸ’¬</span>
                          Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§
                        </button>
                        {submission.status === 'needs_revision' && (
                          <button
                            onClick={() => alert('Ø§Ø±Ø³Ø§Ù„ Ù†Ø³Ø®Ù‡ Ø¨Ø§Ø²Ù†Ú¯Ø±ÛŒ Ø´Ø¯Ù‡ Ø¯Ø± Ù…Ø±Ø­Ù„Ù‡ Ø¨Ø¹Ø¯ÛŒ Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯')}
                            className="px-4 py-2 bg-blue-600 text-white text-sm rounded-lg hover:bg-blue-700 transition-colors"
                          >
                            ğŸ“¤ Ø§Ø±Ø³Ø§Ù„ Ù†Ø³Ø®Ù‡ Ø¬Ø¯ÛŒØ¯
                          </button>
                        )}
                      </div>
                    </div>
                  );
                })}
              </div>
            ) : (
              <div className="text-center py-12">
                <div className="text-4xl mb-4">ğŸ“</div>
                <p className="text-gray-500 mb-4">Ù‡Ù†ÙˆØ² Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ Ø§Ø±Ø³Ø§Ù„ Ù†Ú©Ø±Ø¯Ù‡â€ŒØ§ÛŒØ¯.</p>
                <button
                  onClick={() => window.location.hash = 'challenges'}
                  className="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
                >
                  Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ú†Ø§Ù„Ø´â€ŒÙ‡Ø§
                </button>
              </div>
            )}
          </div>
        </div>
      );
    }

    function ProfilePage({ user, org }) {
      if (!user) {
        return (
          <div className="text-center py-12">
            <div className="text-4xl mb-4">ğŸ‘¤</div>
            <p className="text-gray-500">Ú©Ø§Ø±Ø¨Ø± ÛŒØ§ÙØª Ù†Ø´Ø¯</p>
          </div>
        );
      }

      // Show different profiles based on user role
      if (user.role === 'SEEKER' && org) {
        return <SeekerProfile user={user} org={org} />;
      } else if (user.role === 'SOLVER') {
        return <SolverProfile user={user} />;
      } else {
        return (
          <div className="text-center py-12">
            <div className="text-4xl mb-4">âš ï¸</div>
            <p className="text-gray-500">Ù¾Ø±ÙˆÙØ§ÛŒÙ„ Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ù†ÙˆØ¹ Ú©Ø§Ø±Ø¨Ø± ØªØ¹Ø±ÛŒÙ Ù†Ø´Ø¯Ù‡</p>
          </div>
        );
      }
    }

    // =========================
    // --- APP (Stage 2.2) -----
    // =========================
    function App() {
      // Seed once on first render
      React.useEffect(() => {
        console.log('App component mounted, checking seeding...');
        seedDataOnce();

        // Also check if users exist and seed if needed
        setTimeout(() => {
          const users = storage.get(KEYS.users, []);
          console.log('Users check after mount:', users.length);
          if (users.length === 0) {
            console.log('No users found, forcing reseed...');
            localStorage.removeItem('seeded');
            seedDataOnce();
          }
        }, 100);

        // Set up global keyboard shortcuts
        const handleGlobalKeyboard = (e) => {
          // Alt+1 to focus main navigation
          if (e.altKey && e.key === '1') {
            e.preventDefault();
            const nav = document.querySelector('nav');
            focusManager.focusFirst(nav);
          }
          
          // Alt+2 to focus main content
          if (e.altKey && e.key === '2') {
            e.preventDefault();
            const main = document.querySelector('main, [role="main"]');
            focusManager.focusFirst(main);
          }
          
          // Escape to close any open modals
          if (e.key === 'Escape') {
            const modal = document.querySelector('[role="dialog"]:not([hidden])');
            if (modal) {
              const closeButton = modal.querySelector('[aria-label*="Ø¨Ø³ØªÙ†"], [aria-label*="close"]');
              closeButton?.click();
            }
          }
        };

        document.addEventListener('keydown', handleGlobalKeyboard);
        return () => document.removeEventListener('keydown', handleGlobalKeyboard);
      }, []);

      // Router setup
      const [currentRoute, navigate] = useHashRouter('home');

      // Data state
      const [session, setSession] = useLocalStorage(KEYS.session, null);
      const [users] = useLocalStorage(KEYS.users, []);
      const [orgs] = useLocalStorage(KEYS.orgs, []);
      const [challenges, setChallenges] = useLocalStorage(KEYS.challenges, []);
      const [submissions, setSubmissions] = useLocalStorage(KEYS.submissions, []);
      const [events] = useLocalStorage(KEYS.events, []);
      const [exhibitors] = useLocalStorage(KEYS.exhibitors, []);

      // Challenge management state
      const [selectedChallenge, setSelectedChallenge] = React.useState(null);
      const [editingChallenge, setEditingChallenge] = React.useState(null);
      const [showChallengeForm, setShowChallengeForm] = React.useState(false);
      const [creatingSubmission, setCreatingSubmission] = React.useState(null);
      const [selectedSubmission, setSelectedSubmission] = React.useState(null);

      // Kiosk mode
      const kioskMode = useKioskMode();

      // Enhanced keyboard navigation and accessibility
      React.useEffect(() => {
        const handleKeyDown = (event) => {
          // Ctrl/Cmd + K for search (global shortcut)
          if ((event.ctrlKey || event.metaKey) && event.key === 'k') {
            event.preventDefault();
            const searchInput = document.querySelector('input[type="search"], input[placeholder*="Ø¬Ø³ØªØ¬Ùˆ"]');
            if (searchInput) {
              searchInput.focus();
              searchInput.select();
            }
          }

          // Ctrl/Cmd + H for home
          if ((event.ctrlKey || event.metaKey) && event.key === 'h') {
            event.preventDefault();
            navigate('home');
          }

          // Alt + 1-9 for quick navigation
          if (event.altKey && event.key >= '1' && event.key <= '9') {
            event.preventDefault();
            const navItems = document.querySelectorAll('nav button[aria-current], nav button');
            const index = parseInt(event.key) - 1;
            if (navItems[index]) {
              navItems[index].click();
            }
          }

          // Escape key for closing modals/overlays
          if (event.key === 'Escape') {
            // Close any open modals, dropdowns, or overlays
            const modals = document.querySelectorAll('[role="dialog"], .modal, [data-modal]');
            const dropdowns = document.querySelectorAll('[aria-expanded="true"]');
            const closeButtons = document.querySelectorAll('[data-close], .close-button, [aria-label*="Ø¨Ø³ØªÙ†"]');
            
            if (modals.length > 0) {
              const topModal = modals[modals.length - 1];
              const closeBtn = topModal.querySelector('[data-close], button[aria-label*="Ø¨Ø³ØªÙ†"]');
              closeBtn?.click();
            } else if (dropdowns.length > 0) {
              const lastDropdown = dropdowns[dropdowns.length - 1];
              lastDropdown.setAttribute('aria-expanded', 'false');
              lastDropdown.click?.();
            } else if (closeButtons.length > 0) {
              closeButtons[closeButtons.length - 1].click();
            }
          }

          // Tab navigation improvements (focus trapping in modals)
          if (event.key === 'Tab') {
            const activeModal = document.querySelector('[role="dialog"]:not([hidden])');
            if (activeModal) {
              const focusableElements = activeModal.querySelectorAll(
                'button:not([disabled]), [href]:not([disabled]), input:not([disabled]), select:not([disabled]), textarea:not([disabled]), [tabindex]:not([tabindex="-1"]):not([disabled])'
              );
              
              if (focusableElements.length === 0) return;
              
              const firstElement = focusableElements[0];
              const lastElement = focusableElements[focusableElements.length - 1];

              if (event.shiftKey) {
                if (document.activeElement === firstElement || !activeModal.contains(document.activeElement)) {
                  event.preventDefault();
                  lastElement.focus();
                }
              } else {
                if (document.activeElement === lastElement) {
                  event.preventDefault();
                  firstElement.focus();
                }
              }
            }
          }

          // Arrow key navigation for lists, grids, and carousels
          if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(event.key)) {
            const activeElement = document.activeElement;
            
            // Navigation for grid layouts (challenges, submissions, etc.)
            if (activeElement?.closest('[role="grid"], .grid, [data-grid]')) {
              event.preventDefault();
              handleGridNavigation(event.key, activeElement);
            }
            
            // Navigation for lists
            else if (activeElement?.closest('[role="list"], [role="listbox"], .list-navigation')) {
              event.preventDefault();
              handleListNavigation(event.key, activeElement);
            }
            
            // Navigation for tab panels
            else if (activeElement?.closest('[role="tablist"]')) {
              event.preventDefault();
              handleTabNavigation(event.key, activeElement);
            }
          }

          // Space or Enter for activation
          if (event.key === ' ' || event.key === 'Enter') {
            const activeElement = document.activeElement;
            if (activeElement?.getAttribute('role') === 'button' && !activeElement.disabled) {
              event.preventDefault();
              activeElement.click();
            }
          }

          // F1 for help/shortcuts
          if (event.key === 'F1') {
            event.preventDefault();
            showKeyboardShortcuts();
          }
        };

        // Grid navigation helper
        const handleGridNavigation = (key, currentElement) => {
          const gridContainer = currentElement.closest('[role="grid"], .grid, [data-grid]');
          const gridItems = Array.from(gridContainer.querySelectorAll('[role="gridcell"], .grid > *, [data-grid-item]'));
          const currentIndex = gridItems.indexOf(currentElement);
          
          if (currentIndex === -1) return;
          
          const gridCols = parseInt(getComputedStyle(gridContainer).gridTemplateColumns?.split(' ').length) || 3;
          let targetIndex = currentIndex;
          
          switch (key) {
            case 'ArrowLeft':
              targetIndex = Math.max(0, currentIndex - 1);
              break;
            case 'ArrowRight':
              targetIndex = Math.min(gridItems.length - 1, currentIndex + 1);
              break;
            case 'ArrowUp':
              targetIndex = Math.max(0, currentIndex - gridCols);
              break;
            case 'ArrowDown':
              targetIndex = Math.min(gridItems.length - 1, currentIndex + gridCols);
              break;
          }
          
          if (targetIndex !== currentIndex && gridItems[targetIndex]) {
            gridItems[targetIndex].focus();
          }
        };

        // List navigation helper
        const handleListNavigation = (key, currentElement) => {
          const listContainer = currentElement.closest('[role="list"], [role="listbox"], .list-navigation');
          const listItems = Array.from(listContainer.querySelectorAll('[role="listitem"], [role="option"], li, .list-item'));
          const currentIndex = listItems.indexOf(currentElement);
          
          if (currentIndex === -1) return;
          
          let targetIndex = currentIndex;
          
          switch (key) {
            case 'ArrowUp':
              targetIndex = Math.max(0, currentIndex - 1);
              break;
            case 'ArrowDown':
              targetIndex = Math.min(listItems.length - 1, currentIndex + 1);
              break;
            case 'Home':
              targetIndex = 0;
              break;
            case 'End':
              targetIndex = listItems.length - 1;
              break;
          }
          
          if (targetIndex !== currentIndex && listItems[targetIndex]) {
            listItems[targetIndex].focus();
          }
        };

        // Tab navigation helper
        const handleTabNavigation = (key, currentElement) => {
          const tabList = currentElement.closest('[role="tablist"]');
          const tabs = Array.from(tabList.querySelectorAll('[role="tab"]'));
          const currentIndex = tabs.indexOf(currentElement);
          
          if (currentIndex === -1) return;
          
          let targetIndex = currentIndex;
          
          switch (key) {
            case 'ArrowLeft':
              targetIndex = currentIndex === 0 ? tabs.length - 1 : currentIndex - 1;
              break;
            case 'ArrowRight':
              targetIndex = currentIndex === tabs.length - 1 ? 0 : currentIndex + 1;
              break;
            case 'Home':
              targetIndex = 0;
              break;
            case 'End':
              targetIndex = tabs.length - 1;
              break;
          }
          
          if (targetIndex !== currentIndex && tabs[targetIndex]) {
            tabs.forEach((tab, index) => {
              tab.setAttribute('aria-selected', index === targetIndex ? 'true' : 'false');
              tab.setAttribute('tabindex', index === targetIndex ? '0' : '-1');
            });
            tabs[targetIndex].focus();
          }
        };

        // Show keyboard shortcuts help
        const showKeyboardShortcuts = () => {
          const helpModal = document.createElement('div');
          helpModal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
          helpModal.setAttribute('role', 'dialog');
          helpModal.setAttribute('aria-labelledby', 'shortcuts-title');
          helpModal.innerHTML = `
            <div class="bg-white rounded-xl shadow-2xl max-w-2xl w-full mx-4 max-h-96 overflow-y-auto">
              <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                  <h2 id="shortcuts-title" class="text-xl font-bold text-gray-900">Ù…ÛŒØ§Ù†Ø¨Ø±Ù‡Ø§ÛŒ Ú©ÛŒØ¨ÙˆØ±Ø¯</h2>
                  <button data-close class="text-gray-400 hover:text-gray-600 text-xl" aria-label="Ø¨Ø³ØªÙ†">
                    âœ•
                  </button>
                </div>
                <div class="grid md:grid-cols-2 gap-6">
                  <div>
                    <h3 class="font-semibold mb-3">Ù†Ø§ÙˆØ¨Ø±ÛŒ Ø¹Ù…ÙˆÙ…ÛŒ</h3>
                    <div class="space-y-2 text-sm">
                      <div class="flex justify-between">
                        <span>Ctrl/Cmd + K</span>
                        <span>Ø¬Ø³ØªØ¬Ùˆ</span>
                      </div>
                      <div class="flex justify-between">
                        <span>Ctrl/Cmd + H</span>
                        <span>ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ</span>
                      </div>
                      <div class="flex justify-between">
                        <span>Alt + 1-9</span>
                        <span>Ù…Ù†ÙˆÛŒ Ø³Ø±ÛŒØ¹</span>
                      </div>
                      <div class="flex justify-between">
                        <span>Escape</span>
                        <span>Ø¨Ø³ØªÙ† Ù…ÙˆØ¯Ø§Ù„</span>
                      </div>
                      <div class="flex justify-between">
                        <span>F1</span>
                        <span>Ø±Ø§Ù‡Ù†Ù…Ø§</span>
                      </div>
                    </div>
                  </div>
                  <div>
                    <h3 class="font-semibold mb-3">Ù†Ø§ÙˆØ¨Ø±ÛŒ Ø¯Ø± ØµÙØ­Ø§Øª</h3>
                    <div class="space-y-2 text-sm">
                      <div class="flex justify-between">
                        <span>Tab/Shift+Tab</span>
                        <span>Ø­Ø±Ú©Øª Ø¯Ø± Ø¹Ù†Ø§ØµØ±</span>
                      </div>
                      <div class="flex justify-between">
                        <span>Arrow Keys</span>
                        <span>Ù†Ø§ÙˆØ¨Ø±ÛŒ Ø¯Ø± ÙÙ‡Ø±Ø³Øªâ€ŒÙ‡Ø§</span>
                      </div>
                      <div class="flex justify-between">
                        <span>Space/Enter</span>
                        <span>ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ</span>
                      </div>
                      <div class="flex justify-between">
                        <span>Home/End</span>
                        <span>Ø´Ø±ÙˆØ¹/Ù¾Ø§ÛŒØ§Ù† ÙÙ‡Ø±Ø³Øª</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          `;

          const closeBtn = helpModal.querySelector('[data-close]');
          closeBtn.addEventListener('click', () => {
            helpModal.remove();
          });

          helpModal.addEventListener('click', (e) => {
            if (e.target === helpModal) {
              helpModal.remove();
            }
          });

          document.body.appendChild(helpModal);
          closeBtn.focus();
        };

        document.addEventListener('keydown', handleKeyDown);
        return () => document.removeEventListener('keydown', handleKeyDown);
      }, [navigate]);

      // Authentication handlers
      const handleLogin = (userSession) => {
        setSession(userSession);
        navigate('home');
      };

      const handleLogout = () => {
        setSession(null);
      };

      // Challenge management handlers
      const handleSelectChallenge = (challenge) => {
        setSelectedChallenge(challenge);
        navigate('challenge-detail');
      };

      const handleCreateChallenge = () => {
        setEditingChallenge(null);
        setShowChallengeForm(true);
        navigate('create-challenge');
      };

      const handleEditChallenge = (challenge) => {
        setEditingChallenge(challenge);
        setShowChallengeForm(true);
        navigate('create-challenge');
      };

      const handleSaveChallenge = (challengeData) => {
        setChallenges(prev => {
          const existingIndex = prev.findIndex(c => c.id === challengeData.id);
          if (existingIndex !== -1) {
            const updated = [...prev];
            updated[existingIndex] = challengeData;
            return updated;
          } else {
            return [...prev, challengeData];
          }
        });
        setShowChallengeForm(false);
        setEditingChallenge(null);
        navigate('challenges');
      };

      const handleCancelChallenge = () => {
        setShowChallengeForm(false);
        setEditingChallenge(null);
        navigate('challenges');
      };

      const handleBackToCatalog = () => {
        setSelectedChallenge(null);
        navigate('challenges');
      };

      // Submission handlers
      const handleCreateSubmission = (challenge) => {
        setCreatingSubmission(challenge);
        navigate('create-submission');
      };

      const handleSaveSubmission = (submissionData) => {
        setCreatingSubmission(null);
        // Navigate to my-submissions to see the new submission
        navigate('my-submissions');
        alert('Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ø´Ù…Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯!');
      };

      const handleCancelSubmission = () => {
        setCreatingSubmission(null);
        navigate('challenges');
      };
  
      // Temporary Reset Demo button for QA (will move to Admin later)
      const handleReset = () => {
        if (!confirm("Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ Ø¯Ù…ÙˆØŸ Ù‡Ù…Ù‡Ù” Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ù¾Ø§Ú© Ùˆ Ù…Ø¬Ø¯Ø¯Ø§Ù‹ Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯.")) return;
        storage.clear();
        // Clear session
        setSession(null);
        // Reseed and reload UI
        seedDataOnce();
        navigate('home');
      };

      // Render current page based on route
      const renderCurrentPage = () => {
        // Authentication routes
        if (currentRoute === 'login') {
          return <LoginForm onLogin={handleLogin} />;
        }
        
        if (currentRoute === 'register') {
          return <RegistrationForm type="solver" />;
        }
        
        if (currentRoute === 'register-seeker') {
          return <RegistrationForm type="seeker" />;
        }

        // Public/Protected routes
        switch (currentRoute) {
          case 'home':
            return <HomePage users={users} challenges={challenges} submissions={submissions} events={events} exhibitors={exhibitors} session={session} />;
          case 'challenges':
            return <ChallengeCatalog
              challenges={challenges}
              onSelectChallenge={handleSelectChallenge}
              session={session}
            />;
          case 'challenge-detail':
            return <ChallengeDetail
              challenge={selectedChallenge}
              onBack={handleBackToCatalog}
              onSolve={handleCreateSubmission}
              session={session}
            />;
          case 'create-challenge':
            if (session?.role === 'SEEKER') {
              return <ChallengeForm
                challenge={editingChallenge}
                onSave={handleSaveChallenge}
                onCancel={handleCancelChallenge}
                session={session}
              />;
            } else {
              navigate('home');
              return null;
            }
          case 'create-submission':
            if (session?.role === 'SOLVER') {
              return <SubmissionForm
                challenge={creatingSubmission}
                onSave={handleSaveSubmission}
                onCancel={handleCancelSubmission}
                session={session}
              />;
            } else {
              navigate('home');
              return null;
            }
                    case 'testa':
            return <TESTAPage events={events} exhibitors={exhibitors} session={session} />;
          case 'testa-home':
            return <TESTAHomePage session={session} />;
          case 'testa-schedule':
            return <TESTASchedulePage />;
          case 'testa-events':
            return <TESTAEventsPage session={session} />;
          case 'testa-booths':
            return <TESTABoothsPage />;
          case 'testa-stats':
            return <TESTAStatsPage session={session} />;

          // Role-specific routes
          case 'admin':
            if (session?.role === 'ADMIN') {
              return <AdminPage session={session} />;
            } else {
              navigate('home');
              return null;
            }

          case 'my-challenges':
            if (session?.role === 'SEEKER') {
              return <MyChallengesPage session={session} challenges={challenges} orgs={orgs} />;
            } else {
              navigate('home');
              return null;
            }
          case 'submissions':
            if (session?.role === 'SEEKER') {
              return <SubmissionsTable
                session={session}
                submissions={submissions}
                challenges={challenges}
                users={users}
                onStatusUpdate={setSubmissions}
              />;
            } else {
              navigate('home');
              return null;
            }

          case 'my-submissions':
            if (session?.role === 'SOLVER') {
              return <MySubmissionsPage session={session} submissions={submissions} challenges={challenges} orgs={orgs} />;
            } else {
              navigate('home');
              return null;
            }
          case 'messages':
            if (session) {
              return <MessagesOverview
                session={session}
                submissions={submissions}
                challenges={challenges}
                users={users}
                onSelectThread={(submission) => {
                  setSelectedSubmission(submission);
                  navigate('message-thread');
                }}
              />;
            } else {
              navigate('login');
              return null;
            }
          case 'message-thread':
            if (session && selectedSubmission) {
              return <MessageThread
                submission={selectedSubmission}
                session={session}
                users={users}
                onSendMessage={() => {
                  // Refresh submissions to trigger re-render
                  setSubmissions([...submissions]);
                }}
              />;
            } else {
              navigate('messages');
              return null;
            }

          case 'profile':
            if (session) {
              const user = users.find(u => u.id === session.userId);
              const org = session.role === 'SEEKER' ? orgs.find(o => o.id === session.orgId) : null;
              return <ProfilePage user={user} org={org} />;
            } else {
              navigate('login');
              return null;
            }
          
          default:
            return <HomePage users={users} challenges={challenges} submissions={submissions} events={events} exhibitors={exhibitors} session={session} />;
        }
      };
  
      return (
        <div className={`min-h-screen ${kioskMode.isKioskMode ? 'bg-blue-50' : 'bg-gray-50'}`}>
          {/* Skip Links for Accessibility */}
          <SkipLink href="#main-content">Ø±ÙØªÙ† Ø¨Ù‡ Ù…Ø­ØªÙˆØ§ÛŒ Ø§ØµÙ„ÛŒ</SkipLink>
          <SkipLink href="#navigation">Ø±ÙØªÙ† Ø¨Ù‡ Ù…Ù†ÙˆÛŒ Ù†Ø§ÙˆØ¨Ø±ÛŒ</SkipLink>
          
          {/* Page Loading Indicator */}
          <div id="page-loading" className="page-loading" style={{ display: 'none' }} role="status" aria-label="Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ">
            <div className="flex flex-col items-center">
              <LoadingSpinner size="lg" />
              <p className="mt-4 text-gray-600">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...</p>
            </div>
          </div>

          <Navigation
            id="navigation"
            currentRoute={currentRoute}
            navigate={navigate}
            session={session}
            onLogout={handleLogout}
            kioskMode={kioskMode}
          />

          <main 
            id="main-content" 
            className={`${kioskMode.isKioskMode ? 'max-w-7xl text-lg' : 'max-w-5xl'} mx-auto px-6 py-8`} 
            role="main"
            tabIndex="-1"
            aria-label="Ù…Ø­ØªÙˆØ§ÛŒ Ø§ØµÙ„ÛŒ"
          >
            {renderCurrentPage()}
          </main>

          {/* Global Toast Container */}
          <ToastContainer toasts={[]} onRemoveToast={() => {}} />

          {/* Kiosk Mode / Admin Controls */}
          {session?.role === 'ADMIN' && (
            <div className={`fixed bottom-4 left-4 z-50 ${kioskMode.isKioskMode ? 'scale-125' : ''}`}>
              <div className="bg-white rounded-lg shadow-lg p-3 border">
                <div className="flex items-center gap-2 mb-2">
                  <span className="text-xs text-gray-500">Ù†Ø´Ø³Øª:</span>
                  <span className="text-xs font-medium">{session?.name || "â€”"}</span>
                  {kioskMode.isKioskMode && (
                    <span className="px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full">
                      ğŸ–¥ï¸ Kiosk
                    </span>
                  )}
                </div>

                {/* Kiosk Mode Toggle */}
                <div className="mb-2">
                  <button
                    onClick={kioskMode.isKioskMode ? kioskMode.disableKioskMode : kioskMode.enableKioskMode}
                    className={`w-full px-3 py-1 rounded-md text-xs transition-colors ${
                      kioskMode.isKioskMode
                        ? 'bg-red-100 hover:bg-red-200 text-red-800'
                        : 'bg-blue-100 hover:bg-blue-200 text-blue-800'
                    }`}
                  >
                    {kioskMode.isKioskMode ? 'ğŸ”„ Ø®Ø±ÙˆØ¬ Ø§Ø² Ø­Ø§Ù„Øª Ú©ÛŒÙˆØ³Ú©' : 'ğŸ–¥ï¸ Ø­Ø§Ù„Øª Ú©ÛŒÙˆØ³Ú©'}
                  </button>
                </div>

                {!kioskMode.isKioskMode && (
                  <>
                    <button
                      onClick={handleReset}
                      className="w-full px-3 py-1 rounded-md bg-gray-100 hover:bg-gray-200 text-xs transition-colors mb-2"
                    >
                      ğŸ”„ Reset Demo
                    </button>
                    <button
                      onClick={() => {
                        console.log('Manual seeding...');
                        localStorage.removeItem('seeded');
                        seedDataOnce();
                      }}
                      className="w-full px-3 py-1 rounded-md bg-blue-100 hover:bg-blue-200 text-xs transition-colors"
                    >
                      ğŸŒ± Seed Data
                    </button>
                  </>
                )}
              </div>
            </div>
          )}

          {/* Kiosk Mode Indicator */}
          {kioskMode.isKioskMode && (
            <>
              <div className="fixed top-4 left-1/2 transform -translate-x-1/2 z-40">
                <div className="bg-blue-600 text-white px-4 py-2 rounded-full text-sm font-medium shadow-lg">
                  ğŸ–¥ï¸ Ø­Ø§Ù„Øª Ù†Ù…Ø§ÛŒØ´Ú¯Ø§Ù‡ÛŒ ÙØ¹Ø§Ù„
                </div>
              </div>

              {/* Floating Reset Demo Button for Kiosk */}
              <div className="fixed bottom-4 right-4 z-50">
                <button
                  onClick={() => {
                    if (confirm('Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø¯Ù…Ùˆ Ø±Ø§ Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ Ú©Ù†ÛŒØ¯ØŸ')) {
                      kioskMode.resetDemoData();
                    }
                  }}
                  className="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg shadow-lg text-sm font-medium transition-colors"
                  title="Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ Ø¯Ù…Ùˆ"
                >
                  ğŸ”„ Reset Demo
                </button>
              </div>
            </>
          )}
        </div>
      );
    }
  
    // --- TEST SIMPLE COMPONENT FIRST ---
    function SimpleTest() {
      return React.createElement('div', { style: { padding: '20px', background: '#e3f2fd' } }, 
        React.createElement('h2', null, 'React is working!'),
        React.createElement('p', null, 'If you see this, React is loaded correctly.')
      );
    }

    // --- RENDER ROOT ---
    try {
      console.log('Starting React app...');
      const root = document.getElementById("root");
      if (!root) {
        console.error('Root element not found!');
        document.body.innerHTML = '<div style="padding: 20px; color: red;">Error: Root element not found!</div>';
        throw new Error('Root element not found');
      }
      
      console.log('Root element found, creating React root...');
      const reactRoot = ReactDOM.createRoot(root);
      
      // Test simple component first
      console.log('Testing simple component...');
      reactRoot.render(React.createElement(SimpleTest));
      
      // If that works, try the full app after a delay
      setTimeout(() => {
        console.log('Now rendering full App component...');
        try {
          reactRoot.render(React.createElement(App));
          console.log('App rendered successfully!');
        } catch (appError) {
          console.error('Error in App component:', appError);
          reactRoot.render(React.createElement('div', 
            { style: { padding: '20px', color: 'red', fontFamily: 'Arial' } },
            React.createElement('h2', null, 'Ø®Ø·Ø§ Ø¯Ø± Ú©Ø§Ù…Ù¾ÙˆÙ†Ù†Øª Ø§ØµÙ„ÛŒ'),
            React.createElement('p', null, 'Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ú©Ø§Ù…Ù¾ÙˆÙ†Ù†Øª Ø§ØµÙ„ÛŒ:'),
            React.createElement('pre', 
              { style: { background: '#f5f5f5', padding: '10px', borderRadius: '4px' } },
              appError.message
            ),
            React.createElement('button', 
              { onClick: () => location.reload(), style: { padding: '10px 20px', marginTop: '10px' } },
              'ØªÙ„Ø§Ø´ Ù…Ø¬Ø¯Ø¯'
            )
          ));
        }
      }, 1000);
      
    } catch (error) {
      console.error('Error rendering React app:', error);
      document.body.innerHTML = `
        <div style="padding: 20px; color: red; font-family: Arial;">
          <h2>Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ React</h2>
          <p>Ù…ØªØ£Ø³ÙØ§Ù†Ù‡ Ø®Ø·Ø§ÛŒÛŒ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ React Ø±Ø® Ø¯Ø§Ø¯Ù‡ Ø§Ø³Øª:</p>
          <pre style="background: #f5f5f5; padding: 10px; border-radius: 4px;">${error.message}</pre>
          <button onclick="location.reload()" style="padding: 10px 20px; margin-top: 10px;">ØªÙ„Ø§Ø´ Ù…Ø¬Ø¯Ø¯</button>
        </div>
      `;
    }
  </script>
</body>
</html>
  